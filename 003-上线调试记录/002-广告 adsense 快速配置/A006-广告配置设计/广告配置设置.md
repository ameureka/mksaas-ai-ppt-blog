> ## 分析完成！AdSense 快速启动配置已完成

### 📊 网站 AdSense 准备状态总结

| 类别 | 状态 | 说明 |
|------|------|------|
| 内容数量 | ✅ 204篇 | 远超 AdSense 要求的 30 篇 |
| 隐私政策 | ✅ 已有 | 包含广告相关条款 |
| 关于我们 | ✅ 已有 | /about |
| 联系我们 | ✅ 已有 | /contact |
| sitemap.xml | ✅ 已优化 | 333 URLs + SEO 元数据 |
| robots.txt | ✅ 已配置 | 正确的 allow/disallow |

### 🆕 本次创建的文件

1. public/ads.txt - AdSense 授权文件 (待填写 Publisher ID)
2. src/lib/config/adsense.ts - AdSense 配置
3. src/components/ads/display-ad.tsx - 广告展示组件
4. src/components/ads/index.ts - 组件导出
5. docs/adsense-readiness-report.md - 完整分析报告

### 🔧 修改的文件

1. env.example - 添加 AdSense 环境变量
2. src/app/[locale]/layout.tsx - 添加 AdSense 脚本加载
3. src/app/sitemap.ts - 添加 SEO 元数据 (之前完成)

### 📋 申请 AdSense 后的步骤

1. 获取 Publisher ID (如 ca-pub-1234567890123456)
2. 更新 .env.local:
  bash
   NEXT_PUBLIC_ADSENSE_ENABLED=true
   NEXT_PUBLIC_ADSENSE_PUBLISHER_ID=ca-pub-XXXXXXXXXXXXXXXX

3. 更新 public/ads.txt:

   google.com, pub-XXXXXXXXXXXXXXXX, DIRECT, f08c47fec0942fa0

4. 部署并等待审核

### 📄 详细报告

完整分析报告已保存到: docs/adsense-readiness-report.md
 ▸ Credits: 12.21 • Time: 3m 9s

---

## AdSense 控制原理（如何在不同环境显示/隐藏/占位符）

- 核心配置：`src/lib/config/adsense.ts`
  - `enabled`: 由 `NEXT_PUBLIC_ADSENSE_ENABLED === 'true'` 决定。为 false 时不渲染广告。
  - `testMode`: 在开发环境自动为 true；或当 `NEXT_PUBLIC_ADSENSE_TEST_MODE === 'true'` 时强制开启，占位符模式会渲染骨架/占位，不会请求真实广告。
  - `publisherId` 与 `slots.*`: 由对应的环境变量填入。缺失 slot 时组件早退返回 null（testMode 例外）。
- 渲染逻辑（DisplayAd/AnchorAd/预设组件通用）：
  1) 如果 `!slot` 且非 testMode，直接返回 null。
  2) 如果 `!enabled` 且非 testMode，直接返回 null。
  3) testMode 时渲染占位符；非 testMode 时渲染 `<ins class="adsbygoogle">` 并 push。
- 结果：本地开发自动有占位符；生产若未配置/未开启则完全不渲染；需要在生产预览占位符时可打开 `NEXT_PUBLIC_ADSENSE_TEST_MODE=true`。

## 环境变量清单及作用

```
NEXT_PUBLIC_ADSENSE_ENABLED       # 开关：true 才会尝试渲染真实广告
NEXT_PUBLIC_ADSENSE_TEST_MODE     # 可选：true 时即便在生产也走占位符/test 模式
NEXT_PUBLIC_ADSENSE_PUBLISHER_ID  # AdSense 发布商 ID (ca-pub-xxxxxxxxxxxxxxx)
NEXT_PUBLIC_ADSENSE_BLOG_BANNER   # 各广告位 slot ID
NEXT_PUBLIC_ADSENSE_BLOG_SIDEBAR
NEXT_PUBLIC_ADSENSE_HOME_BANNER
NEXT_PUBLIC_ADSENSE_VERTICAL
NEXT_PUBLIC_ADSENSE_OUTSTREAM
NEXT_PUBLIC_ADSENSE_MULTIPLEX
NEXT_PUBLIC_ADSENSE_ANCHOR
```

> 生产上线前只需要把 ENABLED=false 或留空，即可全站不渲染；上线后填好 publisher/slot 并设 ENABLED=true；如需生产占位预览，设 TEST_MODE=true。

## 组件关系与使用

- 基础组件：`DisplayAd`（懒加载、防 CLS、测试占位）。
- 预设组件：`BlogBannerAd/BlogSidebarAd/HomeBannerAd/VerticalSidebarAd/OutstreamVideoAd/MultiplexAd`（全部基于 DisplayAd）。
- 锚定组件：`AnchorAd`（独立实现 fixed 底部，可关闭，sessionStorage 持久化）。
- 原生广告：`NativeAdCard`（与 PPTCard 风格一致，50% 可见曝光回调、点击回调，用于网格中插位）。
- MDX 自动注入：`injectAdsIntoContent` + `MDXContentWithAds`（博客正文按段落插入 OutstreamVideoAd）。
- 配置入口：统一从 `ADSENSE_CONFIG` 读取 `enabled/testMode/publisherId/slots`。

## 典型使用场景与配置示例

- 上线前不展示任何广告：  
  `NEXT_PUBLIC_ADSENSE_ENABLED=false`（或不填 slot）；`NEXT_PUBLIC_ADSENSE_TEST_MODE=false`。重新部署。
- 上线前在生产预览占位符：  
  `NEXT_PUBLIC_ADSENSE_ENABLED=false`，`NEXT_PUBLIC_ADSENSE_TEST_MODE=true`。重新部署后只显示占位符，不会请求真实广告。
- 正式投放：  
  `NEXT_PUBLIC_ADSENSE_ENABLED=true`，填好 `PUBLISHER_ID` 和各 slot；`NEXT_PUBLIC_ADSENSE_TEST_MODE=false`。重新部署。

## 生产部署与排查步骤（Vercel）

1) 在 Vercel Project → Settings → Environment Variables 设置上述变量。  
2) 确认 `public/ads.txt` 填入发布商 ID。  
3) 部署后检查：
   - 打开 `/ads.txt` 可访问。
   - 浏览器无广告拦截时，查看 DOM 是否有 `<ins class="adsbygoogle">`（testMode 则是占位 div）。
   - 控制台无 adsbygoogle 报错。
4) 如果生产无占位符：多半是 `ENABLED=false` 或未开 `TEST_MODE`，或 slot 为空（非 testMode 时会直接 return null）。

## 申请与上线要点

- 申请：在 AdSense 后台创建站点，等待审核；通过后获取 `ca-pub-...` 发布商 ID 和各广告单元 slot ID。
- 必要页面/链接：隐私政策、服务条款、关于我们、联系我们，页脚可见；已在站点具备。
- 审核前策略：保持 `ENABLED=false` 但可选 `TEST_MODE=true` 观察占位；审核后再开启 ENABLED 并填 slot。

## 文件/模块索引

- 配置：`src/lib/config/adsense.ts`
- 环境示例：`env.example`
- 组件：`src/components/ads/*`（DisplayAd, AnchorAd, 预设组件, NativeAdCard）
- 注入工具：`src/lib/mdx/inject-ads.tsx`、`src/components/blog/mdx-content-with-ads.tsx`
- 授权文件：`public/ads.txt`
- 全局脚本注入：`src/app/[locale]/layout.tsx`

## 常见问题

- “本地有占位符，生产没有”：生产 `ENABLED=false` 且未开 `TEST_MODE`，组件早退；或 slot 为空且非 testMode。  
- “想先不投放但看位置” ：开 `NEXT_PUBLIC_ADSENSE_TEST_MODE=true`，可在生产预览占位符。  
- “投放后没广告” ：检查是否填了 publisher/slot，`ENABLED=true`，浏览器未拦截，且 AdSense 审核通过。
