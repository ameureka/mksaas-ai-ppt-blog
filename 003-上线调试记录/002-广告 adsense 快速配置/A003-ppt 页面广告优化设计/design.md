# PPT 页面广告集成设计文档

**创建日期**: 2025-12-04
**更新日期**: 2025-12-04
**版本**: 2.0

---

## 一、系统架构

### 1.1 广告组件架构

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                           广告组件架构                                        │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  src/components/ads/                                                         │
│  ├── display-ad.tsx (横幅广告基础组件)                                        │
│  │   ├── BlogBannerAd      → PPT 首页/详情页/分类页 横幅广告                 │
│  │   ├── MultiplexAd       → PPT 详情页推荐区域                              │
│  │   └── BlogSidebarAd     → 侧边栏广告 (如有)                               │
│  │                                                                           │
│  ├── native-ad-card.tsx (原生广告组件) ← 需迁移                              │
│  │   └── NativeAdCard      → PPT 网格列表中的原生广告                        │
│  │       ├── 展示追踪 (IntersectionObserver, 50% 可见)                       │
│  │       ├── 点击追踪                                                        │
│  │       └── 与 PPTCard 样式一致                                             │
│  │                                                                           │
│  ├── anchor-ad.tsx                                                           │
│  │   └── AnchorAd          → 已在 marketing layout 全局生效 ✅               │
│  │                                                                           │
│  └── index.ts (统一导出)                                                     │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 原生广告组件设计

```typescript
// NativeAdCard 组件接口
interface NativeAdData {
  id: string;
  imageUrl: string;
  headline: string;
  description: string;
  advertiser: string;
  logoUrl?: string;
  clickUrl: string;
  callToAction: string;
}

interface NativeAdCardProps {
  ad: NativeAdData;
  position?: string;           // 广告位置标识，用于追踪
  className?: string;
  onImpression?: (adId: string) => void;  // 展示回调
  onClick?: (adId: string) => void;       // 点击回调
}
```

---

## 二、广告位规划

### 2.1 PPT 首页 (`/ppt`)

```
┌──────────────────────────────────────────────────────────────────────────────┐
│  PPT 首页广告布局                                                             │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  Hero 区域 (搜索框)                                                 │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  热门分类 (6 个分类卡片)                                            │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  📢 BlogBannerAd (horizontal, 90px) ← 广告位 #1                     │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  精选模板 (Featured Templates)                                      │     │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐   │     │
│  │  │PPT1 │ │PPT2 │ │PPT3 │ │PPT4 │ │🎯原生│ │PPT5 │ │PPT6 │ │PPT7 │   │     │
│  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘   │     │
│  │                                  ↑ 广告位 #2 (第 5 位)               │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ═══════════════════════════════════════════════════════════════════════    │
│  搜索结果 (如有):                                                            │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  📢 BlogBannerAd (horizontal, 90px) ← 广告位 #3                     │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  搜索结果网格                                                       │     │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                   │     │
│  │  │PPT1 │ │PPT2 │ │PPT3 │ │PPT4 │ │🎯原生│ │PPT5 │ ← 广告位 #4a     │     │
│  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘                   │     │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                   │     │
│  │  │PPT6 │ │PPT7 │ │PPT8 │ │PPT9 │ │PPT10│ │🎯原生│ ← 广告位 #4b     │     │
│  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘                   │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 PPT 详情页 (`/ppt/[id]`)

```
┌──────────────────────────────────────────────────────────────────────────────┐
│  PPT 详情页广告布局                                                           │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────┐  ┌──────────────────────┐          │
│  │         左侧预览区 (3/5)             │  │   右侧下载卡片 (2/5) │          │
│  │  ┌────────────────────────────────┐ │  │                      │          │
│  │  │        预览图 + 缩略图          │ │  │  下载信息            │          │
│  │  └────────────────────────────────┘ │  │  下载按钮            │          │
│  │  ┌────────────────────────────────┐ │  │                      │          │
│  │  │        模板描述                 │ │  └──────────────────────┘          │
│  │  └────────────────────────────────┘ │                                    │
│  └─────────────────────────────────────┘                                    │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────┐           │
│  │  📢 BlogBannerAd (horizontal, 90px) ← 广告位 #5 (替换占位符)  │           │
│  └──────────────────────────────────────────────────────────────┘           │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────┐           │
│  │  用户评价区域                                                 │           │
│  └──────────────────────────────────────────────────────────────┘           │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────┐           │
│  │  推荐模板                                                     │           │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐             │           │
│  │  │PPT1 │ │PPT2 │ │PPT3 │ │🎯原生│ │PPT4 │ │PPT5 │ ← 广告位 #6 │           │
│  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘             │           │
│  └──────────────────────────────────────────────────────────────┘           │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────┐           │
│  │  📢 MultiplexAd (multiplex, 280px) ← 广告位 #7                │           │
│  └──────────────────────────────────────────────────────────────┘           │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────┐           │
│  │  相关推荐                                                     │           │
│  └──────────────────────────────────────────────────────────────┘           │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 PPT 分类页 (`/ppt/category/[name]`)

```
┌──────────────────────────────────────────────────────────────────────────────┐
│  PPT 分类页广告布局                                                           │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  分类 Hero 区域 (分类名称、描述、统计)                              │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  📢 BlogBannerAd (horizontal, 90px) ← 广告位 #8                     │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  精选 PPT (Featured)                                                │     │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐   │     │
│  │  │PPT1 │ │PPT2 │ │PPT3 │ │PPT4 │ │PPT5 │ │🎯原生│ │PPT6 │ │PPT7 │   │     │
│  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘   │     │
│  │                                        ↑ 广告位 #9 (第 6 位)        │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  全部 PPT (All)                                                     │     │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐   │     │
│  │  │PPT1 │ │PPT2 │ │PPT3 │ │PPT4 │ │PPT5 │ │🎯原生│ │PPT6 │ │PPT7 │   │     │
│  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘   │     │
│  │                                        ↑ 广告位 #10 (第 6 位)       │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 PPT 分类总览页 (`/ppt/categories`)

```
┌──────────────────────────────────────────────────────────────────────────────┐
│  PPT 分类总览页广告布局                                                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  页面标题 + 描述                                                    │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  分类网格 (6 个分类卡片)                                            │     │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐                               │     │
│  │  │ 商务演示 │ │ 教育培训 │ │ 创意设计 │                               │     │
│  │  └─────────┘ └─────────┘ └─────────┘                               │     │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐                               │     │
│  │  │科技互联网│ │ 营销推广 │ │ 通用模板 │                               │     │
│  │  └─────────┘ └─────────┘ └─────────┘                               │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  📢 BlogBannerAd (horizontal, 90px) ← 广告位 #11                    │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  精选模板 (Featured)                                                │     │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐   │     │
│  │  │PPT1 │ │PPT2 │ │PPT3 │ │PPT4 │ │PPT5 │ │🎯原生│ │PPT6 │ │PPT7 │   │     │
│  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘   │     │
│  │                                        ↑ 广告位 #12 (第 6 位)       │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 三、详细设计

### 3.1 原生广告组件迁移

**源文件**: `vo-ui-code-pro/v0mksaaspptsite/components/ads/native-ad-card.tsx`
**目标文件**: `src/components/ads/native-ad-card.tsx`

```typescript
// 迁移后的组件结构
'use client';

import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardFooter } from '@/components/ui/card';
import { cn } from '@/lib/utils';
import { ExternalLink } from 'lucide-react';
import { useEffect, useRef, useState } from 'react';

// ... 组件实现 (见源文件)

// Mock 数据 - 用于开发测试
export const mockNativeAd: NativeAdData = {
  id: 'ad_001',
  imageUrl: '/placeholder.svg?height=200&width=320&text=Ad+Image',
  headline: '提升团队协作效率的最佳工具',
  description: '超过100万团队正在使用，免费试用30天',
  advertiser: 'Notion',
  logoUrl: '/placeholder.svg?height=40&width=40&text=Logo',
  clickUrl: 'https://example.com/landing',
  callToAction: '免费试用',
};
```

### 3.2 原生广告插入逻辑

```typescript
// 通用的原生广告插入函数
function insertNativeAd<T>(
  items: T[],
  position: number,
  adComponent: React.ReactNode
): (T | null)[] {
  const result = [...items];
  if (result.length >= position) {
    result.splice(position, 0, null); // null 表示广告位
  }
  return result;
}

// 渲染网格时的使用方式
const renderPPTGrid = (ppts: PPT[], adPosition: number, adKey: string) => {
  const items = insertNativeAd(ppts, adPosition, null);

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      {items.map((ppt, index) => {
        if (ppt === null) {
          return (
            <NativeAdCard
              key={`native-ad-${adKey}`}
              ad={mockNativeAd}
              position={adKey}
              onImpression={(adId) => console.log('Impression:', adId)}
              onClick={(adId) => console.log('Click:', adId)}
            />
          );
        }
        return <PPTCard key={ppt.id} {...ppt} />;
      })}
    </div>
  );
};
```

### 3.3 各页面修改详情

#### PPT 首页 (`/ppt/page.tsx`)

```typescript
import { BlogBannerAd } from '@/components/ads';
import { NativeAdCard, mockNativeAd } from '@/components/ads/native-ad-card';

// 1. 热门分类后添加横幅广告
{!hasSearched && (
  <section className="container mx-auto mb-8 px-4">
    <BlogBannerAd />
  </section>
)}

// 2. 精选模板网格 - 第 5 位插入原生广告
const renderFeaturedGrid = () => {
  const items = [...featuredPpts];
  if (items.length >= 4) {
    items.splice(4, 0, null); // 第 5 位
  }
  // ... 渲染逻辑
};

// 3. 搜索结果 - 上方横幅 + 第 5、11 位原生广告
{hasSearched && (
  <>
    <BlogBannerAd className="mb-8" />
    {renderSearchResults()}
  </>
)}
```

#### PPT 详情页 (`/ppt/[id]/page.tsx`)

```typescript
import { BlogBannerAd, MultiplexAd } from '@/components/ads';
import { NativeAdCard, mockNativeAd } from '@/components/ads/native-ad-card';

// 1. 替换占位符为 BlogBannerAd
<BlogBannerAd className="my-12" />

// 2. 推荐模板网格 - 第 4 位插入原生广告
const renderRecommendedGrid = () => {
  const items = [...recommendedPpts];
  if (items.length >= 3) {
    items.splice(3, 0, null); // 第 4 位
  }
  // ... 渲染逻辑
};

// 3. 推荐模板后添加 MultiplexAd
<MultiplexAd className="my-8" />
```

#### PPT 分类页 (`/ppt/category/[name]/page.tsx`)

```typescript
import { BlogBannerAd } from '@/components/ads';
import { NativeAdCard, mockNativeAd } from '@/components/ads/native-ad-card';

// 1. Hero 后添加横幅广告
<BlogBannerAd className="mb-8" />

// 2. 精选 PPT 网格 - 第 6 位插入原生广告
// 3. 全部 PPT 网格 - 第 6 位插入原生广告
```

#### PPT 分类总览页 (`/ppt/categories/page.tsx`)

```typescript
import { BlogBannerAd } from '@/components/ads';
import { NativeAdCard, mockNativeAd } from '@/components/ads/native-ad-card';

// 1. 分类网格后添加横幅广告
<BlogBannerAd className="my-8" />

// 2. 精选模板网格 - 第 6 位插入原生广告
```

---

## 四、错误预防措施

### 4.1 SSR/CSR 兼容性

原生广告组件使用 `'use client'` 指令，内部使用 IntersectionObserver 需要在客户端执行：

```typescript
useEffect(() => {
  if (!cardRef.current || hasTrackedImpression) return;

  const observer = new IntersectionObserver(/* ... */);
  observer.observe(cardRef.current);

  return () => observer.disconnect();
}, [/* deps */]);
```

### 4.2 暗色主题适配

原生广告组件已使用主题感知的 CSS 类：
- `bg-muted` → 适配暗色主题
- `text-muted-foreground` → 适配暗色主题
- `hover:border-primary` → 适配主题色

### 4.3 广告标识

原生广告必须显示 "广告" 标识，符合广告法规：

```tsx
<Badge
  variant="secondary"
  className="absolute left-2 top-2 bg-black/60 text-white text-xs"
>
  广告
</Badge>
```

---

## 五、测试验证

### 5.1 开发环境验证

1. 启动开发服务器: `pnpm dev`
2. 访问各 PPT 页面验证广告显示
3. 验证原生广告与 PPTCard 样式一致
4. 验证暗色主题下所有广告可见

### 5.2 广告追踪验证

1. 打开浏览器控制台
2. 滚动页面使原生广告 50% 可见
3. 验证控制台输出 "Impression: ad_001"
4. 点击原生广告
5. 验证控制台输出 "Click: ad_001"

---

## 六、风险评估

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 广告影响页面加载速度 | 低 | 中 | 懒加载已实现 |
| 广告影响用户体验 | 中 | 中 | 原生广告融入内容，影响小 |
| 原生广告样式不一致 | 低 | 中 | 复用 Card 组件，保持一致 |
| 广告追踪失败 | 低 | 低 | 追踪失败不影响广告显示 |
| CLS 问题 | 低 | 中 | 固定尺寸占位已实现 |
