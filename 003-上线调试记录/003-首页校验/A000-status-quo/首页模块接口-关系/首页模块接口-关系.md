# 首页模块接口-关系（当前状态）

> 导出时间: 2025-12-06（代码同步至当前迭代）
> 范围: 首页搜索/分类/列表链路（App Router + Server Actions + API）

---

## 数据/接口关系概览

```
┌──────────────────────────────────────────────┐
│                  Frontend                    │
│  - /ppt (首页)                                │
│  - /ppt/categories (分类页)                   │
│  - 组件: SearchFilters, PPTCard 等            │
└───────────────┬──────────────────────────────┘
                │ fetch /api/ppts
                ▼
┌──────────────────────────────────────────────┐
│                  API Route                   │
│  GET /api/ppts?search&category&sort&page     │
│  - 校验: PPT_CATEGORY_VALUES (12 类)         │
│  - 透传: search/title/author/tags ilike      │
└───────────────┬──────────────────────────────┘
                │ calls getPPTs
                ▼
┌──────────────────────────────────────────────┐
│                Server Action                 │
│  getPPTs (src/actions/ppt/ppt.ts)            │
│  - buildWhere: title/author/tags ilike       │
│  - DTO: tags/language 映射，description=title│
│         file_size='未知'                      │
└───────────────┬──────────────────────────────┘
                │ Drizzle ORM
                ▼
┌──────────────────────────────────────────────┐
│                 Database (ppt)               │
│  id, title, category, tags[], language       │
│  file_url, cover_image_url, thumbnail_url    │
│  download_count, view_count, created_at ...  │
└──────────────────────────────────────────────┘
```

---

## 关键接口与参数

- **GET `/api/ppts`**
  - `search`: 关键字，匹配 title/author/tags（ilike）
  - `category`: slug，校验于 `PPT_CATEGORY_VALUES`（12 类）
  - `sortBy`: `created_at`/`downloads`/`title`（默认 created_at）
  - `sortOrder`: `asc`/`desc`
  - `page`/`pageSize`: 分页，pageSize 上限 50

- **Server Action `getPPTs`**
  - DTO 映射：
    - `tags`: `row.tags ?? []`
    - `language`: `row.language ?? ''`
    - `description`: `row.title`
    - `file_size`: `'未知'`（DB 无该列）
    - `preview_url`: `thumbnailUrl || coverImageUrl`

- **前端依赖**
  - 分类源：`src/lib/constants/ppt.ts`（12 类）→ 首页/分类页/筛选
  - 语言/排序源：`PPT_LANGUAGES`，`PPT_SORTS`

---

## 现存限制/待办

- 搜索仅简单 ilike，未做分词/权重排序。
- `file_size` 缺真实字段，前端显示“未知”。
- `preview_url` 与 `previewUrl` 混用，需统一。
- 重复类型/Schema 仍在（`src/types/ppt.ts`, `src/schemas/ppt.ts` 等）待清理。

---

## 参考文件

- `src/lib/constants/ppt.ts`（分类/语言/排序常量，12 类）
- `src/actions/ppt/ppt.ts`（getPPTs 实现）
- `src/app/api/ppts/route.ts`（API Route 参数校验与透传）
- `src/app/[locale]/(marketing)/ppt/page.tsx`（首页）
- `src/app/[locale]/(marketing)/ppt/categories/page.tsx`（分类页）
- `src/components/ppt/search-filters.tsx`（筛选组件）
