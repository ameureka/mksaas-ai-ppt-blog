# 登录/注册组件设计笔记

## 设计原理
- 使用 Better Auth 作为认证核心，前端通过 `authClient` 调用 `/api/auth/[...all]`。
- 表单：`react-hook-form` + `zod` 校验，多语言文案走 `next-intl`，元数据用 `constructMetadata`。
- Turnstile 验证可选：由 `websiteConfig.features.enableTurnstileCaptcha` + `NEXT_PUBLIC_TURNSTILE_SITE_KEY` 控制，服务端验证在 `validate-captcha` → `validateTurnstileToken`。
- 登录/注册、社交登录（Google/GitHub）开关通过 `websiteConfig.auth` 配置；注册要求邮箱验证（见 `src/lib/auth.ts` 配置和邮件发送钩子）。

## 位置
- 页面：`src/app/[locale]/auth/login/page.tsx`、`src/app/[locale]/auth/register/page.tsx`。
- 表单组件：`src/components/auth/login-form.tsx`、`src/components/auth/register-form.tsx`。
- 辅助组件：社交登录 `src/components/auth/social-login-button.tsx`，验证码 `src/components/shared/captcha.tsx`，卡片框架 `src/components/auth/auth-card.tsx`。
- 服务端配置：`src/lib/auth.ts`（Better Auth + Drizzle + 邮件 + Hook），客户端实例：`src/lib/auth-client.ts`。
- API 入口：`src/app/api/auth/[...all]/route.ts`。

## 使用方式
- 页面直接渲染 `<LoginForm />` 或 `<RegisterForm />`，可传 `callbackUrl` 或 URL `?callbackUrl=`，默认跳转 `websiteConfig.routes.defaultLoginRedirect`，自动带当前 locale。
- 社交登录通过 `<SocialLoginButton callbackUrl="..." />` 复用，显示取决于配置。
- Turnstile 开启后表单会要求完成验证码；未配置 site key 会打印错误并跳过渲染。

## 已修复问题
- `src/components/ppt/auth/login-modal.tsx` 的“去注册”跳转路径已改为使用路由常量并附带当前 locale，避免指向不存在的 `/auth/sign-in`。

## 测试建议
- 在 `/auth/register`、`/auth/login` 走邮箱密码流；开启/关闭 Turnstile 验证。
- 测试社交登录（需配置对应环境变量）。
- 在 PPT 详情页触发登录弹窗后点击“去注册”，确认跳转到正确语言的登录页。
