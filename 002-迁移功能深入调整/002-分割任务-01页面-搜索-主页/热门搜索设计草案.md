# /ppt 热门搜索设计草案 (V2.0)

> **文档状态**: 2025-11-28 已更新
> **当前策略**: V1 版本使用静态配置，V2 版本接入真实统计。

## 1. 现状与 V1 策略
目前 `/ppt` 首页的“热门搜索”是硬编码在前端的静态数据。

**V1 实施方案 (本次改造)**:
- 保持 **静态配置**，但将其移至统一的常量文件 `src/lib/constants/ppt.ts`。
- 不引入数据库写入，避免增加 V1 版本的复杂度。
- 常量定义：
  ```typescript
  export const HOT_KEYWORDS = [
    { text: '年终总结', size: 'large' },
    { text: '工作汇报', size: 'medium' },
    { text: '项目提案', size: 'large' },
    { text: '述职报告', size: 'small' },
    { text: '商业计划', size: 'medium' },
    { text: '培训课件', size: 'small' },
    { text: '产品介绍', size: 'medium' },
    { text: '营销方案', size: 'small' },
  ] as const;
  ```

---

## 2. V2 统计方案 (未来规划)

### 2.1 数据模型 (search_log)
未来引入 `search_log` 表用于记录用户搜索行为。

```typescript
// src/db/schema.ts (Future)
export const searchLog = pgTable("search_log", {
  id: uuid("id").defaultRandom().primaryKey(),
  keyword: text("keyword").notNull(), // 已标准化 (trim, lower)
  count: integer("count").default(1), // 搜索次数
  lastSearchedAt: timestamp("last_searched_at").defaultNow(),
});
```
*采用 "Upsert" 策略*: 每次搜索时，如果关键词存在则 `count + 1`，否则插入新记录。

### 2.2 接口形态
- **Server Action**: `recordSearch(keyword: string)`
  - 在 `getPPTs` 内部异步调用，不阻塞主查询返回。
  - 包含简单的防刷逻辑 (如限制关键词长度)。

### 2.3 读接口
- **Server Action**: `getHotKeywords(limit: number = 10)`
  - SQL: `SELECT keyword FROM search_log ORDER BY count DESC LIMIT 10`
  - 缓存: 结果应缓存 1-24 小时 (Redis 或 Next.js Cache)。

---

## 3. 决策记录
- **Why Static Now?**: 当前数据库无搜索日志表，且流量较小，真实统计可能导致榜单空白或充满测试数据。静态榜单能保证初始的用户体验和引导效果。
- **Migration Path**: 
    1. 建立 `search_log` 表。
    2. 在 `src/actions/ppt/ppt.ts` 的 `getPPTs` 中埋点调用 `recordSearch`。
    3. 积累数据一周后，将前端 `HOT_KEYWORDS` 替换为 `await getHotKeywords()` 调用。

---