# Gemini Image3 封面与配图生成方案（最终版 v2.0）

> 更新时间：2025-12-06
> 状态：✅ 已实现 (v2.0 优化版)

---

## 一、方案概览

| 项目 | 说明 |
|------|------|
| 目标 | 为 100 篇中文博文生成内容强关联的封面（内页可选） |
| 工具 | Gemini 网页/客户端（手工复制粘贴，无 API） |
| 产出 | 默认 100 张封面；内页按需开启（最多 3/篇） |
| 核心特点 | **Content-Aware (内容感知)** + **Auto-Mapping (自动分类)** + **SEO-Friendly (英文Slug)** |
| 预计时间 | 封面批量约 2-3 小时（手工操作时间） |

---

## 二、核心升级 (v2.0 Highlights)

### ✅ 1. 统一配置源 (Single Source of Truth)
废弃了旧的 `category-styles.ts`，全面迁移至 **`config/category-config.ts`**。该文件统一管理了分类的名称、Slug、配色、风格描述、Prompt 关键词等所有信息，消除了配置不一致的隐患。

### ✅ 2. 智能目录映射 (Auto Directory Mapping)
脚本不再依赖不准确的 MDX frontmatter `categories` 字段，而是**直接解析文件所在的子目录**，自动映射到正确的 PPT 分类：
- `商务汇报PPT/` → `business`
- `年终总结PPT/` → `year-end`
- `产品营销与营销方案PPT/` → `marketing`
- ... (共 8 个映射规则)

### ✅ 3. SEO 友好 Slug 自动生成
脚本内置了翻译映射表，能自动将中文文件名（如“下载产品营销PPT模板.mdx”）转换为**规范的英文 Slug**（如 `download-product-marketing-ppt-template`），解决了中文 URL 编码问题，有利于 SEO。

---

## 三、实施细节

### 3.1 分类体系 (Category System)

| 英文 Slug | 中文名称 | 配色方案 | 风格关键词 |
| :--- | :--- | :--- | :--- |
| **`business`** | 商务汇报 | 深蓝/灰/白 | 极简网格、数据卡片 |
| **`education`** | 教育培训 | 绿/蓝/黄 | 明快高对比、插画 |
| **`general`** | 通用技巧 | 蓝/绿/黄 | 多功能、实用 |
| **`marketing`** | 产品营销 | 粉/紫/青 | 高对比、渐变霓虹 |
| **`paid-search`** | 付费搜索 | 紫/粉/青 | 现代、资源导向 |
| **`year-end`** | 年终总结 | 暖橙/金/米 | 时间线、稳重 |
| **`proposal`** | 项目提案 | 蓝/绿/白 | 创新、技术感 |
| **`report`** | 述职报告 | 深灰/石墨/白 | 专业、稳重 |

### 3.2 文件规范

| 类型 | 格式 | 尺寸 | 命名示例 |
|------|------|------|----------|
| 封面 | JPG | 1200×630 | `product-marketing-guide-cover.jpg` |
| 内页 | PNG | 1000×600 | `product-marketing-guide-1.png` |

**存储路径**：
- 临时：`draft-code/generated-images/{category}/`
- 最终：`public/images/blog/`

---

## 四、Prompt 策略 (Content-Aware)

### 4.1 封面 Prompt 逻辑
```typescript
// 伪代码逻辑
Prompt = Template
  .replace(title, MDX标题)
  .replace(shortTitle, 提取的核心词)
  .replace(keywords, [文章关键词 + 分类关键词])
  .replace(style, CategoryConfig.style)
  .replace(palette, CategoryConfig.palette)
  .replace(elements, CategoryConfig.elements)
```

### 4.2 封面 Prompt 模板 (最终版)
```
你是专业平面设计师，请生成 1200x630 的博客封面图。

【文章主题】{title}
【短标题】{shortTitle}
【关键词】{keywords}
【需渲染文字】{textToRender}
【风格】{styleHint}
【配色】{palette}
【画面元素】{sceneElements}

【设计要求】
- 标题文字居中或居左，字号大，对比度高，清晰可读
- 背景简洁，留白充足，便于阅读
- 风格符合 {category} 分类特点
- 无水印，无多余文字，高清输出
- 构图平衡，视觉焦点明确

【构图建议】
- 主体元素占画面 40-50%
- 文字区域留白 15-20%
- 整体简洁专业
```

---

## 五、执行指南

### 5.1 生成 Prompt 清单
```bash
cd draft-code
# 一键生成：扫描目录 -> 映射分类 -> 转换Slug -> 生成Prompt
npx tsx scripts/image-pipeline/generate-prompts.ts

# 导出为 Markdown 方便复制
npx tsx scripts/image-pipeline/export-pending.ts
```

### 5.2 手工生成流程 (Human-in-the-Loop)
1. 打开 `data/pending-prompts.md`。
2. 复制一段 Prompt。
3. 在 Gemini 网页版粘贴并生成。
4. 下载满意的图片。
5. **重命名**为清单中指定的英文文件名（例如 `download-ppt-template-cover.jpg`）。
6. 保存到分类文件夹中。

### 5.3 质量检查标准
- [ ] 尺寸正确 (1200x630)
- [ ] 文字清晰可读 (短中文标题)
- [ ] 风格符合分类定义 (如商务类应为深蓝/灰色调)
- [ ] 无水印、无乱码

---

## 六、文件结构

```
draft-code/
├── config/
│   ├── category-config.ts      # ✅ 核心配置：分类、配色、风格、关键词
│   └── prompt-templates.ts     # ✅ Prompt 模板与生成逻辑
├── scripts/image-pipeline/
│   ├── generate-prompts.ts     # ✅ 主脚本：目录扫描、Slug转换、JSON生成
│   ├── export-pending.ts       # ✅ 导出脚本：生成 Markdown 清单
│   └── types.ts                # 类型定义
├── data/
│   ├── image-tasks.json        # 结构化任务数据 (包含 Slug 和 Prompt)
│   └── pending-prompts.md      # 待执行清单 (直接用于生成)
└── generated-images/           # 图片产出目录
```