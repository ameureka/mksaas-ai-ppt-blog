# Gemini 图片生成流水线 - 统一设计方案

> 更新时间：2025-12-02
> 状态：✅ Phase 1 已实现
> 合并自：gemini-cli-pipeline-design.md、gemini-image3-补充设计.md、gemni-nanobanana-design.md

---

## 一、方案概览

| 项目 | 说明 |
|------|------|
| 目标 | 为 100 篇博文生成内容强关联的配套图片 |
| 工具 | Gemini 网页/客户端（手工复制粘贴，无 API） |
| 产出 | 491 张图片（100 封面 + 391 内页） |
| 核心特点 | Prompt 与文章内容深度关联（Content-Aware），非通用模板 |
| 预计时间 | 17-20 小时 |

---

## 二、流水线架构

```
┌─────────────────────────────────────────────────────────────────┐
│              Gemini 手工图片生成流水线                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Phase 1: 内容分析与 Prompt 生成（脚本自动）                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ MDX 文件    │    │ 内容分析器  │    │ Prompt      │         │
│  │ (100篇)     │ -> │ ・标题提取  │ -> │ 生成器      │         │
│  │             │    │ ・H2 解析   │    │ ・封面      │         │
│  │             │    │ ・段落分析  │    │ ・内页×3+   │         │
│  │             │    │ ・关键词    │    │             │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│        +                   │                   │                │
│  ┌─────────────┐           │                   v                │
│  │ 分类风格    │           │           ┌─────────────┐         │
│  │ 配置        │ ----------┘           │ 输出文件    │         │
│  │ (category-  │                       │ ・prompts.md│         │
│  │  styles.ts) │                       │ ・progress  │         │
│  └─────────────┘                       │ ・tasks.json│         │
│                                        └─────────────┘         │
│                                                                 │
│  Phase 2: 图片生成（人工执行）                                   │
│  ┌─────────────────────────────────────────────────────┐       │
│  │   ┌──────────┐    ┌──────────┐    ┌──────────┐     │       │
│  │   │ 复制     │ -> │ Gemini   │ -> │ 筛选     │     │       │
│  │   │ Prompt   │    │ 网页生成 │    │ 下载命名 │     │       │
│  │   └──────────┘    └──────────┘    └──────────┘     │       │
│  │        ^                                 │          │       │
│  │        │         ┌──────────┐            │          │       │
│  │        └─────────│ 进度追踪 │<───────────┘          │       │
│  │                  │ 标记完成 │                       │       │
│  │                  └──────────┘                       │       │
│  │   按分类批次执行（保持风格一致）                      │       │
│  └─────────────────────────────────────────────────────┘       │
│                                                                 │
│  Phase 3: 后处理（脚本自动）                                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ 图片压缩    │ -> │ 复制到      │ -> │ 更新 MDX    │         │
│  │ JPG<200KB   │    │ public/     │    │ ・封面路径  │         │
│  │ PNG<150KB   │    │ images/blog │    │ ・内页引用  │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│                                                                 │
│  Phase 4: 验收（脚本自动）                                       │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ blog:audit  │ -> │ 检查清零    │ -> │ mediaStatus │         │
│  │             │    │ ・no_cover  │    │ = done      │         │
│  │             │    │ ・few_images│    │             │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 三、Phase 1: 内容分析与 Prompt 生成

### 3.1 内容分析流程

```
输入：MDX 文件
┌─────────────────────────────────────────────────────┐
│ ---                                                 │
│ title: "产品营销PPT一般包含哪些内容"                 │
│ description: "详解产品营销PPT的核心组成..."          │
│ categories: ["marketing"]                           │
│ tags: ["产品营销", "PPT结构"]                        │
│ ---                                                 │
│                                                     │
│ ## 市场分析与用户画像                                │
│ 分析目标市场规模、用户需求...                        │
│                                                     │
│ ## 产品卖点与竞争优势                                │
│ 突出产品核心功能、差异化优势...                      │
└─────────────────────────────────────────────────────┘
                        │
                        v
分析步骤：
1. 解析 Frontmatter
   ├── title → 提取短标题（4-6字）
   ├── categories → 查找风格配置
   ├── tags → 补充关键词
   └── description → 提取画面元素

2. 解析正文 H2 结构
   ├── 提取所有 ## 标题
   ├── 过滤通用标题（FAQ/总结/结语）
   └── 取前 3-4 个作为内页场景

3. 分析段落类型（内容感知）
   ├── 检测列表 → 清单卡片图
   ├── 检测步骤 → 流程图
   ├── 检测数据 → 图表
   ├── 检测对比 → 对比图
   └── 其他 → 概念图

4. 提取关键词
   ├── 从 H2 标题提取
   ├── 从段落高频词提取
   └── 映射为画面元素
                        │
                        v
输出：ArticleAnalysis 对象
{
  slug: "product-marketing-ppt-content",
  title: "产品营销PPT一般包含哪些内容",
  shortTitleZh: "产品营销PPT",
  shortTitleEn: "Product Marketing PPT",
  category: "marketing",
  style: { colors, elements, tone },
  coverKeywords: ["产品营销", "PPT结构", "内容"],
  coverElements: ["产品展示", "结构框架", "模块"],
  sections: [
    { h2: "市场分析与用户画像",
      type: "chart",
      elements: ["饼图", "用户画像", "数据"] },
    { h2: "产品卖点与竞争优势",
      type: "cards",
      elements: ["功能卡片", "对比", "优势"] },
    ...
  ]
}
```

### 3.2 分类风格配置

| 分类 | slug | 短中文 | 短英文 | 配色 | 风格 | 典型元素 |
|------|------|--------|--------|------|------|----------|
| 商务汇报 | business | 商务汇报PPT | Business Report | 深蓝#1E3A5F + 灰#E2E8F0 + 白 | 极简网格、科技光影 | 数据看板、折线图、会议室 |
| 年终总结 | year-end | 年终总结PPT | Year-End Summary | 暖橙#DD6B20 + 金#F6E05E + 米 | 时间线、稳重、成就感 | 里程碑、图表、日历、奖杯 |
| 教育培训 | education | 教育培训PPT | Education Training | 绿#38A169 + 蓝#3182CE + 黄 | 明快、高对比、插画 | 书本、课堂、学生、卡片 |
| 产品营销 | marketing | 产品营销PPT | Product Marketing | 粉#D53F8C + 紫#805AD5 + 青#38B2AC | 高对比、渐变霓虹 | 营销漏斗、产品展示、数据 |
| 项目提案 | proposal | 项目提案PPT | Project Proposal | 蓝#2B6CB0 + 绿#38A169 + 白 | 创新、前瞻、技术感 | 灯泡、路线图、里程碑 |
| 述职报告 | report | 述职报告PPT | Work Report | 深灰#2D3748 + 石墨#4A5568 + 白 | 专业、稳重、成就导向 | 职业成长、成果图表 |
| 通用技巧 | general | PPT技巧 | PPT Tips | 蓝#4299E1 + 绿#48BB78 + 黄 | 多功能、信息图 | 工具、流程、清单、技巧 |
| 模板技巧 | tips | 模板技巧 | Template Tips | 紫#9F7AEA + 粉#ED64A6 + 青 | 现代、资源导向 | 搜索框、锁/徽章、模板 |

### 3.3 段落类型判断规则（内容感知）

| 检测特征 | 图片类型 | 画面元素建议 |
|----------|----------|--------------|
| 包含"步骤"、"流程"、"第一步"、"首先"、"顺序" | 流程图 (flow) | 箭头、步骤卡片、数字标记、流程线 |
| 包含"对比"、"vs"、"区别"、"不同"、"选择" | 对比图 (compare) | 左右分栏、对比表格、VS符号 |
| 包含数字、百分比、"数据"、"统计"、"ROI" | 数据图表 (chart) | 饼图、柱状图、趋势线、数据标签 |
| 包含列表、"要点"、"清单"、"技巧"、"tips" | 清单卡片 (cards) | 卡片组、图标列表、勾选标记 |
| 包含"案例"、"示例"、"场景"、"演示" | 场景示意 (scene) | 具体场景插画、人物、环境 |
| 其他 | 概念图 (concept) | 抽象元素、图标组合、概念可视化 |

### 3.4 内容感知元素映射（35 条规则）

根据段落内容关键词，自动匹配画面元素：

| 类别 | 关键词 | 对应元素 |
|------|--------|----------|
| **品牌视觉** | Logo、标识、品牌、VI | Logo图标、品牌标识、替换示意 |
| | 配色、颜色、色彩、主色 | 调色板、颜色对比、配色方案、取色器 |
| | 字体、排版、字号、文字 | 字体样式、排版对比、文字示例、字号标注 |
| | 截图、界面、产品图、屏幕 | 界面截图、产品展示、屏幕框、软件界面 |
| | 图标、插画、icon | 图标库、插画风格、视觉元素、图形符号 |
| | 模板、母版、版式、布局 | 模板预览、版式结构、布局示意、页面框架 |
| **数据图表** | 图表、数据、统计、分析 | 数据图表、统计图、数据看板、趋势线 |
| | 时间线、里程碑、进度、阶段 | 时间线、里程碑、进度条、节点标记 |
| | 增长、下降、趋势、变化 | 趋势曲线、增长箭头、数据变化图 |
| | 百分比、占比、比例 | 饼图、环形图、比例条、占比标注 |
| **人物角色** | 用户、受众、客户、人群 | 用户画像、人物图标、受众分析、人群标签 |
| | 新人、新手、入门、初学 | 新人图标、入门标识、学习者形象、成长符号 |
| | 主管、领导、管理、经理 | 管理者图标、领导形象、决策者符号、层级示意 |
| | 团队、协作、合作、沟通 | 团队图标、协作示意、沟通场景、讨论图 |
| | 演讲、汇报、展示、演示 | 演讲场景、演讲人、大屏展示、听众 |
| **业务场景** | 转化、漏斗、路径、渠道 | 转化漏斗、路径图、流程箭头、渠道示意 |
| | 目标、成果、KPI、指标 | 目标图标、成果展示、达成标记、指标卡片 |
| | 会议、会议室、开会 | 会议室、会议桌、白板、投影 |
| | 课堂、培训、教学、学习 | 课堂场景、培训图标、学习元素、教学示意 |
| | 项目、提案、方案、计划 | 项目图标、方案文档、计划表、提案符号 |
| **对比选择** | vs、对比、比较、差异 | VS符号、左右对比、差异标注、对比箭头 |
| | 选择、挑选、筛选、决策 | 选择图标、筛选漏斗、决策树、选项卡片 |
| | 优势、劣势、优点、缺点 | 优劣对比、加减符号、评分星级、对比表格 |
| **结构框架** | 结构、框架、架构、体系 | 结构图、框架示意、层级关系、架构图 |
| | 清单、列表、要点、条目 | 清单图标、勾选标记、条目列表、要点卡片 |
| | 章节、目录、大纲、提纲 | 目录结构、章节标记、大纲图、层级列表 |
| **年终特有** | 年终、年度、全年、一年 | 年度日历、12月时间轴、年度总结图、年份标记 |
| | 总结、复盘、回顾、盘点 | 总结图标、复盘箭头、回顾时间线、盘点清单 |
| | 成长、提升、进步、突破 | 成长曲线、上升箭头、进步阶梯、突破符号 |
| | 证明、展示、呈现、体现 | 证据图标、展示框、呈现箭头、证明标记 |
| **营销特有** | 卖点、亮点、特色、优势 | 卖点标签、亮点星标、特色图标、优势徽章 |
| | 营销、推广、宣传、广告 | 营销漏斗、推广图标、宣传喇叭、广告牌 |
| | 产品、功能、特性、服务 | 产品图标、功能模块、特性卡片、服务图示 |
| **教育特有** | 知识、概念、原理、理论 | 知识图标、概念图、原理示意、理论框架 |
| | 练习、实践、操作、动手 | 练习图标、实践场景、操作步骤、动手示意 |
| | 问题、疑问、困惑、难点 | 问号图标、疑问符号、困惑表情、难点标记 |

---

## 四、Prompt 模板

### 4.1 封面 Prompt 模板（中文版）

```
你是专业平面设计师，请生成 1200x630 的博客封面图。

【文章主题】{title}
【短标题】{shortTitle}
【关键词】{keywords}
【需渲染文字】{textToRender}
【风格】{styleHint}
【配色】{palette}
【画面元素】{sceneElements}

【设计要求】
- 标题文字居中或居左，字号大，对比度高，清晰可读
- 背景简洁，留白充足，便于阅读
- 风格符合 {category} 分类特点
- 无水印，无多余文字，高清输出
- 构图平衡，视觉焦点明确

【构图建议】
- 主体元素占画面 40-50%
- 文字区域留白 15-20%
- 整体简洁专业
```

### 4.2 封面 Prompt 模板（英文版）

```
You are a professional graphic designer. Generate a 1200x630 blog cover image.

【Topic】{title}
【Short Title】{shortTitle}
【Keywords】{keywords}
【Text to Render】{textToRender}
【Style】{styleHint}
【Color Palette】{palette}
【Visual Elements】{sceneElements}

【Design Requirements】
- Title text centered or left-aligned, large font, high contrast, clearly readable
- Clean background, ample whitespace, easy to read
- Style matches {category} category characteristics
- No watermark, no extra text, high-quality output
- Balanced composition, clear visual focus

【Composition】
- Main elements occupy 40-50% of the canvas
- Text area whitespace 15-20%
- Overall clean and professional
```

### 4.3 内页 Prompt 模板

```
生成 1000x600 的信息图/情景图。

【场景】{scene}
【类型】{sceneType}
【画面元素】{elements}
【风格】{styleHint}
【配色】{palette}

【要求】
- 清晰、简洁、无水印
- 文字极少（仅短标签）
- 适合博客正文插图
- 与封面风格一致
- 信息传达准确
```

### 4.4 文字渲染策略

| 策略 | 说明 | 适用场景 |
|------|------|----------|
| short-zh | 渲染短中文标题（4-6字） | 默认，AI 通常能写对 |
| english | 渲染英文标题 | 国际化版本 |
| blank | 留白不渲染文字 | 后期叠加中文标题 |

**注意**：AI 渲染长中文句子错误率高，建议使用短标题或留白策略。

---

## 五、Phase 2: 图片生成（人工执行）

### 5.1 分批执行计划

| 批次 | 分类 | 篇数 | 封面 | 内页 | 总图片 | 预计时间 |
|------|------|------|------|------|--------|----------|
| 1 | 商务汇报 | 10 | 10 | ~40 | ~50 | 1.7h |
| 2 | 年终总结 | 11 | 11 | ~44 | ~55 | 1.8h |
| 3 | 教育培训 | 11 | 11 | ~44 | ~55 | 1.8h |
| 4 | 产品营销 | 10 | 10 | ~40 | ~50 | 1.7h |
| 5 | 述职报告 | 10 | 10 | ~40 | ~50 | 1.7h |
| 6 | 项目提案 | 7 | 7 | ~28 | ~35 | 1.2h |
| 7 | 通用技巧 | 23 | 23 | ~92 | ~115 | 3.8h |
| 8 | 模板技巧 | 18 | 18 | ~72 | ~90 | 3h |
| **总计** | | **100** | **100** | **~391** | **~491** | **~17h** |

### 5.2 单张图操作流程

```
1. 打开 pending-prompts.md
   └── 找到当前文章区块

2. 复制 Prompt
   └── 选中代码块内容，Ctrl+C

3. 粘贴到 Gemini 网页
   └── 打开 gemini.google.com，粘贴，回车

4. 等待生成
   └── 通常 10-30 秒

5. 筛选结果
   ├── 满意 → 继续
   └── 不满意 → 点"重新生成" 或 微调 Prompt

6. 下载图片
   └── 右键保存 / 点下载按钮

7. 按规则命名
   ├── 封面：{slug}-cover.jpg
   └── 内页：{slug}-{n}.png

8. 放入目录
   └── generated-images/{category}/

9. 更新进度
   └── 在 image-tasks.json 标记状态

10. 继续下一张
```

### 5.3 文件命名规则

| 类型 | 格式 | 尺寸 | 示例 |
|------|------|------|------|
| 封面 | {slug}-cover.jpg | 1200×630 | ppt-marketing-guide-cover.jpg |
| 内页 1 | {slug}-1.png | 1000×600 | ppt-marketing-guide-1.png |
| 内页 2 | {slug}-2.png | 1000×600 | ppt-marketing-guide-2.png |
| 内页 3 | {slug}-3.png | 1000×600 | ppt-marketing-guide-3.png |

### 5.4 质量检查清单

| 检查项 | 封面 | 内页 |
|--------|------|------|
| 尺寸正确 | 1200×630 | 1000×600 |
| 文字清晰可读 | ✓ | 极少/无 |
| 风格符合分类 | ✓ | ✓ |
| 无水印 | ✓ | ✓ |
| 无多余文字 | ✓ | ✓ |
| 构图简洁 | ✓ | ✓ |
| 与同分类风格一致 | ✓ | ✓ |

---

## 六、Phase 3: 后处理（脚本自动）

### 6.1 图片压缩

```
输入：generated-images/**/*.{jpg,png}
处理：
  - JPG: quality 85, 确保 <200KB
  - PNG: pngquant 65-80, 确保 <150KB
输出：compressed/**/*.{jpg,png}
```

### 6.2 复制到目标目录

```
输入：compressed/**/*.{jpg,png}
输出：public/images/blog/*.{jpg,png}
```

### 6.3 更新 MDX

```
对每篇 MDX：
1. 更新 frontmatter.image = /images/blog/{slug}-cover.jpg
2. 在正文中插入/替换内页图片引用：
   ![{h2_title}](/images/blog/{slug}-{n}.png)
```

### 6.4 上传 S3/CDN

```bash
# 上传到 S3
aws s3 cp --recursive public/images/blog s3://bucket/public/images/blog

# 保留本地副本
# 标记 uploaded=Y
```

---

## 七、Phase 4: 验收（脚本自动）

### 7.1 检查项

| 检查 | 通过条件 |
|------|----------|
| 封面存在 | {slug}-cover.jpg 存在且 <200KB |
| 内页 ≥3 | {slug}-1/2/3.png 存在且 <150KB |
| MDX 引用正确 | frontmatter.image 指向正确 |
| 正文图片引用 | 至少 3 个 ![...] 引用 |

### 7.2 验收结果

```
no_cover issue → 0
few_images issue → 0
mediaStatus → done
```

---

## 八、产出物清单

| 阶段 | 文件 | 说明 |
|------|------|------|
| Phase 1 | image-tasks.json | 结构化任务数据 |
| Phase 1 | pending-prompts.md | 待处理 Prompt 清单 |
| Phase 1 | image-tasks.md | 进度追踪表 |
| Phase 2 | generated-images/ | 原始图片 |
| Phase 3 | public/images/blog/ | 压缩后图片 |
| Phase 3 | 更新后的 MDX | 含图片引用 |
| Phase 4 | 验收报告 | issues 清零确认 |

---

## 九、时间规划

| 阶段 | 执行者 | 时间 |
|------|--------|------|
| Phase 1 | 脚本 | 5 分钟 |
| Phase 2 | 人工 | 17-20 小时 |
| Phase 3 | 脚本 | 10 分钟 |
| Phase 4 | 脚本 | 5 分钟 |
| **总计** | | **~18 小时** |

---

## 十、执行建议

1. **按分类批次做** - 同分类连续做，保持风格一致
2. **先做封面** - 封面更重要，优先完成
3. **不满意就重做** - 质量优先，不凑合
4. **及时命名保存** - 避免文件混乱
5. **定期更新进度** - 方便追踪和恢复
6. **分天完成** - 建议每天 5-6 小时，3-4 天完成

---

## 十一、快速生产技巧（无 API）

1. **用清单文件批量生成 Prompt**：一次性复制 3-5 条到 Gemini 对话，逐张生成
2. **先跑一类全量封面**：如商务汇报，保持系列感；再做内页
3. **生成后立刻压缩、命名、落盘**：避免堆积无标签文件
4. **缺图占位**：若暂缺图片，可用占位图同名放入路径，后续替换即可

---

## 十二、标题嵌入封面注意事项

1. **保持文字区域对比度高**：避免放在高噪声背景
2. **左右留白 10-15%，上下留白 15-20%**
3. **字体风格简洁**：无衬线/现代；同一系列用一致配色和字号比例
4. **中文渲染挑战**：AI 渲染长中文句子错误率高，建议用短标题（4-6字）或留白策略

---

## 十三、当前实现状态

### ✅ 已完成

- [x] 分类风格配置 (`category-styles.ts`) - 8 个分类
- [x] Prompt 模板 (`prompt-templates.ts`) - 封面/内页
- [x] 场景类型判断 - 6 种类型
- [x] 内容感知元素映射 - **35 条规则**（增强版）
- [x] 段落内容传递给场景类型判断
- [x] 文章关键词提取 - **优先级排序**
- [x] Prompt 生成脚本 (`generate-prompts.ts`)
- [x] 待处理 Prompt 导出 (`export-pending.ts`)

### 📊 数据统计

| 指标 | 数值 |
|------|------|
| 文章总数 | 100 篇 |
| 封面图 | 100 张 |
| 内页图 | 391 张 |
| 总计 | 491 张 |
| 分类数 | 8 个 |
| 元素映射规则 | 35 条 |

### 分类分布

| 分类 | 篇数 |
|------|------|
| 产品营销 | 10 |
| 模板技巧 | 18 |
| 商务汇报 | 10 |
| 年终总结 | 11 |
| 教育培训 | 11 |
| 述职报告 | 10 |
| 通用技巧 | 23 |
| 项目提案 | 7 |

### 🔄 待实现

- [ ] 图片压缩脚本
- [ ] MDX 更新脚本
- [ ] S3 上传脚本
- [ ] 状态追踪脚本

---

## 十四、文件路径

```
draft-code/
├── config/
│   ├── category-styles.ts      # 分类风格配置
│   └── prompt-templates.ts     # Prompt 模板
├── scripts/
│   └── image-pipeline/
│       ├── generate-prompts.ts # Prompt 生成脚本
│       └── export-pending.ts   # 导出待处理清单
├── data/
│   ├── image-tasks.json        # 结构化任务数据
│   ├── image-tasks.md          # Markdown 格式任务
│   └── pending-prompts.md      # 待处理 Prompt 清单
└── generated-images/           # 生成的图片存放目录
    ├── business/
    ├── year-end/
    ├── education/
    ├── marketing/
    ├── proposal/
    ├── report/
    ├── general/
    └── tips/
```
