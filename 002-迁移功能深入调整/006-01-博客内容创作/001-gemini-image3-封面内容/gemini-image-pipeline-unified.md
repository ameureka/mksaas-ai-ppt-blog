# Gemini 图片生成流水线 - 统一设计方案

> 更新时间：2025-12-06
> 状态：✅ Phase 1 已完全实现 (v2.0)
> 合并自：gemini-cli-pipeline-design.md、gemini-image3-补充设计.md、gemni-nanobanana-design.md

---

## 一、方案概览

| 项目 | 说明 |
|------|------|
| 目标 | 为 100 篇中文博文生成封面（内页可选） |
| 工具 | Gemini 网页/客户端（手工复制粘贴，无 API） |
| 产出 | 默认 100 张封面；内页按需开启（本次为 cover-only） |
| 核心特点 | Prompt 与文章内容深度关联（Content-Aware），非通用模板 |
| 预计时间 | 封面批量约 2-3 小时（手工操作） |

---

## 二、流水线架构

```
┌─────────────────────────────────────────────────────────────────┐
│              Gemini 手工图片生成流水线 (v2.0)                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Phase 1: 内容分析与 Prompt 生成（脚本自动 - 已完成）             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ MDX 文件    │    │ 内容分析器  │    │ Prompt      │         │
│  │ (100篇)     │ -> │ ・自动分类  │ -> │ 生成器      │         │
│  │             │    │ ・Slug转英  │    │ ・封面      │         │
│  │             │    │ ・内容感知  │    │ ・内页(可选)│         │
│  │             │    │ ・关键词    │    │             │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│        +                   │                   │                │
│  ┌─────────────┐           │                   v                │
│  │ 统一配置    │           │           ┌─────────────┐         │
│  │ (category-  │ ----------┘           │ 输出文件    │         │
│  │  config.ts) │                       │ ・prompts.md│         │
│  └─────────────┘                       │ ・tasks.json│         │
│                                        └─────────────┘         │
│                                                                 │
│  Phase 2: 图片生成（人工执行 - 进行中）                          │
│  ┌─────────────────────────────────────────────────────┐       │
│  │   ┌──────────┐    ┌──────────┐    ┌──────────┐     │       │
│  │   │ 复制     │ -> │ Gemini   │ -> │ 筛选     │     │       │
│  │   │ Prompt   │    │ 网页生成 │    │ 下载命名 │     │       │
│  │   └──────────┘    └──────────┘    └──────────┘     │       │
│  │        ^                                 │          │       │
│  │        │         ┌──────────┐            │          │       │
│  │        └─────────│ 进度追踪 │<───────────┘          │       │
│  │                  │ 标记完成 │                       │       │
│  │                  └──────────┘                       │       │
│  │   按分类批次执行（保持风格一致）                      │       │
│  └─────────────────────────────────────────────────────┘       │
│                                                                 │
│  Phase 3: 后处理（脚本自动：压缩/命名/校验 - 待执行）             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ 图片压缩    │ -> │ 复制到      │ -> │ 更新 MDX    │         │
│  │ JPG<200KB   │    │ public/     │    │ ・封面路径  │         │
│  │ PNG<150KB   │    │ images/blog │    │ ・内页引用  │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 三、核心升级点 (v2.0)

1.  **配置统一**：使用 `config/category-config.ts` 作为唯一配置源，废弃了旧的 `category-styles.ts`。
2.  **自动映射**：脚本根据 MDX 文件所在的**子目录名**自动判断分类，无需手动修改 frontmatter。
3.  **Slug 优化**：内置翻译表，自动将中文文件名（如“下载产品营销PPT模板.mdx”）转换为英文 Slug（如 `download-product-marketing-ppt-template`）。

---

## 四、分类风格配置 (最新)

| 分类 Slug | 中文名称 | 配色方案 | 风格关键词 |
| :--- | :--- | :--- | :--- |
| **`business`** | 商务汇报 | 深蓝/灰/白 | 极简网格、数据卡片 |
| **`education`** | 教育培训 | 绿/蓝/黄 | 明快高对比、插画 |
| **`general`** | 通用技巧 | 蓝/绿/黄 | 多功能、实用 |
| **`marketing`** | 产品营销 | 粉/紫/青 | 高对比、渐变霓虹 |
| **`paid-search`** | 付费搜索 | 紫/粉/青 | 现代、资源导向 |
| **`year-end`** | 年终总结 | 暖橙/金/米 | 时间线、稳重 |
| **`proposal`** | 项目提案 | 蓝/绿/白 | 创新、技术感 |
| **`report`** | 述职报告 | 深灰/石墨/白 | 专业、稳重 |

---

## 五、使用指南

### 5.1 生成 Prompt

```bash
cd draft-code
npx tsx scripts/image-pipeline/generate-prompts.ts
npx tsx scripts/image-pipeline/export-pending.ts
```

### 5.2 手工生成流程

1. 打开 `data/pending-prompts.md`
2. 复制 Prompt 到 Gemini 网页
3. 生成图片 → 下载 → **按清单中的英文文件名重命名**
4. 保存到 `generated-images/{category}/`

### 5.3 文件命名示例

- **封面**: `product-marketing-guide-cover.jpg`
- **内页**: `product-marketing-guide-1.png` (如有)

---

## 六、文件路径

```
draft-code/
├── config/
│   ├── category-config.ts      # ✅ 核心配置
│   └── prompt-templates.ts     # Prompt 模板
├── scripts/
│   └── image-pipeline/
│       ├── generate-prompts.ts # 主生成脚本
│       └── export-pending.ts   # 导出清单脚本
├── data/
│   ├── image-tasks.json        # 任务数据
│   └── pending-prompts.md      # 待执行清单
└── generated-images/           # 图片产出目录
```