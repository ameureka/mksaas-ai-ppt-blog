---
categories:
  - general
date: '2025-12-01'
image: /images/blog/博客实现格式与模式总结-cover.jpg
tags:
  - '[TRANSLATED] [TRANSLATED] [TRANSLATED] 通用技巧'
  - 通用技巧
relatedPosts:
  - agent
  - 博客分类与索引汇总
---
[TRANSLATED] [TRANSLATED] [TRANSLATED] ## demo 博客当前实现的格式与模式总结

### 1. 内容与文件结构
- 博文文件：`content/blog/*.mdx`，支持 `*.zh.mdx` 做中英文双版本。
- 分类文件：`content/category/*.mdx`，定义分类名称与描述。
- 作者文件：`content/author/*.mdx`，定义作者名称与头像。
- 其它内容（docs/changelog/pages）也共用同一套 Fumadocs 管线。

### 2. 博文 MDX 格式（Frontmatter 规范）
- 必填字段：
  - `title`: 文章标题，用于列表、详情页标题和 `<title>`。
  - `description`: 1–2 句摘要，直接用作 SEO 的 meta description。
  - `image`: 封面图路径，例如 `/images/blog/post-1.png`。
  - `date`: `"YYYY-MM-DD"` 字符串，控制排序和展示。
  - `published`: `true/false`，控制是否在前台列表展示。
  - `categories`: 分类 slug 数组，比如 `[development]` / `[project, development]`。
  - `author`: 作者 slug，比如 `fox`，需在 `content/author/fox.mdx` 中存在。
- 可选字段：
  - `premium: true` → 标记为付费文章，触发付费逻辑。
- 正文使用 Markdown + MDX，可嵌入自定义组件（Callout、视频、X 卡片等），最终通过 Fumadocs + `getMDXComponents()` 渲染。

### 3. 内容加载模式（Fumadocs Source）
- `pnpm content` 调用 `fumadocs-mdx`，将 `content/*` 编译为 `.source`。
- `src/lib/source.ts` 使用 `loader()` 生成：
  - `blogSource`, `categorySource`, `authorSource` 等。
  - `BlogType = InferPageType<typeof blogSource>` 作为统一文章类型。
- `BlogType` 中常用字段：
  - `slugs: string[]`（路径片段）。
  - `locale: 'en' | 'zh'`。
  - `data`: frontmatter + `body`（MDX 组件）+ `toc` 等。

### 4. 路由与页面模式
- 所有博客路由挂载在 `src/app/[locale]/(marketing)/blog` 下，配合 next-intl 的 `[locale]`。
- 列表页：`/[locale]/blog`
  - 使用 `blogSource.getPages(locale)` 获取当前语言文章。
  - 过滤 `published`，按 `date` 倒序。
  - 每页大小由 `websiteConfig.blog.paginationSize` 控制（如 12）。
  - 使用 `BlogGridWithPagination` + `CustomPagination` 渲染卡片 + 分页。
- 分页页：`/[locale]/blog/page/[page]`
  - `generateStaticParams` 为每个 locale 计算总页数，生成 `page >= 2` 的静态路径。
  - 逻辑与首页相同，只是 `currentPage` 来自 URL。
- 分类页：`/[locale]/blog/category/[slug]`
  - 使用 `categorySource.getPage([slug], locale)` 获取分类信息，不存在则 `notFound()`。
  - 过滤 `blogSource.getPages(locale)` 中 `categories` 包含当前分类的文章。
  - 使用 `BlogGridWithPagination` 渲染，并设置 `routePrefix=/blog/category/[slug]`。
- 详情页：`/[locale]/blog/[...slug]`
  - `generateStaticParams` 为所有已发布文章生成 `{ locale, slug: post.slugs }`。
  - `generateMetadata` 使用文章 `title/description/image` 构造 SEO 信息。
  - 详情组件：
    - 顶部展示封面图、发布日期、Premium 徽标、标题、描述。
    - 正文通过 `PremiumGuard` 包裹，内部渲染 `MDX`。
    - 右侧栏包含作者信息、分类列表、目录（`InlineTOC`）。
    - 底部通过 `getRelatedPosts` 随机推荐同 locale 的相关文章，数量由 `websiteConfig.blog.relatedPostsSize` 控制。

### 5. 付费文章模式（premium）
- 在 frontmatter 中标记 `premium: true` 即视为付费文章。
- 列表卡片：`BlogCard` 中根据 `post.data.premium` 渲染 `PremiumBadge` 徽标。
- 详情页：
  - 使用 `getSession()` 读取登录态。
  - 如为付费文章且用户已登录，则调用 `checkPremiumAccess(userId)` 判断权限。
  - `PremiumGuard` 接收：
    - `isPremium={!!premium}`。
    - `canAccess={hasPremiumAccess}`。
  - 只有 `canAccess === true` 时才展示完整 MDX 正文，否则展示提示组件，引导升级。

### 6. SEO 与重定向策略
- 所有博客相关页面通过 `constructMetadata` 统一生成 `<title>` 和 `<meta>` 等，结合 `websiteConfig.metadata.images.ogImage` 提供默认 OG 图。
- `next.config.ts` 中配置了一批永久重定向，将旧路径映射到 `/blog/<slug>`：
  - 如 `/algorithm` → `/blog/algorithm`。
  - `/2016-nian-mian-shi-zhi-nan-zhi-suan-fa-mian-shi-xin-de` → `/blog/algorithm`。
  - `/shijing` → `/blog/shijing` 等。
- 多语言：
  - `websiteConfig.i18n` 定义 `defaultLocale` 与 `hreflang`。
  - `constructMetadata` 中会根据 locale 设置 SEO 相关的国际化属性。
  - 页面路由使用 `[locale]` + `LocaleLink` 生成语言前缀一致的链接。

### 7. 组件层模式
- Blog 列表使用一组专门组件：
  - `BlogGridWithPagination`：负责空状态、卡片列表、分页控件。
  - `BlogGrid`：仅负责把 `BlogType[]` 映射为多列卡片布局。
  - `BlogCard`：单个卡片，包含图片、Premium 徽标、分类标签、标题、摘要、作者、日期。
- MDX 渲染依赖：
  - `getMDXComponents()` 注入自定义组件（Callout、视频、X 嵌入等），让博文既能写纯 Markdown，也能插 React 组件。

