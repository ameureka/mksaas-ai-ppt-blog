# 热门搜索统计设计草案（设计区）

> 目标：为 `/ppt` 搜索/推荐提供可用的热门关键词来源，先在设计区沉淀方案，后续按时机接入。

## 1. 设计目标
- 生成可用的 TOP 关键词列表，供首页/分类页展示。
- 收敛接口形态，避免对主查询链路造成性能拖累。
- 保留隐私与合规（不存敏感内容，支持匿名请求记录）。

## 2. 数据模型建议
- 表：`search_log`
  - `id` (uuid)
  - `keyword` (text, 标准化/去除空格)
  - `count` (int) — 可用单表累加，或分明细表再汇总
  - `user_id` (text, nullable) — 仅登录用户；匿名留空
  - `ip_hash` (text, nullable) — 可选，做去重/风控；hash 处理
  - `created_at` (timestamp, default now)
  - `source` (text, optional，例如 `ppt`)
- 备选：明细表 `search_event` + 定期汇总到 `search_hot_keywords`。

## 3. 统计策略（两档）
- P0（简单榜单，低成本）：
  - 写入：每次搜索将关键词标准化后插入/更新 `search_log`（upsert count+1）。
  - 读取：`SELECT keyword FROM search_log ORDER BY count DESC LIMIT N;`
  - 去噪：过滤长度 <2 或纯符号；可加停用词表。
- P1（精细榜单）：
  - 明细表 + 周期汇总（cron/job），支持时间窗口（近7天/30天）。
  - 排序可结合点击/下载等加权（额外字段）。

## 4. 接口形态（建议）
- 写入（Server Action/Route）：`recordSearch(keyword: string, source='ppt')`
- 读取（Server Action/Route）：`getHotKeywords({ limit=10, windowDays? }) => [{ keyword, count }]`
- 前台使用：SSR 获取，提供兜底静态关键词。

## 5. 标准化与过滤
- 去首尾空格，转小写（或保留原文但用 lower 参与去重）。
- 过滤长度 <2、纯标点/空白。
- 停用词（中文/英文）静态列表。

## 6. 风控与隐私
- 对 IP 仅存 hash（可选）；若无需风控可不存。
- 不记录完整 User Agent/Referer（或仅在日志系统，不入库）。
- 提供删除/清理机制（定期清理长尾/过期）。

## 7. 时机建议
- 首版：仍用静态兜底，等上线稳定后开启 P0 方案。
- 数据积累后可切换 `getHotKeywords` 返回真实榜单，静态兜底作为 fallback。

## 8. 迁移与落地步骤（未来）
1) 建表（search_log 或 search_event + 汇总表）。
2) 在搜索入口调用写入接口（server action/route），确保非阻塞。
3) 提供读取接口，前台 SSR 使用；无数据时返回静态兜底。
4) 可选：定时任务做窗口汇总、清理过期/低频关键词。

## 9. 兼容性
- 设计为独立表/接口，不影响现有 `/ppt` 查询逻辑；前台已可用静态关键词做兜底。
