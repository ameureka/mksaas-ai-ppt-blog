# 首页现状分析报告 (V2.0)

> **文档状态**: 2025-11-28 已更新交互逻辑
> **更新说明**: 已根据最新设计（下载入口收敛至详情页）调整了问题描述和行动项。

## 一、首页实际实现状态

### 1.1 页面基本信息
**文件**: `src/app/[locale]/(marketing)/ppt/page.tsx`
**类型**: Client Component (`'use client'`)
**总行数**: 659 行

### 1.2 问题汇总 (阻断性)

#### A. Mock 数据与客户端逻辑
- **问题**: 首页数据依赖 Mock 接口或硬编码。
- **过滤**: 分类、语言、排序均在客户端执行 (`useMemo`)，未利用数据库索引。
- **参数**: API 调用仅传递 `search`，丢失了 `language`, `category`, `sort` 参数。

#### B. 数据结构断层
- **DTO**: 后端返回的数据缺少 `tags` 和 `language` 字段。
- **Slug**: 前端硬编码的 `categories` 存在 Slug 重复问题 (如 `education` 映射了多个中文名)。

#### C. 交互逻辑陈旧
- **下载**: 目前点击下载仅弹出 Toast。
- **V2 要求**: 列表页点击应**跳转至详情页**，不再尝试直接下载。

---

## 二、后端差异分析 (Backend Gap)

### 2.1 `src/actions/ppt/ppt.ts`
- **现状**: Mock 实现，未连接 Drizzle。
- **缺失**:
  - 不支持 `language` 过滤。
  - 不支持 `tags` 过滤。
  - `DTO` 转换函数未映射完整字段。

### 2.2 `src/app/api/ppts/route.ts`
- **现状**: 简单的参数透传。
- **缺失**: 未解析 URL 中的 `language`, `category`, `sort` 参数传递给 Action。

---

## 三、修正行动项 (Action Items)

### 3.1 高优先级 (立即执行)

1.  **后端重构 (Backend)**
    - 创建 `src/lib/constants/ppt.ts` (Category/HotKeywords)。
    - 重写 `src/actions/ppt/ppt.ts` (Drizzle Query)。
    - 修复 `src/app/api/ppts/route.ts` (Params Parsing)。

2.  **前端列表页 (Frontend List)**
    - 移除 `useMemo` 客户端过滤。
    - 修复 `categories` 配置 (去重)。
    - **交互变更**: 点击卡片/下载按钮统一跳转 `/ppt/[id]`。

3.  **前端详情页 (Frontend Detail)**
    - 接入 `getPPTById` 获取真实数据。
    - 实现 `downloadPPT` 按钮 (鉴权 + 下载)。

### 3.2 中优先级 (后续优化)

- **SSR 改造**: 将首页改为 Server Component (V1.5)。
- **缓存优化**: 引入 Redis 缓存热门搜索结果。
- **统计分析**: 接入真实的热门搜索统计。

---

## 四、数据流图 (To-Be)

**V2 目标架构**:

```mermaid
graph TD
    User[用户] -->|1. 访问/搜索| ListPage[列表页 (Client)]
    ListPage -->|2. Fetch API| APIRoute[/api/ppts]
    APIRoute -->|3. Call Action| ServerAction[getPPTs]
    ServerAction -->|4. Query DB| DB[(PostgreSQL)]
    DB -->|5. Return Data| ServerAction
    ServerAction -->|6. Return DTO| ListPage
    
    User -->|7. 点击卡片| DetailPage[详情页 /ppt/:id]
    DetailPage -->|8. Fetch Detail| ServerAction2[getPPTById]
    
    User -->|9. 点击下载| DownloadBtn[下载按钮]
    DownloadBtn -->|10. Call Action| DownloadAction[downloadPPT]
    DownloadAction -->|11. Check Auth| Auth[鉴权]
    DownloadAction -->|12. Record Stats| DB
    DownloadAction -->|13. Return URL| DownloadBtn
```
