# /ppt 搜索主页改造 - 实施步骤（待落地）

> 仅列出执行顺序与关键要点，代码改动待评审后迁移到 `src/`。

## 0. 前置
- 数据库：`DATABASE_URL` 可用，并已执行最新迁移（含 `ppt` 表索引/updated_at 触发器）；有可用数据或已导入种子（必填列：title/category/author/file_url/file_size/slides_count/status/...）。
- 权限/角色：管理端开关未来依赖管理员角色（Better Auth），当前可用固定开关值。
- 配置：下载登录开关位置确定（config + 后台按钮）；热门关键词首版静态兜底。
- 其他 env：如需存储/AI 可后置，但 DB 必须可用。

## 1. 数据层（actions）
- 重写 `src/actions/ppt/ppt.ts`：list/detail/create/update/delete + recordDownload/recordView（Drizzle）。
- 重写 `src/actions/ppt/stats.ts`：聚合总数/下载量/浏览量、用户数。
- 类型：补充 `CreatePPTInput/UpdatePPTInput` 的可选字段映射表字段，命名遵循标准（TS camelCase 映射 DB snake_case）。

## 2. 配置与常量
- 新增静态配置：下载登录开关（配置 + 后台按钮控制）、热门关键词、分类 slug->中文映射（暂放 constants）。

## 3. 前台页面
- 搜索主页 `/ppt`：RSC 获取数据，分页/筛选/排序/搜索参数透传；加载/空/错误态；热门关键词用静态配置。
- 分类页 `/ppt/category/[name]`：按 slug 过滤；分类元信息用静态映射。
- 详情页 `/ppt/[id]`：真实数据；下载按钮走下载链路；可选 recordView。
- 下载链路：server action 或 `/api/ppts/[id]/download`，检查登录开关，返回直链并记下载；遵循标准的错误处理/返回格式。

## 4. 管理端
- 列表/创建/编辑接真实 actions；去 mock 延时；使用 URL 文本输入（无上传）。
- 统计卡片接真实 stats。

## 5. QA
- 本地/预发：分页/搜索/筛选/排序、详情、下载开关的正反两种状态。
- 管理端：CRUD 正常；分页、筛选、排序。

## 6. Backlog（不在本次）
- 上传/预览生成接 S3；热门搜索统计；向量检索；积分扣减；日志/审计落库；推荐/广告。***
