# /ppt 搜索主页改造 - 实施步骤 (V2.0)

> **文档状态**: 2025-11-28 已更新
> **执行原则**: 后端先行，列表页改跳转，详情页接下载。

## 0. Phase 0: 前置修复 (Pre-flight Checks)
**目标**: 确保 UI 可视化完整性，消除“裂图”和配置报错风险。

1.  **资源检查**: 确认 `public/placeholder.svg` 是否存在。若无，需生成或指定替代图片。
2.  **配置更新**: 修改 `next.config.ts`，在 `images.remotePatterns` 中添加 `aippt.guochunlin.com`。
3.  **常量准备**: 创建 `src/lib/constants/ppt.ts`，确保 Category 配置覆盖数据库中已有的 slug 值。

## 1. Phase 1: 基础与后端 (Backend Foundation)
**目标**: 建立真实的数据读写能力。

1.  **常量定义**:
    - 创建 `src/lib/constants/ppt.ts`。
    - 定义去重后的 `CATEGORIES` 和静态 `HOT_KEYWORDS`。
2.  **Server Action 重写 (`src/actions/ppt/ppt.ts`)**:
    - `getPPTs`: 实现 Drizzle 查询，支持 `language`, `tags` 过滤和分页。
    - `getPPTById`: 实现单条详情查询。
    - `downloadPPT`: 实现鉴权、计数、返回文件链接。
    - **DTO**: 确保返回前端所需完整字段。

## 2. Phase 2: 列表页改造 (List Page)
**目标**: 展示真实数据，引导至详情页。

1.  **组件重构 (`src/app/[locale]/(marketing)/ppt/page.tsx`)**:
    - 引入新的常量配置。
    - 移除 `useMemo` 客户端过滤。
    - 将筛选状态 (`filters`) 绑定到 API 参数。
2.  **交互调整**:
    - 修改 `PPTCard` 组件：点击事件统一改为 `<Link href={`/ppt/${ppt.id}`}>`。
    - **删除**列表页的下载按钮处理逻辑 (Toast)。

## 3. Phase 3: 详情页与下载 (Detail & Download)
**目标**: 完成下载闭环。

1.  **详情页接入**:
    - `/ppt/[id]/page.tsx` 使用 `getPPTById` 获取真实数据。
2.  **下载功能**:
    - 实现“免费下载”按钮组件。
    - 绑定 `downloadPPT` Action。
    - 处理 Loading / Success (打开链接) / Error (登录提示)。

## 4. Phase 4: 收尾与验证 (QA)
1.  **功能验证**:
    - 搜索/筛选是否生效？
    - 列表页点击是否跳转详情页？
    - 详情页能否成功下载？
    - 下载数是否 +1？
2.  **管理端适配**: 更新 Admin 页面调用新的 Action (非关键路径，可视进度安排)。

---