# 06 - ä¸‹è½½ç»„ä»¶è®¾è®¡

## è®¾è®¡èƒŒæ™¯

ç”¨æˆ·è¦æ±‚è¯¦ç»†è®¨è®ºä¸‹è½½æŒ‰é’®çš„é€»è¾‘è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š
1. ä¸‹è½½å¼€å…³çš„å«ä¹‰
2. å…è´¹ä¸‹è½½é€»è¾‘
3. ç§¯åˆ†å…‘æ¢
4. ç™»å½•è¦æ±‚
5. ç­¾å URL é˜²ç›—é“¾
6. ç»„ä»¶ç»“æ„å’Œæ—¶åºå›¾

## ä¸‹è½½é…ç½®å¼€å…³

### é…ç½®ä½ç½®
```typescript
// src/config/website.tsx
export const websiteConfig = {
  features: {
    pptRequireLoginForDownload: false,  // ä¸‹è½½æ˜¯å¦éœ€è¦ç™»å½•
  },
};
```

### å¼€å…³å«ä¹‰

#### `pptRequireLoginForDownload: false` ï¼ˆé»˜è®¤ï¼‰
**å«ä¹‰**: æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ç›´æ¥ä¸‹è½½ï¼Œæ— éœ€ç™»å½•

**æµç¨‹**:
```
ç”¨æˆ·ç‚¹å‡»ä¸‹è½½
  â†“
è°ƒç”¨ /api/ppts/{id}/download
  â†“
åç«¯æ£€æŸ¥å¼€å…³ = false
  â†“
ç›´æ¥è¿”å›æ–‡ä»¶ URL
  â†“
è§¦å‘ä¸‹è½½
```

**é€‚ç”¨åœºæ™¯**:
- å®Œå…¨å…è´¹çš„ PPT èµ„æºç«™
- å¸Œæœ›æœ€å¤§åŒ–åˆ†äº«å’Œä¼ æ’­
- ä¸éœ€è¦ç”¨æˆ·æ•°æ®æ”¶é›†

#### `pptRequireLoginForDownload: true`
**å«ä¹‰**: å¿…é¡»ç™»å½•åæ‰èƒ½ä¸‹è½½

**æµç¨‹**:
```
ç”¨æˆ·ç‚¹å‡»ä¸‹è½½
  â†“
å‰ç«¯æ£€æŸ¥ç™»å½•çŠ¶æ€
  â”œâ”€ æœªç™»å½• â†’ æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†ï¼Œç»ˆæ­¢
  â””â”€ å·²ç™»å½• â†’ è°ƒç”¨ /api/ppts/{id}/download
       â†“
       åç«¯æ£€æŸ¥å¼€å…³ = true
       â†“
       éªŒè¯ session
       â†“
       è¿”å›æ–‡ä»¶ URL
       â†“
       è§¦å‘ä¸‹è½½
```

**é€‚ç”¨åœºæ™¯**:
- éœ€è¦æ”¶é›†ç”¨æˆ·æ•°æ®
- éœ€è¦åˆ†æç”¨æˆ·ä¸‹è½½è¡Œä¸º
- åç»­å¯èƒ½å®æ–½ä»˜è´¹æˆ–ç§¯åˆ†ç³»ç»Ÿ

---

## å…è´¹ä¸‹è½½é€»è¾‘

### åˆæœŸæ–¹æ¡ˆï¼šå®Œå…¨å…è´¹
```typescript
// å½“å‰å®ç°
if (websiteConfig.features.pptRequireLoginForDownload) {
  // æ£€æŸ¥ç™»å½•
  const session = await auth();
  if (!session) {
    return { success: false, error: 'Login required' };
  }
}

// ç›´æ¥è¿”å›æ–‡ä»¶ URL
return {
  success: true,
  data: { fileUrl: ppt.file_url },
};
```

### æœªæ¥æ‰©å±•ï¼šé¦–å…æœºåˆ¶

#### æ–¹æ¡ˆ A: é¦–æ¬¡ä¸‹è½½å…è´¹
```typescript
// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦é¦–æ¬¡ä¸‹è½½
const firstDownload = await checkUserFirstDownload(userId);

if (firstDownload) {
  // é¦–æ¬¡å…è´¹
  await markFirstDownload(userId);
  return { success: true, data: { fileUrl: ppt.file_url } };
} else {
  // åç»­éœ€è¦ç§¯åˆ†
  return { success: false, error: 'Requires credits' };
}
```

#### æ–¹æ¡ˆ B: æ¯æ—¥é¦–å…
```typescript
// æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²ä¸‹è½½
const downloadToday = await checkUserDownloadToday(userId);

if (!downloadToday) {
  // ä»Šæ—¥é¦–æ¬¡å…è´¹
  await recordDailyFreeDownload(userId);
  return { success: true, data: { fileUrl: ppt.file_url } };
} else {
  // ä»Šæ—¥å·²ç”¨å®Œå…è´¹é¢åº¦
  return { success: false, error: 'Daily free quota exhausted' };
}
```

---

## ç§¯åˆ†å…‘æ¢ç³»ç»Ÿï¼ˆæœªæ¥ï¼‰

### æ•°æ®æ¨¡å‹
```typescript
// ç”¨æˆ·ç§¯åˆ†è¡¨
interface UserCredit {
  userId: string;
  balance: number;      // å½“å‰ä½™é¢
  earned: number;       // ç´¯è®¡è·å¾—
  spent: number;        // ç´¯è®¡æ¶ˆè´¹
}

// ç§¯åˆ†äº¤æ˜“è®°å½•
interface CreditTransaction {
  id: string;
  userId: string;
  type: 'earn' | 'spend';
  amount: number;
  reason: string;       // 'download_ppt', 'watch_ad', 'register_gift', etc.
  resourceId?: string;  // PPT ID
  createdAt: Date;
}
```

### ä¸‹è½½æ‰£è´¹é€»è¾‘
```typescript
// æ£€æŸ¥ç§¯åˆ†
const credits = await getUserCredits(userId);
const requiredCredits = ppt.requiredCredits ?? 10;  // æ¯ä¸ª PPT éœ€è¦çš„ç§¯åˆ†

if (credits.balance < requiredCredits) {
  return {
    success: false,
    error: 'Insufficient credits',
    data: { required: requiredCredits, current: credits.balance },
  };
}

// æ‰£é™¤ç§¯åˆ†
await deductCredits(userId, requiredCredits, 'download_ppt', ppt.id);

// è¿”å›ä¸‹è½½é“¾æ¥
return { success: true, data: { fileUrl: ppt.file_url } };
```

### è·å–ç§¯åˆ†æ–¹å¼
1. **æ³¨å†Œèµ é€**: æ–°ç”¨æˆ·æ³¨å†Œé€ 100 ç§¯åˆ†
2. **æ¯æ—¥ç­¾åˆ°**: æ¯æ—¥ç­¾åˆ°é€ 10 ç§¯åˆ†
3. **è§‚çœ‹å¹¿å‘Š**: è§‚çœ‹å¹¿å‘Šè§†é¢‘é€ 20 ç§¯åˆ†
4. **åˆ†äº«é‚€è¯·**: é‚€è¯·å¥½å‹æ³¨å†Œé€ 50 ç§¯åˆ†
5. **è´­ä¹°ç§¯åˆ†åŒ…**: å……å€¼è´­ä¹°ç§¯åˆ†

---

## å¹¿å‘Šæ¿€åŠ±ä¸‹è½½ï¼ˆæœªæ¥ï¼‰

### æ–¹æ¡ˆï¼šè§‚çœ‹å¹¿å‘Šå…è´¹ä¸‹è½½

#### æµç¨‹è®¾è®¡
```
ç”¨æˆ·ç‚¹å‡»ä¸‹è½½
  â†“
æ£€æŸ¥ç§¯åˆ†ä¸è¶³
  â†“
æ˜¾ç¤ºä¸‹è½½é€‰é¡¹æ¨¡æ€æ¡†:
  - é€‰é¡¹1: ä½¿ç”¨ 10 ç§¯åˆ†ä¸‹è½½
  - é€‰é¡¹2: è§‚çœ‹å¹¿å‘Šå…è´¹ä¸‹è½½ â­
  - é€‰é¡¹3: åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“å…è´¹ä¸‹è½½
  â†“
ç”¨æˆ·é€‰æ‹© "è§‚çœ‹å¹¿å‘Š"
  â†“
æ˜¾ç¤ºæ¿€åŠ±è§†é¢‘å¹¿å‘Š
  â†“
ç”¨æˆ·å®Œæ•´è§‚çœ‹
  â†“
å¹¿å‘Š SDK å›è°ƒæˆåŠŸ
  â†“
è°ƒç”¨ /api/ppts/{id}/download?method=ad
  â†“
åç«¯éªŒè¯å¹¿å‘Šè§‚çœ‹è®°å½•
  â†“
è¿”å›æ–‡ä»¶ URLï¼ˆä¸æ‰£ç§¯åˆ†ï¼‰
```

#### ä»£ç å®ç°è‰æ¡ˆ
```typescript
// å‰ç«¯ï¼šå¹¿å‘Šç»„ä»¶
import { useRewardedVideo } from '@/hooks/ads/use-rewarded-video';

function DownloadModal({ ppt }) {
  const { show: showAd, isReady } = useRewardedVideo();

  const handleWatchAd = async () => {
    const result = await showAd();

    if (result.success) {
      // å¹¿å‘Šè§‚çœ‹æˆåŠŸï¼Œè¯·æ±‚ä¸‹è½½
      const downloadRes = await fetch(`/api/ppts/${ppt.id}/download`, {
        method: 'POST',
        body: JSON.stringify({ method: 'ad' }),
      });

      if (downloadRes.ok) {
        const data = await downloadRes.json();
        window.location.href = data.fileUrl;
      }
    }
  };

  return (
    <div>
      <button onClick={handleWatchAd} disabled={!isReady}>
        è§‚çœ‹å¹¿å‘Šå…è´¹ä¸‹è½½
      </button>
    </div>
  );
}
```

---

## ç­¾å URL é˜²ç›—é“¾ï¼ˆæœªæ¥ï¼‰

### é—®é¢˜
å½“å‰ç›´æ¥è¿”å› S3/R2 çš„æ–‡ä»¶ URLï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ï¼š
- é“¾æ¥å¯è¢«å¤åˆ¶åˆ†äº«
- æ— æ³•æ§åˆ¶ä¸‹è½½æ¬¡æ•°
- æ— æ³•è¿½è¸ªä¸‹è½½æ¥æº

### è§£å†³æ–¹æ¡ˆï¼šç”Ÿæˆä¸´æ—¶ç­¾å URL

#### æ–¹æ¡ˆ A: ä½¿ç”¨ S3 Pre-signed URL
```typescript
import { S3Client, GetObjectCommand } from '@aws-sdk/client-s3';
import { getSignedUrl } from '@aws-sdk/s3-request-presigner';

async function generatePresignedUrl(fileKey: string): Promise<string> {
  const s3 = new S3Client({ region: 'ap-southeast-1' });

  const command = new GetObjectCommand({
    Bucket: process.env.S3_BUCKET,
    Key: fileKey,
  });

  // ç”Ÿæˆ15åˆ†é’Ÿæœ‰æ•ˆæœŸçš„ç­¾å URL
  const signedUrl = await getSignedUrl(s3, command, {
    expiresIn: 900,  // 15 minutes
  });

  return signedUrl;
}
```

#### æ–¹æ¡ˆ B: è‡ªå®šä¹‰ç­¾åæœºåˆ¶
```typescript
import crypto from 'crypto';

function generateDownloadToken(userId: string, pptId: string): string {
  const payload = {
    userId,
    pptId,
    exp: Date.now() + 15 * 60 * 1000,  // 15 åˆ†é’Ÿè¿‡æœŸ
  };

  const signature = crypto
    .createHmac('sha256', process.env.DOWNLOAD_SECRET!)
    .update(JSON.stringify(payload))
    .digest('hex');

  return Buffer.from(JSON.stringify({ ...payload, signature })).toString('base64');
}

function verifyDownloadToken(token: string): boolean {
  try {
    const decoded = JSON.parse(Buffer.from(token, 'base64').toString());

    // æ£€æŸ¥è¿‡æœŸæ—¶é—´
    if (Date.now() > decoded.exp) {
      return false;
    }

    // éªŒè¯ç­¾å
    const { signature, ...payload } = decoded;
    const expectedSignature = crypto
      .createHmac('sha256', process.env.DOWNLOAD_SECRET!)
      .update(JSON.stringify(payload))
      .digest('hex');

    return signature === expectedSignature;
  } catch {
    return false;
  }
}
```

#### ä¸‹è½½ç«¯ç‚¹ä¿®æ”¹
```typescript
// POST /api/ppts/[id]/download
export async function POST(req: Request, { params }: { params: { id: string } }) {
  const session = await auth();
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  const ppt = await getPPTById(params.id);
  if (!ppt.success) {
    return NextResponse.json({ error: 'Not found' }, { status: 404 });
  }

  // ç”Ÿæˆç­¾å URL
  const signedUrl = await generatePresignedUrl(ppt.data.file_url);

  // è®°å½•ä¸‹è½½
  await recordDownload(params.id);

  return NextResponse.json({
    success: true,
    data: {
      fileUrl: signedUrl,
      expiresIn: 900,  // 15 minutes
    },
  });
}
```

---

## ç»„ä»¶ç»“æ„è®¾è®¡

### ç»„ä»¶å±‚æ¬¡
```
[PPTDetailPage]
  â†“
[DownloadButton] â† ä¸‹è½½è§¦å‘ç‚¹
  â†“ (ç‚¹å‡»)
[DownloadModal] â† ä¸»ä¸‹è½½æµç¨‹æ¨¡æ€æ¡†
  â”œâ”€ [DownloadStepper] â† æ­¥éª¤æŒ‡ç¤ºå™¨ï¼ˆ1/2/3ï¼‰
  â”œâ”€ [DownloadOptionsModal] â† é€‰æ‹©ä¸‹è½½æ–¹å¼
  â”‚    â”œâ”€ é¦–å…ä¸‹è½½
  â”‚    â”œâ”€ ç§¯åˆ†å…‘æ¢
  â”‚    â”œâ”€ è§‚çœ‹å¹¿å‘Š
  â”‚    â””â”€ æ³¨å†Œé€ç§¯åˆ†
  â”œâ”€ [RewardedVideoAd] â† æ¿€åŠ±è§†é¢‘å¹¿å‘Š
  â”œâ”€ [DownloadLinkDisplay] â† æ˜¾ç¤ºä¸‹è½½é“¾æ¥
  â””â”€ [LoginModal] â† ç™»å½•æ¨¡æ€æ¡†ï¼ˆå¦‚éœ€ç™»å½•ï¼‰
```

### ç»„ä»¶æ–‡ä»¶ç»“æ„
```
src/components/ppt/download/
â”œâ”€â”€ download-button.tsx           # ä¸‹è½½è§¦å‘æŒ‰é’®
â”œâ”€â”€ download-modal.tsx            # ä¸»ä¸‹è½½æµç¨‹æ¨¡æ€æ¡†
â”œâ”€â”€ download-options-modal.tsx    # ä¸‹è½½æ–¹å¼é€‰æ‹©
â”œâ”€â”€ download-link-display.tsx     # ä¸‹è½½é“¾æ¥å±•ç¤º
â”œâ”€â”€ download-stepper.tsx          # æ­¥éª¤æŒ‡ç¤ºå™¨
â””â”€â”€ index.ts                      # å¯¼å‡º
```

---

## æ—¶åºå›¾

### åœºæ™¯ 1: ä¸éœ€è¦ç™»å½• + å…è´¹ä¸‹è½½
```
ç”¨æˆ·                   å‰ç«¯                    åç«¯                   æ•°æ®åº“
 |                      |                       |                       |
 | ç‚¹å‡»ä¸‹è½½               |                       |                       |
 |--------------------->|                       |                       |
 |                      | æ£€æŸ¥ pptRequireLoginForDownload = false       |
 |                      |                       |                       |
 |                      | POST /api/ppts/{id}/download                  |
 |                      |---------------------->|                       |
 |                      |                       | SELECT * FROM ppt WHERE id = ? |
 |                      |                       |---------------------->|
 |                      |                       |<----------------------|
 |                      |                       | UPDATE ppt SET download_count = download_count + 1 |
 |                      |                       |---------------------->|
 |                      |<----------------------|                       |
 |                      | { success: true, fileUrl: "..." }             |
 |<---------------------|                       |                       |
 | è§¦å‘æµè§ˆå™¨ä¸‹è½½          |                       |                       |
```

### åœºæ™¯ 2: éœ€è¦ç™»å½• + å…è´¹ä¸‹è½½
```
ç”¨æˆ·                   å‰ç«¯                    åç«¯                   æ•°æ®åº“
 |                      |                       |                       |
 | ç‚¹å‡»ä¸‹è½½               |                       |                       |
 |--------------------->|                       |                       |
 |                      | æ£€æŸ¥ pptRequireLoginForDownload = true        |
 |                      | æ£€æŸ¥ session          |                       |
 |                      | session = null        |                       |
 |<---------------------|                       |                       |
 | æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†          |                       |                       |
 |                      |                       |                       |
 | ç”¨æˆ·ç™»å½•æˆåŠŸ            |                       |                       |
 |--------------------->|                       |                       |
 |                      | é‡æ–°ç‚¹å‡»ä¸‹è½½           |                       |
 |--------------------->|                       |                       |
 |                      | session å­˜åœ¨          |                       |
 |                      | POST /api/ppts/{id}/download                  |
 |                      |---------------------->|                       |
 |                      |                       | éªŒè¯ session          |
 |                      |                       | SELECT * FROM ppt WHERE id = ? |
 |                      |                       |---------------------->|
 |                      |                       |<----------------------|
 |                      |                       | UPDATE download_count |
 |                      |                       |---------------------->|
 |                      |<----------------------|                       |
 |                      | { success: true, fileUrl: "..." }             |
 |<---------------------|                       |                       |
 | è§¦å‘ä¸‹è½½               |                       |                       |
```

### åœºæ™¯ 3: ç§¯åˆ†å…‘æ¢ä¸‹è½½ï¼ˆæœªæ¥ï¼‰
```
ç”¨æˆ·                   å‰ç«¯                    åç«¯                   æ•°æ®åº“
 |                      |                       |                       |
 | ç‚¹å‡»ä¸‹è½½               |                       |                       |
 |--------------------->|                       |                       |
 |                      | æ˜¾ç¤º DownloadOptionsModal                     |
 |<---------------------|                       |                       |
 | é€‰æ‹© "ä½¿ç”¨ç§¯åˆ†ä¸‹è½½"     |                       |                       |
 |--------------------->|                       |                       |
 |                      | POST /api/ppts/{id}/download?method=credits   |
 |                      |---------------------->|                       |
 |                      |                       | SELECT balance FROM user_credit WHERE user_id = ? |
 |                      |                       |---------------------->|
 |                      |                       |<----------------------|
 |                      |                       | æ£€æŸ¥ç§¯åˆ†: balance >= required |
 |                      |                       | UPDATE user_credit SET balance = balance - 10 |
 |                      |                       |---------------------->|
 |                      |                       | INSERT INTO credit_transaction (...) |
 |                      |                       |---------------------->|
 |                      |                       | UPDATE download_count |
 |                      |                       |---------------------->|
 |                      |<----------------------|                       |
 |                      | { success: true, fileUrl: "...", creditsUsed: 10 } |
 |<---------------------|                       |                       |
 | è§¦å‘ä¸‹è½½               |                       |                       |
```

### åœºæ™¯ 4: è§‚çœ‹å¹¿å‘Šä¸‹è½½ï¼ˆæœªæ¥ï¼‰
```
ç”¨æˆ·                   å‰ç«¯                    å¹¿å‘ŠSDK                åç«¯                   æ•°æ®åº“
 |                      |                       |                       |                       |
 | ç‚¹å‡»ä¸‹è½½               |                       |                       |                       |
 |--------------------->|                       |                       |                       |
 |                      | æ˜¾ç¤º DownloadOptionsModal                                             |
 |<---------------------|                       |                       |                       |
 | é€‰æ‹© "è§‚çœ‹å¹¿å‘Šå…è´¹ä¸‹è½½"  |                       |                       |                       |
 |--------------------->|                       |                       |                       |
 |                      | showRewardedVideo()   |                       |                       |
 |                      |---------------------->|                       |                       |
 |<---------------------|<----------------------|                       |                       |
 | æ’­æ”¾å¹¿å‘Šè§†é¢‘            |                       |                       |                       |
 |                      |                       |                       |                       |
 | å¹¿å‘Šè§‚çœ‹å®Œæˆ            |                       |                       |                       |
 |--------------------->|                       |                       |                       |
 |                      | onAdComplete()        |                       |                       |
 |                      |<----------------------|                       |                       |
 |                      | POST /api/ppts/{id}/download?method=ad                                |
 |                      |---------------------------------------------->|                       |
 |                      |                       |                       | éªŒè¯å¹¿å‘Šè§‚çœ‹è®°å½•         |
 |                      |                       |                       | SELECT * FROM ppt WHERE id = ? |
 |                      |                       |                       |---------------------->|
 |                      |                       |                       |<----------------------|
 |                      |                       |                       | UPDATE download_count |
 |                      |                       |                       |---------------------->|
 |                      |<----------------------------------------------|                       |
 |                      | { success: true, fileUrl: "..." }                                     |
 |<---------------------|                       |                       |                       |
 | è§¦å‘ä¸‹è½½               |                       |                       |                       |
```

---

## å®ç°ä¼˜å…ˆçº§

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åŠŸèƒ½ï¼ˆå½“å‰ï¼‰
- âœ… ä¸‹è½½å¼€å…³é…ç½®
- âœ… ä¸éœ€è¦ç™»å½•çš„å…è´¹ä¸‹è½½
- ğŸ”„ éœ€è¦ç™»å½•çš„å…è´¹ä¸‹è½½
- ğŸ”„ ä¸‹è½½æŒ‰é’®è¿æ¥ API

### ç¬¬äºŒé˜¶æ®µï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–
- â³ ä¸‹è½½æ¨¡æ€æ¡†ç»„ä»¶
- â³ ç™»å½•æ¨¡æ€æ¡†é›†æˆ
- â³ ä¸‹è½½æˆåŠŸæç¤º
- â³ ä¸‹è½½å¤±è´¥é”™è¯¯å¤„ç†

### ç¬¬ä¸‰é˜¶æ®µï¼šç§¯åˆ†ç³»ç»Ÿï¼ˆæœªæ¥ï¼‰
- â³ ç§¯åˆ†æ•°æ®æ¨¡å‹
- â³ ç§¯åˆ†å…‘æ¢é€»è¾‘
- â³ ç§¯åˆ†äº¤æ˜“è®°å½•
- â³ ç§¯åˆ†ä½™é¢å±•ç¤º

### ç¬¬å››é˜¶æ®µï¼šå¹¿å‘Šæ¿€åŠ±ï¼ˆæœªæ¥ï¼‰
- â³ æ¿€åŠ±è§†é¢‘å¹¿å‘Šé›†æˆ
- â³ å¹¿å‘Šè§‚çœ‹éªŒè¯
- â³ å¹¿å‘Šä¸‹è½½æµç¨‹

### ç¬¬äº”é˜¶æ®µï¼šå®‰å…¨å¢å¼ºï¼ˆæœªæ¥ï¼‰
- â³ ç­¾å URL ç”Ÿæˆ
- â³ ä¸‹è½½é“¾æ¥è¿‡æœŸæ§åˆ¶
- â³ ä¸‹è½½æ¬¡æ•°é™åˆ¶
- â³ é˜²ç›—é“¾æœºåˆ¶

---

## è®¾è®¡æ€»ç»“

### æ ¸å¿ƒç†å¿µ
1. **æ¸è¿›å¢å¼º**: ä»ç®€å•çš„å…è´¹ä¸‹è½½å¼€å§‹ï¼Œé€æ­¥å¢åŠ ç§¯åˆ†ã€å¹¿å‘Šã€ç­¾åç­‰åŠŸèƒ½
2. **é…ç½®é©±åŠ¨**: é€šè¿‡ feature flags æ§åˆ¶åŠŸèƒ½å¼€å¯/å…³é—­
3. **ç”¨æˆ·ä½“éªŒ**: ä¼˜å…ˆä¿è¯ä¸‹è½½æµç•…ï¼Œé¿å…è¿‡å¤šæ­¥éª¤
4. **å®‰å…¨æ€§**: é€šè¿‡ç­¾å URL å’Œæƒé™æ§åˆ¶é˜²æ­¢ç›—é“¾

### æŠ€æœ¯é€‰å‹
- **è®¤è¯**: Better Auth session
- **æ•°æ®åº“**: Drizzle ORM + PostgreSQL
- **æ–‡ä»¶å­˜å‚¨**: S3-compatible (Cloudflare R2)
- **å¹¿å‘Š**: Google AdMob / Unity Ads (TBD)
- **å‰ç«¯**: React + TanStack Query

### é£é™©è¯„ä¼°
1. **ç§¯åˆ†ç³»ç»Ÿå¤æ‚åº¦**: éœ€è¦å¤„ç†å¹¶å‘ã€å›æ»šã€åŒèŠ±ç­‰é—®é¢˜
2. **å¹¿å‘Šé›†æˆ**: éœ€è¦æ¥å…¥ç¬¬ä¸‰æ–¹ SDKï¼Œå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜
3. **ç­¾å URL**: å¢åŠ æœåŠ¡å™¨è´Ÿè½½ï¼Œéœ€è¦ç¼“å­˜ç­–ç•¥
4. **ç”¨æˆ·ä½“éªŒ**: è¿‡å¤šæ­¥éª¤å¯èƒ½å¯¼è‡´ç”¨æˆ·æµå¤±

### æˆåŠŸæŒ‡æ ‡
- ä¸‹è½½æˆåŠŸç‡ > 95%
- ä¸‹è½½å“åº”æ—¶é—´ < 2s
- ç”¨æˆ·æµå¤±ç‡ï¼ˆç‚¹å‡»ä¸‹è½½åˆ°å®Œæˆä¸‹è½½ï¼‰ < 10%
- å¹¿å‘Šå®Œæˆç‡ï¼ˆå¦‚å®æ–½ï¼‰ > 80%
