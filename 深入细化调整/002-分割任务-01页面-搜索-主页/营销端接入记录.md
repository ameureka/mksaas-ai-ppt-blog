# 营销端 /ppt 页面接入记录 (V2.0)

> **文档状态**: 2025-11-28 更新
> **当前阶段**: 执行阶段 (Execution) - 去 Mock 化与交互优化。

## 1. 目标与范围
- **核心目标**: 
    1. 列表页 (`/ppt`) 对接真实筛选与分页，移除客户端过滤。
    2. 下载动作收敛至详情页 (`/ppt/[id]`)。
- **涉及模块**:
    - Server Actions (`src/actions/ppt/ppt.ts`)
    - UI Components (`src/app/[locale]/(marketing)/ppt/page.tsx`)
    - Route Handlers (`src/app/api/ppts/route.ts`)

## 2. 变更跟踪 (Change Log)

### [Pending] Phase 0: 前置修复
- [ ] **资源**: 检查/创建 `public/placeholder.svg`。
- [ ] **配置**: 更新 `next.config.ts` 添加图片域名白名单。

### [Pending] Phase 1: 后端重构
- [ ] **Action 重写**: 废弃 Mock，实现 Drizzle 查询。
- [ ] **DTO 修复**: 补全 `tags`, `language`，处理 `description`/`file_size` 空值。
- [ ] **常量定义**: 创建 `src/lib/constants/ppt.ts`。

### [Pending] Phase 2: 列表页改造
- [ ] **交互变更**: 列表页点击卡片改为跳转 `/ppt/[id]`。
- [ ] **筛选对接**: 移除客户端过滤，对接 API 参数。
- [ ] **UI 容错**: 确保图片加载失败时显示占位图。
- [ ] **分类修复**: 使用新的 Slug 常量配置。

### [Pending] Phase 3: 详情页下载
- [ ] **下载实现**: 详情页接入 `downloadPPT` Action。
- [ ] **鉴权**: 处理登录开关逻辑。

---

## 3. 已知差异 (Diff vs. Spec)
- **分页**: 当前 V1 方案为了快速上线，首页可能暂时保留 Client Component + API Fetch 模式，但数据源必须是真实的。SSR 改造作为 V1.5 优化项。
- **下载**: 原计划列表页可下载，现已变更为**必须跳转详情页**。
- **图片**: 数据库图片域名需要白名单配置，且需强制占位图回退策略。

## 4. 校验清单 (QA Checklist)
- [ ] 搜索 "年终" 能搜到真实数据吗？
- [ ] 筛选 "中文" + "最新" 有效吗？
- [ ] 点击列表卡片是否跳转详情页？
- [ ] **图片是否显示正常（无裂图）？**
- [ ] **数据库缺失字段（大小/简介）是否导致 UI 报错？**
- [ ] 详情页点击下载能拉起文件吗？
- [ ] 下载后数据库 `download_count` 增加了吗？