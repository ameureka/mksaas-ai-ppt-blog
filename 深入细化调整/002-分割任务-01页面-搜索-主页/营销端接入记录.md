# 营销端 /ppt 页面接入记录

> 进入接入阶段前的准备、跟踪与校验记录。代码改动将直接落地到 `src/app/[locale]/(marketing)/ppt/*` 及相关链路，便于追踪。

## 阶段概览
- 设计已完成（见本目录各文档），数据库已确认可用（68 条 ppt 数据，索引/触发器齐全）。
- 当前状态：开始接入真实数据/逻辑，替换 mock。

## 目标范围
- `/ppt` 搜索主页：SSR 取数，分页/搜索/筛选/排序；热门关键词静态兜底。
- `/ppt/category/[name]`：按 slug 调用列表。
- `/ppt/[id]`：详情真实数据；下载按钮走下载链路；可选记录浏览。
- 下载链路：server action 或 `/api/ppts/[id]/download`，检查 `websiteConfig.features.pptRequireLoginForDownload`，通过则记录下载并返回直链。

## 准备清单
- DB：`DATABASE_URL` 可用；ppt 表字段/索引/触发器已检查，有 68 条数据。
- 配置：`websiteConfig.features.pptRequireLoginForDownload=false`（后续后台开关）；热门关键词静态。
- 数据缺口：ppt 表无 `file_size/description`，UI 需容错或隐藏。
- 权限：管理员账号已存在（供后台开关后续使用）。

## 计划步骤（接入阶段）
1) 前台页面接线
   - `/ppt`：改为 RSC 获取列表 + searchParams 控制分页/搜索/筛选/排序；加载/空/错误态基于 action 结果。
   - 分类页：同上，强制 category 参数。
   - 详情页：用 `getPPTById`；下载按钮调用下载链路；可选 `recordView`.
2) 下载链路
   - 新增 server action 或 `/api/ppts/[id]/download`：检查登录开关；未登录报错；成功则 `recordDownload` 并返回 `file_url`（或 302）。
3) 配置读取
   - 使用 `websiteConfig.features.pptRequireLoginForDownload`；热门关键词从静态配置。
4) QA
   - 本地/预发验证：分页/搜索/筛选/排序，详情/下载（开关的两种状态），空态/错误态。

## 校验点
- 列表字段映射：`download_count/view_count` → UI 显示下载/浏览；`thumbnail_url/cover_image_url` → 预览图。
- 错误处理：返回格式 `{ success, data?/error? }`，页面显示友好提示。
- 配置生效：开关为 false 时无需登录下载；后续可切换 true。

## 跟踪
- 所有接入变更记录在此文件；如需回滚，可参考 git 变更集。
