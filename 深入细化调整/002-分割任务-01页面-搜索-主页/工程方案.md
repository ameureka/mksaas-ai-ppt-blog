# /ppt 搜索主页改造 - 工程方案（仅设计，未落代码）

> 目标：为 `/ppt` 搜索/分类/详情页面落地真实数据与鉴权开关，先在设计区沉淀方案，评审通过后再迁移到 `src/`。

## 1. 范围
- 前台：`/ppt` 搜索主页、`/ppt/categories`、`/ppt/category/[name]`、`/ppt/[id]`。
- 后台：`/admin/ppt` 列表/编辑/创建；统计卡片。
- 数据：Drizzle `ppt` 表；暂不接上传/向量化。
- 配置：下载登录开关、热门关键词（静态兜底）。

## 2. 既定决策
- 数据获取：SSR + Server Actions 调用 Drizzle；页码分页(`page`/`pageSize`)；暂不开放 `/api/ppts`。
- 分类/语言：slug（business, education, technology, creative, marketing, medical, finance, hr, lifestyle, general）+ 中文映射；语言 zh/en。
- 排序：`newest`=created_at desc；`popular`=view_count desc（次序 download_count）；`downloads`=download_count desc。
- 热门关键词：首版静态兜底，预留热门搜索统计（参考 search-system 文档）。
- 下载权限：开关控制（默认免登录，后续可切换需要登录）；暂不扣积分。
- 上传：不做；`fileUrl/previewUrl` 手工填。

## 3. 数据层方案（待实现后迁移）
- 替换 `src/actions/ppt/ppt.ts` 为 Drizzle 版：
  - list(params)：支持 search/category/status/date range/sort/page/pageSize。
  - detail(id)。
  - create/update/delete：写入必需字段；时间戳默认 now。
  - recordDownload / recordView：单表计数自增。
- 统计：`src/actions/ppt/stats.ts` 用聚合 count/sum(downloads/views)，用户数从 user 表。
- 类型：补充 `CreatePPTInput/UpdatePPTInput` 可选字段（author/file_size/slides_count/status/...）。

## 4. 前台页面改造思路
- 搜索主页：RSC 获取列表 + 分页；筛选/排序/搜索参数透传；加载/空/错误态；热门关键词用静态配置。
- 分类页：基于 slug 过滤查询；分类元信息静态映射。
- 详情页：真实数据；下载按钮走下载链路；移除 mock 延时/随机；视图计数可在进入时触发 recordView（可选）。
- 下载链路：按钮触发 server action/route 返回文件直链并调用 recordDownload；检查登录开关。

## 5. 管理端改造思路
- 列表/编辑/创建：改用真实 actions；去掉 mock 延时；表单隐藏上传控件，改为 URL 文本输入。
- 列表筛选/排序在前端完成或透传到 action（优先 action 支持分页/排序）。
- 统计卡片：使用真实 stats 数据。

## 6. 配置与常量
- 下载登录开关：放 config（websiteConfig/env 读取），管理后台提供按钮切换开启/关闭。
- 热门关键词：静态数组配置（可放 constants）；预留未来接口接入热门搜索统计。
- 分类映射：slug -> 中文名/图标的静态表。
- 规范对齐：配置字段/命名遵循《MkSaaS框架开发标准》中的命名和层级约定（config -> camelCase，数据库字段 snake_case 映射）。
- UI 容错：DB 缺失的 `file_size/description` 前端用空或“暂无”兜底；预览图缺失用 placeholder。

## 7. Backlog / 后续
- 上传与预览生成接 S3；向量化/语义检索；热门搜索统计；推荐/广告投放；积分扣减；审计/日志落库；API 公开化（如需要）。

## 8. 待确认
- 热门搜索统计接入的时间点与接口形态（当前先用静态兜底）。
- 管理端批量/草稿/发布流程：在未来管理后台设计时再实现，当前预留接口即可。***
