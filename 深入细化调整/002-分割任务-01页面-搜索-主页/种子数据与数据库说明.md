# /ppt 种子数据与数据库说明 (V2.0)

> **文档状态**: 2025-11-28 已校验更新
> **数据源**: Neon PostgreSQL (ap-southeast-1)

## 1. PPT 表结构现状 (Source of Truth)

基于 `src/db/schema.ts` 和数据库实测。

### 1.1 字段清单
| 字段名 | 类型 | Nullable | 说明 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| `id` | `text` | NO | 主键 | ✅ |
| `title` | `text` | NO | 标题 | ✅ |
| `author` | `text` | YES | 作者 | ✅ |
| `category` | `text` | YES | 分类 slug | ✅ |
| `tags` | `text[]` | YES | 标签数组 | ✅ (需映射) |
| `language` | `text` | YES | 语言 (zh/en) | ✅ (需映射) |
| `file_url` | `text` | NO | 文件直链 | ✅ |
| `cover_image_url` | `text` | YES | 封面图 | ✅ |
| `thumbnail_url` | `text` | YES | 缩略图 | ✅ |
| `slides_count` | `integer` | YES | 页数 | ✅ |
| `download_count` | `integer` | YES | 下载数 | ✅ |
| `view_count` | `integer` | YES | 浏览数 | ✅ |
| `status` | `text` | YES | 状态 | ✅ |
| `description` | - | - | 描述 | ❌ (缺失) |
| `file_size` | - | - | 文件大小 | ❌ (缺失) |

### 1.2 DTO 映射策略
针对数据库缺失字段，应用层必须执行以下映射：

```typescript
// src/actions/ppt/ppt.ts

const toPPTDto = (row): PPT => ({
  // ... 基础字段 ...
  tags: row.tags ?? [],              // 确保数组类型
  language: row.language ?? 'zh',    // 默认为中文
  description: '',                   // 兜底为空串，前端需处理空值显示 (如显示"暂无简介")
  file_size: '',                     // 兜底为空串，前端需隐藏该字段
  
  // 关键: 图片回退策略
  // 1. 优先缩略图 -> 2. 封面图 -> 3. 本地占位图
  // 必须确保 public/placeholder.svg 存在
  preview_url: row.thumbnailUrl ?? row.coverImageUrl ?? '/placeholder.svg'
});
```

---

## 2. 种子数据方案

### 2.1 现有数据
- **数据量**: 68 条真实记录。
- **结论**: 数据库已就绪，**无需运行种子脚本**。直接使用现有数据开发。

### 2.2 补充数据 (如果需要)
仅当需要测试特定边界条件（如分页、大量搜索结果）时，可手动插入测试数据：

```sql
-- 插入测试数据的 SQL 模板
INSERT INTO ppt (
  id, title, category, author, tags, language,
  slides_count, file_url, download_count, view_count, status
) VALUES (
  'ppt_' || gen_random_uuid(), 'Test PPT', 'business', 'Tester',
  ARRAY['test'], 'en', 10, 'https://example.com/test.pptx', 0, 0, 'published'
);
```

---

## 3. 关键行动项

1.  **忽略缺失字段**: 不尝试迁移数据库添加 `description` 和 `file_size`，这属于后续迭代。本阶段专注于打通现有字段。
2.  **修复 DTO**: 必须在代码层面解决 `tags` 和 `language` 的传输问题。
3.  **分类清洗**: 数据库中的 `category` 值必须与前端新的 Slug 列表对齐。
    - *注意*: 如果数据库里存的是旧 slug (如 `business` 混用了“商务”和“述职”)，这属于数据清洗任务。**本次工程方案暂不包含数据清洗**，前端筛选时可能会出现混杂，但这被视为可接受的 V1 妥协。

---