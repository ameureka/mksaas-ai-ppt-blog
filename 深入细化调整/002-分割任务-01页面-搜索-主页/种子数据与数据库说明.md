# /ppt 种子数据与数据库说明（设计区）

> 仅文档，不落代码。基于 `001-datasize-vector-design` 的既有设计，假定 `ppt` 表已有可用数据。此处整理字段清单、种子思路与验证方法，供后续评审/执行。

## 1. 表结构要点（ppt）
- 主键：`id` (text)
- 核心字段：`title` (text)、`category` (text slug)、`author` (text)、`description` (text, 可空)
- 文件信息：`fileUrl` (text)、`fileSize` (text)、`slidesCount` (int)、`previewUrl` (text, 可空)
- 统计：`downloads` (int, default 0)、`views` (int, default 0)
- 状态：`status` (text, default `draft`)
- 时间：`uploadedAt`/`createdAt`/`updatedAt` (timestamp, default now)
- 索引（参考迁移 README）：`ppt_category_idx`、`ppt_status_idx`、`ppt_created_at_idx`、`ppt_downloads_idx`

## 2. 现有迁移/数据来源
- 目录：`/Users/amerlin/Desktop/v0-mksaas-analycis/method-v0-mk-saas/001-datasize-vector-design/`
  - `migrations/002_rename_indexes.sql`、`003_add_updated_at_triggers.sql` 已说明索引/触发器调整。
  - 数据量：README 提到 58 条 PPT 记录（假定已经存在 fileUrl/fileSize 等必填列）。
- 若需复用该库：直接指向同一数据库（Neon/本地）或导出/导入数据。

## 3. 种子数据方案（如需本仓导入）
1) 导出（在有数据的环境）：
```sql
COPY ppt TO STDOUT WITH CSV HEADER;
```
或筛选导出部分字段：
```sql
COPY (
  SELECT id,title,category,author,description,slides_count,file_size,file_url,preview_url,downloads,views,status,uploaded_at,created_at,updated_at
  FROM ppt
) TO STDOUT WITH CSV HEADER;
```
2) 导入到目标库：
```bash
psql $DATABASE_URL -c "\\copy ppt FROM 'ppt_seed.csv' CSV HEADER"
```
> 确保 `DATABASE_URL` 指向目标数据库，且表结构一致。

3) 插入示例（单条）：
```sql
INSERT INTO ppt (id,title,category,author,description,slides_count,file_size,file_url,preview_url,downloads,views,status,uploaded_at,created_at,updated_at)
VALUES (
  'ppt_seed_001',
  '年度商务汇报模板',
  'business',
  'Admin',
  '适用于年度/季度业绩汇报的商务风 PPT 模板',
  24,
  '5.2 MB',
  'https://cdn.example.com/ppt/business/report-2024.pptx',
  'https://cdn.example.com/ppt/business/report-2024-cover.webp',
  0,
  0,
  'published',
  NOW(),
  NOW(),
  NOW()
);
```

## 4. 字段与枚举建议
- 分类 slug：`business, education, technology, creative, marketing, medical, finance, hr, lifestyle, general`
- 语言（若添加）：`zh`/`en` 可作为可选字段；现有 `ppt` 表无语言列则无需填写。
- 状态：`draft`/`published`/`archived`（默认 draft）。

## 5. 验证清单
- 计数：`SELECT count(*) FROM ppt;` 预期有数据（示例：58）。
- 必填列非空：`file_url`, `file_size`, `title`, `category`, `author`.
- 触发器：若已执行 `003_add_updated_at_triggers.sql`，`updated_at` 应自动更新。
- 索引：`SELECT indexname FROM pg_indexes WHERE tablename='ppt';` 应包含 `ppt_category_idx` 等。

## 6. 使用方法（快速复用）
- 若沿用现有数据库：无需额外种子，直接指向该库。
- 若需本地独立库：导出 CSV -> 通过 `\copy` 导入；确认索引/触发器迁移已执行。

## 7. 后续扩展（非本次）
- 向量化/slide 表：`001-datasize-vector-design` 中包含 `slide`/向量索引说明，如需启用可另行导入。
- 热门搜索统计、下载日志等可在后续迭代增加表/触发器。***
