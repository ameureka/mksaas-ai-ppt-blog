# /ppt 搜索主页改造 - 接口设计草案（设计区）

> 仅作设计记录，不落代码。评审后迁移到 `src/`。

## 1. Server Action 接口（计划）

```ts
// 查询列表（分页/筛选/排序）
async function getPPTs(params?: {
  search?: string;
  category?: string;      // slug
  language?: 'zh' | 'en';
  status?: 'draft' | 'published' | 'archived';
  sortBy?: 'created_at' | 'downloads' | 'title';
  sortOrder?: 'asc' | 'desc';
  page?: number;
  pageSize?: number;
}): Promise<ServerActionResult<ListResult<PPT>>>;

// 详情
async function getPPTById(id: string): Promise<ServerActionResult<PPT>>;

// 创建
async function createPPT(input: CreatePPTInput): Promise<ServerActionResult<PPT>>;

// 更新
async function updatePPT(id: string, input: UpdatePPTInput): Promise<ServerActionResult<PPT>>;

// 删除
async function deletePPT(id: string): Promise<ServerActionResult<void>>;

// 计数
async function recordDownload(id: string): Promise<ServerActionResult<void>>;
async function recordView(id: string): Promise<ServerActionResult<void>>;

// 仪表盘统计
async function getDashboardStats(): Promise<ServerActionResult<{
  totalPPTs: number;
  totalUsers: number;
  totalDownloads: number;
  todayDownloads: number;
  weeklyGrowth: number;
}>>;
```
- 规范：返回格式遵循 MkSaaS 标准 `{ success: true/false, data?/error? }`；`'use server'` 置顶；命名/字段映射遵循 TS camelCase -> DB snake_case。

## 2. 数据映射（ppt 表 -> DTO）
- 必填：`id`, `title`, `category`, `author`, `fileUrl`, `fileSize`, `slidesCount`, `downloads`, `views`, `status`, `createdAt/updatedAt/uploadedAt`。
- 可选：`description`, `previewUrl`, `language`（如有列则映射）。
- DTO 字段：`slides_count/file_url/file_size/preview_url/created_at/updated_at/uploaded_at` 采用 snake_case 兼容现有类型。

## 3. 配置草稿（暂存设计）
```ts
export const pptConfig = {
  requireLoginForDownload: false, // 默认免登录；管理后台按钮可切换
  hotKeywords: ['年终总结','工作汇报','项目提案','述职报告','商业计划','培训课件','产品介绍','营销方案'],
  categories: [
    { slug: 'business', label: '商务汇报' },
    { slug: 'education', label: '教育培训' },
    { slug: 'technology', label: '科技互联网' },
    { slug: 'creative', label: '创意设计' },
    { slug: 'marketing', label: '营销策划' },
    { slug: 'medical', label: '医疗健康' },
    { slug: 'finance', label: '金融财务' },
    { slug: 'hr', label: '人力资源' },
    { slug: 'lifestyle', label: '生活休闲' },
    { slug: 'general', label: '通用模板' },
  ],
};
```

## 4. 页面数据流（方案）
- `/ppt`：RSC 调用 `getPPTs`，接受 query `search/category/language/sort/page/pageSize`；渲染列表 + 分页；热门关键词用配置兜底。
- `/ppt/category/[name]`：将 `[name]` 视为 slug，调用 `getPPTs` 传 `category`；分类元信息来自静态映射。
- `/ppt/[id]`：调用 `getPPTById`；进入页可选触发 `recordView(id)`（可在 server action 或 route handler 中）。
- 下载按钮：触发 server action/route `downloadPPT(id)`（伪）；内部检查 `requireLoginForDownload`，未登录则返回错误；已通过则调用 `recordDownload` 并返回 `fileUrl`/重定向；开关可由后台按钮切换。

## 5. 管理端数据流
- 列表页：调用 `getPPTs`（带分页/排序）；前端筛选可直接在 action 层处理。
- 创建/编辑：表单提交到 `createPPT`/`updatePPT`；字段为文本（file_url/preview_url 手工填），无上传。
- 删除：调用 `deletePPT`；成功后刷新列表。
- 统计卡片：调用 `getDashboardStats`。

## 6. 迁移步骤（摘要）
- 先在设计外完成 Drizzle 实现（对应 Server Actions），再迁到 `src/actions/ppt/*`。
- 配置与静态映射落到 constants；开关读配置。
- 前台页面改造为 RSC 获取数据，接入分页/筛选。
- 下载链路与登录开关按配置生效。

## 7. 风险与 TODO
- 数据缺失：确保表里有必填列（fileUrl/fileSize 等）；无数据需提供 seed。
- 登录开关：需明确存放位置（env vs websiteConfig）。
- 热门关键词：目前静态，后续接入热门搜索统计。***
