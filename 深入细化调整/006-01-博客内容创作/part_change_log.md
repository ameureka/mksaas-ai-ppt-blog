# 博客内容创作变更日志

## 2025-12-02 更新 (第五次)

### 内容感知深度增强
- **元素映射规则**：从 15 条增加到 **35 条**
- **新增类别**：人物角色、对比选择、结构框架、年终特有、营销特有、教育特有
- **关键词提取**：增加优先级排序（高/中/低），标题核心词优先

### 文档更新
- **封面与配图生成方案-最终.md**：添加实现状态、数据统计、内容感知系统说明
- **agent.md**：更新实现状态、数据结构、使用流程
- **gemini-image-pipeline-unified.md**：更新元素映射表（35 条）、实现状态

---

## 2025-12-02 更新 (第四次)

### 文档合并
- **合并三个设计文档**：`gemini-cli-pipeline-design.md`、`gemini-image3-补充设计.md`、`gemni-nanobanana-design.md`
- **输出**：`gemini-image-pipeline-unified.md` - 统一的 Gemini 图片生成流水线设计方案
- **内容**：流水线架构、分类风格、Prompt 模板、执行计划、后处理、验收标准

---

## 2025-12-02 更新 (第三次)

### 分类配置一致性修复
- **新增 tips 分类**：在 `category-styles.ts` 中添加「模板技巧」分类的风格定义
- **分类统计更新**：原 `通用技巧: 41 篇` 拆分为 `模板技巧: 18 篇` + `通用技巧: 23 篇`
- **风格一致性**：所有 8 个分类现在都有对应的风格配置

---

## 2025-12-02 更新 (第二次)

### 内容关联性修复
- **段落内容传递**：`detectSceneType` 和 `getSceneElements` 现在接收 H2 下的段落内容
- **内容感知元素映射**：新增 15+ 关键词模式，根据内容生成针对性画面元素
- **文章关键词提取**：封面关键词从文章内容提取，不再使用通用分类关键词

### 效果改进
- 内页元素与内容高度关联（如 Logo 场景包含 Logo图标、品牌标识）
- 场景类型判断更准确（步骤类内容正确识别为 flow）
- 封面关键词更精准（如 Logo、品牌、配色、字体）

---

## 2025-12-02 更新

### generate-prompts.ts 重构
- **分类自动映射**：根据 MDX 文件所在目录自动映射分类（方案 B），无需修改原文件
- **英文 Slug 转换**：中文标题自动转换为 SEO 友好的英文 slug
- **分类统计**：100 篇文章正确分配到 8 个分类

### 配置文件整理
- **新建 category-config.ts**：统一分类配置
- **废弃 category-styles.ts**：添加 @deprecated 标记
- **废弃 category-map.ts**：添加 @deprecated 标记

### 数据更新
- **image-tasks.json**：重新生成，包含正确的分类和英文 slug
- **pending-prompts.md**：重新导出待处理清单

---

## 2025-12-01 更新

### 项目结构
- 创建 PPT 分类 MDX 文件（14 个）
- 更新 README.md 路径引用
- 扩展 source.config.ts Schema（tags, seoKeywords, relatedPosts）
- 更新 topics.json 状态

---

## 历史记录

### 脚本改动思路
- **统一提示词来源**：调用 `config/prompt-templates.ts` 中的封面/内页模板
- **场景解析与要素补全**：用 `detectSceneType` 判别场景类型，用 `getSceneElements` 补足元素
- **CLI 可控性增强**：新增 `--text-strategy` 选项
- **安全回退策略**：分类或场景信息不足时走默认分支
