以下为对认证模块的静态分析要点（未改动代码、未运行命令）：

认证后端基于 Better Auth：使用 Drizzle 适配器连接数据库、开启邮箱+密码登录且强制邮箱验证、内置 GitHub/Google 社交登录和账号关联、启用 admin 插件并配置统一的 /auth/error 错误回调，同时通过数据库 hook 在创建用户时自动订阅新闻邮件、发放注册礼品积分和月度免费积分。

客户端通过 createAuthClient 与后端交互，统一使用 baseURL 和 admin 客户端插件，并从服务端配置中推断附加字段类型。

API 路由 POST/GET /api/auth/[...all] 直接转发给 Better Auth 处理，形成与 Next.js App Router 的桥接。

前端认证界面独立布局（非公共分组），在 /[locale]/auth 下居中呈现并提供返回按钮，登录/注册页面使用 generateMetadata 注入本地化 SEO 信息和条款链接。

登录与注册表单为客户端组件：支持 Turnstile 验证（可配置）、本地化校验文案、显式回调 URL 处理、密码显隐切换、错误/成功提示，并在登录/注册完成后可触发社交登录按钮或回调重定向；注册表单还支持 Affonso 联盟扩展钩子。

服务端使用 Better Auth 配置 Drizzle 适配器、会话缓存、邮件验证码/重置密码链路，并强制邮箱验证；启用 GitHub/Google 社交登录、账号链接、可删除用户和 admin 插件（封禁提示），同时在用户创建后自动处理订阅赠礼与额度赠送等业务钩子。

App Router 下的 /auth 段落提供登录、注册、忘记/重置密码和错误页，公用独立布局并用 next-intl 生成多语元数据，与站内条款/隐私链接联动。

登录表单支持邮箱密码登录可选 Turnstile 验证码、错误/成功提示与密码可见切换；回调 URL 优先顺序为 props→参数→默认重定向，并在启用时追加社交登录按钮。

社交登录按钮根据站点配置展示 Google/GitHub，并通过 better-auth 客户端发起 signIn.social，带成功/错误回调及错误页面路由；未开启任何社交登录时自动隐藏组件。

路由常量集中定义了认证路径与受保护路由列表；中间件在 Edge 层读取会话，阻止已登录用户访问登录/注册，未登录访问受保护路由时重定向至登录并附带回跳地址，同时兼顾 i18n 文档重定向。

认证模块概览
后端使用 Better Auth 配置在 src/lib/auth.ts：依赖 Drizzle 适配器连接 Postgres，启用邮箱密码登录并强制邮箱验证，支持 GitHub/Google 社交登录和账号关联，启用管理员插件、用户删除及额外字段（customerId），同时自定义 API 错误跳转到 /auth/error。

用户创建后触发钩子：若站点配置允许，将用户自动加入 Newsletter、发放注册赠送积分，并根据免费套餐配置附加每月免费积分。

API 路由通过 toNextJsHandler 将 Better Auth 暴露为 /api/auth/[...all] 的 GET/POST 处理器。

客户端通过 authClient 创建 Better Auth React 客户端，配置基础 URL 并启用 adminClient 与额外字段推断插件，供表单调用登录/注册等操作。

App Router 下的认证界面位于 src/app/[locale]/auth，拥有独立的居中布局、加载态与按 locale 生成的元数据，覆盖登录、注册、忘记密码和重设密码页面。

登录表单为客户端组件：支持 Turnstile 可选验证码、凭证登录开关、社会化登录入口、回调 URL 透传及错误提示；提交时调用 authClient.signIn.email，可根据配置或查询参数决定回调地址。

认证模块概览
服务端以 Better Auth 驱动，使用 Drizzle 适配器连接数据库，开启邮箱密码与社交（GitHub/Google）登录、邮箱验证、账号联动，并挂载 Admin 插件；配置中还通过 locale 感知的邮件模板发送重置与验证邮件。

用户创建后触发数据库钩子：自动延迟订阅 Newsletter，并按配置发放注册赠送积分及月度免费积分，结合价格方案检查免费套餐可用性。

API 层通过 /api/auth/[...all] 路由暴露 Better Auth handler；客户端用 authClient（含 adminClient 插件与额外字段推断）调用登录、注册等动作。

中间件仅以会话 Cookie 快速判定登录态，禁止已登录用户访问登录/注册页，并将未登录用户访问保护路由时重定向到登录页，附带 callbackUrl；受保护路径和默认登录重定向在 routes.ts 声明。

前端表单位于 src/components/auth：登录/注册表单可配置 Turnstile Captcha、处理回调地址并支持社交登录；忘记/重置密码表单调用 authClient 的对应接口并处理 pending/error 状态与国际化文案。

