# 任务清单标准

## 概述

任务清单将设计文档转化为可执行的编码任务，供编码代理逐步实现。

## 文档格式

```markdown
# Implementation Plan

- [ ] 1. 顶级任务描述
  - 任务详情
  - _Requirements: X.Y_

- [ ] 2. 另一个顶级任务
- [ ] 2.1 子任务 A
  - 子任务详情
  - _Requirements: X.Y, Z.W_

- [ ]* 2.2 可选子任务 (测试相关)
  - **Property N: 属性名称**
  - **Validates: Requirements X.Y**

- [ ] 3. Checkpoint - 确保所有测试通过
  - Ensure all tests pass, ask the user if questions arise.
```

## 任务层级规则

### 最多两级层级
- 顶级任务 (如 epic)
- 子任务 (使用小数编号: 1.1, 1.2, 2.1)

### 编号格式
```
- [ ] 1. 顶级任务
- [ ] 1.1 子任务
- [ ] 1.2 子任务
- [ ] 2. 顶级任务
- [ ] 2.1 子任务
```

## 可选任务标记

### 标记规则
- 使用 `*` 后缀标记可选任务
- **只有子任务可以标记为可选**
- 顶级任务**永远不能**标记为可选

### 正确示例
```markdown
- [ ] 2. 实现数据模型
- [ ] 2.1 创建核心接口
- [ ]* 2.2 编写单元测试
- [ ]* 2.3 编写属性测试
```

### 错误示例
```markdown
- [ ]* 2. 实现数据模型  ❌ 顶级任务不能标记为可选
```

### 可选任务类型
以下类型的任务**应该**标记为可选：
- 属性测试
- 单元测试
- 集成测试
- 测试工具
- 测试夹具

### 非可选任务
以下类型的任务**永远不能**标记为可选：
- 核心实现任务
- 接口定义
- 数据模型创建

## 任务内容要求

### 每个任务必须包含

1. **清晰的目标** - 涉及编写、修改或测试代码
2. **附加信息** - 作为子项列出
3. **需求引用** - 引用具体的需求条款

### 任务描述指南

| 好的描述 | 差的描述 |
|----------|----------|
| 实现 UserService.createUser 方法 | 支持用户功能 |
| 创建 User 数据模型接口 | 设置用户相关内容 |
| 编写密码哈希的属性测试 | 测试用户模块 |

### 需求引用格式
```markdown
- [ ] 1.1 实现用户注册 API
  - 创建 POST /api/users 端点
  - 验证输入数据
  - _Requirements: 1.1, 1.2, 1.3_
```

## 属性测试任务

### 位置要求
属性测试任务**必须**紧跟相关实现任务，以便尽早发现错误。

### 格式要求
```markdown
- [ ]* 2.2 编写属性测试: 往返一致性
  - **Property 2: Round trip consistency**
  - **Validates: Requirements 2.5**
```

### 每个属性一个任务
每个正确性属性**必须**有独立的子任务。

## Checkpoint 任务

### 用途
在合理的断点处添加检查点，确保所有测试通过。

### 格式
```markdown
- [ ] 4. Checkpoint - 确保所有测试通过
  - Ensure all tests pass, ask the user if questions arise.
```

### 位置
- 在完成一组相关功能后
- 在开始新的主要功能前
- 在最终任务之前

## 禁止的任务类型

以下类型的任务**不应该**包含在任务清单中：

| 禁止类型 | 原因 |
|----------|------|
| 用户验收测试 | 非编码任务 |
| 部署到生产环境 | 非编码任务 |
| 性能指标收集 | 非编码任务 |
| 手动运行应用测试 | 非编码任务 |
| 用户培训 | 非编码任务 |
| 文档创建 | 除非明确要求 |
| 业务流程变更 | 非编码任务 |

## 完整示例

```markdown
# Implementation Plan

- [ ] 1. 设置项目结构和核心接口
  - 创建 models, services, repositories 目录结构
  - 定义系统边界接口
  - 设置测试框架
  - _Requirements: 1.1_

- [ ] 2. 实现数据模型和验证
- [ ] 2.1 创建核心数据模型接口和类型
  - 编写所有数据模型的 TypeScript 接口
  - 实现数据完整性验证函数
  - _Requirements: 2.1, 3.3, 1.2_

- [ ]* 2.2 编写属性测试: 往返一致性
  - **Property 2: Round trip consistency**
  - **Validates: Requirements 2.5**

- [ ] 2.3 实现 User 模型和验证
  - 编写 User 类和验证方法
  - _Requirements: 1.2_

- [ ]* 2.4 编写属性测试: 删除重排一致性
  - **Property 5: Delete reordering consistency**
  - **Validates: Requirements 6.4**

- [ ] 2.5 实现 Document 模型和关系
  - 编写 Document 类和关系处理
  - _Requirements: 2.1, 3.3, 1.2_

- [ ]* 2.6 编写数据模型单元测试
  - 创建 User 模型验证的单元测试
  - 编写 Document 模型的单元测试
  - 编写关系管理的单元测试
  - _Requirements: 2.1, 3.3, 1.2_

- [ ] 3. Checkpoint - 确保所有测试通过
  - Ensure all tests pass, ask the user if questions arise.

- [ ] 4. 创建存储机制
- [ ] 4.1 实现数据库连接工具
  - 编写连接管理代码
  - 创建数据库操作的错误处理工具
  - _Requirements: 2.1, 3.3, 1.2_

- [ ] 4.2 实现仓储模式的数据访问
  - 编写基础仓储接口
  - 实现具体仓储的 CRUD 操作
  - _Requirements: 4.3_

- [ ]* 4.3 编写属性测试: 存储往返
  - **Property 1: Storage round trip**
  - **Validates: Requirements 4.1**

[更多任务...]

- [ ] n. 最终 Checkpoint - 确保所有测试通过
  - Ensure all tests pass, ask the user if questions arise.
```

## 任务执行规则

### 单任务执行
- 每次只执行一个任务
- 完成后停止，等待用户指示
- 不要自动继续下一个任务

### 子任务优先
- 如果任务有子任务，先执行子任务
- 所有子任务完成后，标记父任务完成

### 可选任务处理
- 标记为 `*` 的任务不会自动执行
- 用户可以选择跳过或执行

## 检查清单

在提交任务清单前，确认：

- [ ] 最多两级层级
- [ ] 使用正确的编号格式
- [ ] 只有子任务标记为可选
- [ ] 每个任务有清晰的编码目标
- [ ] 每个任务引用具体需求
- [ ] 属性测试任务紧跟实现任务
- [ ] 每个属性有独立的子任务
- [ ] 包含合理的 Checkpoint
- [ ] 不包含非编码任务
- [ ] 所有需求都被任务覆盖
