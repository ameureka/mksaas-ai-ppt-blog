# QA-17.0 æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

## ğŸ“‹ é—®é¢˜
é¡¹ç›®æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ

## âœ… å›ç­”

é¡¹ç›®çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å›´ç»• **SaaS è®¢é˜…æœåŠ¡** å±•å¼€ï¼Œä¸»è¦åŒ…æ‹¬**ç”¨æˆ·è®¤è¯**ã€**æ”¯ä»˜è®¢é˜…**ã€**ç§¯åˆ†ç³»ç»Ÿ**å’Œ**AI åŠŸèƒ½**å››å¤§æ ¸å¿ƒæ¨¡å—ã€‚

### ğŸ” æ ¸å¿ƒé€»è¾‘ 1: ç”¨æˆ·è®¤è¯ä¸ç®¡ç†

#### è®¤è¯æµç¨‹

**æŠ€æœ¯**: Better Auth 1.1.19

**æ”¯æŒçš„è®¤è¯æ–¹å¼**:

**1. é‚®ç®±/å¯†ç ç™»å½•**:

```
ç”¨æˆ·æ³¨å†Œ
    â”‚
    â”œâ”€â”€â–º è¾“å…¥é‚®ç®±å’Œå¯†ç 
    â”œâ”€â”€â–º åˆ›å»º user è®°å½•
    â”œâ”€â”€â–º åˆ›å»º account è®°å½•ï¼ˆå¯†ç å“ˆå¸Œï¼‰
    â”œâ”€â”€â–º å‘é€éªŒè¯é‚®ä»¶ï¼ˆåˆ›å»º verification è®°å½•ï¼‰
    â”œâ”€â”€â–º è‡ªåŠ¨è®¢é˜…æ—¶äº‹é€šè®¯
    â””â”€â”€â–º èµ é€æ³¨å†Œç§¯åˆ†ï¼ˆ50 ç§¯åˆ†ï¼Œ30 å¤©è¿‡æœŸï¼‰

ç”¨æˆ·ç™»å½•
    â”‚
    â”œâ”€â”€â–º è¾“å…¥é‚®ç®±å’Œå¯†ç 
    â”œâ”€â”€â–º éªŒè¯å¯†ç å“ˆå¸Œ
    â”œâ”€â”€â–º æ£€æŸ¥é‚®ç®±éªŒè¯çŠ¶æ€
    â”œâ”€â”€â–º æ£€æŸ¥å°ç¦çŠ¶æ€
    â”œâ”€â”€â–º åˆ›å»º session
    â””â”€â”€â–º è¿”å›ä¼šè¯ tokenï¼ˆHttpOnly Cookieï¼‰

é‚®ç®±éªŒè¯
    â”‚
    â”œâ”€â”€â–º ç”¨æˆ·ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥
    â”œâ”€â”€â–º éªŒè¯ token
    â”œâ”€â”€â–º æ›´æ–° user.emailVerified = true
    â””â”€â”€â–º åˆ é™¤ verification è®°å½•
```

**æ¥æº**: `src/lib/auth.ts`

**2. OAuth ç™»å½•ï¼ˆGitHub/Googleï¼‰**:

```
ç”¨æˆ·ç‚¹å‡»"ä½¿ç”¨ GitHub ç™»å½•"
    â”‚
    â”œâ”€â”€â–º è·³è½¬åˆ° GitHub æˆæƒé¡µé¢
    â”œâ”€â”€â–º ç”¨æˆ·æˆæƒ
    â”œâ”€â”€â–º GitHub å›è°ƒ /api/auth/callback/github
    â”œâ”€â”€â–º Better Auth å¤„ç†å›è°ƒ
    â”œâ”€â”€â–º æŸ¥æ‰¾æˆ–åˆ›å»º user è®°å½•
    â”œâ”€â”€â–º åˆ›å»º account è®°å½•ï¼ˆå­˜å‚¨ OAuth tokenï¼‰
    â”œâ”€â”€â–º è‡ªåŠ¨è®¢é˜…æ—¶äº‹é€šè®¯
    â”œâ”€â”€â–º èµ é€æ³¨å†Œç§¯åˆ†
    â””â”€â”€â–º åˆ›å»º sessionï¼Œç™»å½•æˆåŠŸ
```

**æ¥æº**: `src/lib/auth.ts`, Better Auth OAuth æµç¨‹

**3. è´¦æˆ·é“¾æ¥**:

```
å·²æœ‰é‚®ç®±è´¦æˆ·çš„ç”¨æˆ·è¿æ¥ GitHub
    â”‚
    â”œâ”€â”€â–º ç”¨æˆ·å·²ç™»å½•ï¼ˆsession å­˜åœ¨ï¼‰
    â”œâ”€â”€â–º ç‚¹å‡»"è¿æ¥ GitHub"
    â”œâ”€â”€â–º GitHub æˆæƒ
    â”œâ”€â”€â–º Better Auth æ£€æµ‹åˆ°å·²ç™»å½•
    â”œâ”€â”€â–º é“¾æ¥ GitHub è´¦æˆ·åˆ°ç°æœ‰ç”¨æˆ·
    â””â”€â”€â–º åˆ›å»ºæ–°çš„ account è®°å½•ï¼ˆproviderId: 'github'ï¼‰

åŒä¸€ç”¨æˆ·ç°åœ¨å¯ä»¥ç”¨é‚®ç®±æˆ– GitHub ç™»å½•
```

**æ¥æº**: `src/lib/auth.ts`

#### ä¼šè¯ç®¡ç†

```typescript
session: {
  expiresIn: 60 * 60 * 24 * 7,      // 7 å¤©è¿‡æœŸ
  updateAge: 60 * 60 * 24,          // 24 å°æ—¶æ›´æ–°ä¸€æ¬¡
  cookieCache: {
    enabled: true,
    maxAge: 60 * 60                 // 1 å°æ—¶ç¼“å­˜
  }
}
```

**å®‰å…¨ç‰¹æ€§**:
- âœ… HttpOnly Cookieï¼ˆé˜² XSSï¼‰
- âœ… Secure Cookieï¼ˆä»… HTTPSï¼‰
- âœ… SameSite=Laxï¼ˆé˜² CSRFï¼‰
- âœ… IP åœ°å€è®°å½•
- âœ… User Agent è®°å½•
- âœ… å®šæœŸ token åˆ·æ–°

**æ¥æº**: `src/lib/auth.ts`

#### ç”¨æˆ·å°ç¦ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

```
ç®¡ç†å‘˜å°ç¦ç”¨æˆ·
    â”‚
    â”œâ”€â”€â–º ç®¡ç†å‘˜è®¿é—® /admin/users
    â”œâ”€â”€â–º é€‰æ‹©ç”¨æˆ·ï¼Œç‚¹å‡»"å°ç¦"
    â”œâ”€â”€â–º è®¾ç½®å°ç¦åŸå› å’Œè¿‡æœŸæ—¶é—´
    â”œâ”€â”€â–º æ›´æ–° user.banned = true
    â”œâ”€â”€â–º è®¾ç½® user.banReason
    â”œâ”€â”€â–º è®¾ç½® user.banExpiresï¼ˆå¯é€‰ï¼‰
    â””â”€â”€â–º åˆ é™¤æ‰€æœ‰æ´»è·ƒ sessionï¼ˆç”¨æˆ·è¢«å¼ºåˆ¶ç™»å‡ºï¼‰

è¢«å°ç¦ç”¨æˆ·å°è¯•ç™»å½•
    â”‚
    â”œâ”€â”€â–º Better Auth æ£€æŸ¥ user.banned
    â”œâ”€â”€â–º å¦‚æœ banned = true
    â”œâ”€â”€â–º æ£€æŸ¥ banExpires
    â”œâ”€â”€â”€â”€ å¦‚æœæœªè¿‡æœŸï¼Œæ‹’ç»ç™»å½•
    â””â”€â”€â”€â”€ æ˜¾ç¤ºå°ç¦æ¶ˆæ¯
```

**æ¥æº**: `src/lib/auth.ts`, `src/db/schema.ts`

### ğŸ’³ æ ¸å¿ƒé€»è¾‘ 2: æ”¯ä»˜ä¸è®¢é˜…

#### è®¢é˜…è´­ä¹°æµç¨‹

```
ç”¨æˆ·é€‰æ‹© Pro æœˆä»˜è®¡åˆ’ï¼ˆ$9.90/æœˆï¼‰
    â”‚
    â”œâ”€â”€â–º å‰ç«¯è°ƒç”¨ createCheckoutAction
    â”‚     - planId: 'pro'
    â”‚     - priceId: 'price_xxx'
    â”‚
    â”œâ”€â”€â–º Server Action
    â”‚     â”œâ”€ è·å–ç”¨æˆ·ä¼šè¯
    â”‚     â”œâ”€ æŸ¥æ‰¾æˆ–åˆ›å»º Stripe å®¢æˆ·
    â”‚     â”œâ”€ åˆ›å»º Stripe Checkout Session
    â”‚     â””â”€ è¿”å› checkout URL
    â”‚
    â”œâ”€â”€â–º ç”¨æˆ·è·³è½¬åˆ° Stripe Checkout
    â”‚     â”œâ”€ Stripe æ‰˜ç®¡çš„å®‰å…¨æ”¯ä»˜é¡µé¢
    â”‚     â”œâ”€ è¾“å…¥ä¿¡ç”¨å¡ä¿¡æ¯
    â”‚     â””â”€ å®Œæˆæ”¯ä»˜
    â”‚
    â”œâ”€â”€â–º Stripe è§¦å‘ Webhook
    â”‚     - Event: checkout.session.completed
    â”‚     - POST /api/webhooks/stripe
    â”‚
    â”œâ”€â”€â–º Webhook å¤„ç†å™¨
    â”‚     â”œâ”€ éªŒè¯ Stripe ç­¾å
    â”‚     â”œâ”€ æå– metadataï¼ˆuserId, planIdï¼‰
    â”‚     â”œâ”€ åˆ›å»º payment è®°å½•
    â”‚     â”‚   - type: 'subscription'
    â”‚     â”‚   - scene: 'subscription'
    â”‚     â”‚   - status: 'active'
    â”‚     â”œâ”€ æ›´æ–° user.customerId
    â”‚     â”œâ”€ å‘æ”¾è®¢é˜…ç§¯åˆ†ï¼ˆ1000 ç§¯åˆ†ï¼Œ30 å¤©è¿‡æœŸï¼‰
    â”‚     â”‚   - åˆ›å»º userCredit è®°å½•
    â”‚     â”‚   - åˆ›å»º creditTransaction è®°å½•ï¼ˆtype: 'monthly'ï¼‰
    â”‚     â””â”€ å‘é€é€šçŸ¥ï¼ˆDiscord/é£ä¹¦ï¼‰
    â”‚
    â”œâ”€â”€â–º å‰ç«¯è½®è¯¢æ”¯ä»˜çŠ¶æ€
    â”‚     - checkPaymentCompletionAction
    â”‚     - æ¯ 2 ç§’æŸ¥è¯¢ä¸€æ¬¡
    â”‚     - æœ€å¤š 60 ç§’
    â”‚
    â””â”€â”€â–º ç¡®è®¤æ”¯ä»˜æˆåŠŸ
          - è·³è½¬åˆ° /settings/billing
          - æ˜¾ç¤ºè®¢é˜…æˆåŠŸæ¶ˆæ¯
```

**æ¥æº**: `src/actions/create-checkout-session.ts`, `src/app/api/webhooks/stripe/route.ts`, `src/payment/provider/stripe.ts`

#### è®¢é˜…æ›´æ–°æµç¨‹

```
Stripe æ¯æœˆè‡ªåŠ¨æ‰£æ¬¾
    â”‚
    â”œâ”€â”€â–º Stripe è§¦å‘ Webhook
    â”‚     - Event: invoice.paid
    â”‚
    â”œâ”€â”€â–º Webhook å¤„ç†å™¨
    â”‚     â”œâ”€ æŸ¥æ‰¾ payment è®°å½•ï¼ˆé€šè¿‡ invoiceIdï¼‰
    â”‚     â”œâ”€ æ›´æ–° payment.paid = true
    â”‚     â”œâ”€ æ›´æ–° payment.periodStart å’Œ periodEnd
    â”‚     â”œâ”€ å‘æ”¾æœ¬æœˆç§¯åˆ†ï¼ˆ1000 ç§¯åˆ†ï¼Œ30 å¤©è¿‡æœŸï¼‰
    â”‚     â”‚   - åˆ›å»ºæ–°çš„ creditTransaction è®°å½•
    â”‚     â”‚   - æ›´æ–° userCredit.currentCredits
    â”‚     â””â”€ å‘é€é€šçŸ¥
    â”‚
    â””â”€â”€â–º ç”¨æˆ·ç§¯åˆ†è‡ªåŠ¨ç»­æœŸ
```

**æ¥æº**: `src/payment/provider/stripe.ts`

#### è®¢é˜…å–æ¶ˆæµç¨‹

```
ç”¨æˆ·å–æ¶ˆè®¢é˜…
    â”‚
    â”œâ”€â”€â–º ç”¨æˆ·è®¿é—®å®¢æˆ·é—¨æˆ·
    â”‚     - createCustomerPortalAction
    â”‚     - è·³è½¬åˆ° Stripe å®¢æˆ·é—¨æˆ·
    â”‚
    â”œâ”€â”€â–º ç”¨æˆ·ç‚¹å‡»"å–æ¶ˆè®¢é˜…"
    â”‚     - é€‰æ‹©å–æ¶ˆåŸå› 
    â”‚     - ç¡®è®¤å–æ¶ˆ
    â”‚
    â”œâ”€â”€â–º Stripe è§¦å‘ Webhook
    â”‚     - Event: customer.subscription.updated
    â”‚     - subscription.cancel_at_period_end = true
    â”‚
    â”œâ”€â”€â–º Webhook å¤„ç†å™¨
    â”‚     - æ›´æ–° payment.cancelAtPeriodEnd = true
    â”‚
    â”œâ”€â”€â–º è®¢é˜…ç»§ç»­åˆ°æœŸæœ«
    â”‚     - ç”¨æˆ·ä»å¯ä½¿ç”¨ Pro åŠŸèƒ½
    â”‚     - ç§¯åˆ†ä»ç„¶å‘æ”¾
    â”‚
    â”œâ”€â”€â–º è®¢é˜…æœŸç»“æŸ
    â”‚     - Stripe è§¦å‘ Webhook
    â”‚     - Event: customer.subscription.deleted
    â”‚
    â”œâ”€â”€â–º Webhook å¤„ç†å™¨
    â”‚     - æ›´æ–° payment.status = 'canceled'
    â”‚     - åœæ­¢å‘æ”¾ç§¯åˆ†
    â”‚
    â””â”€â”€â–º ç”¨æˆ·é™çº§ä¸ºå…è´¹è®¡åˆ’
          - ä»ä¿ç•™å‰©ä½™ç§¯åˆ†ï¼ˆç›´åˆ°è¿‡æœŸï¼‰
```

**æ¥æº**: `src/actions/create-customer-portal-session.ts`, `src/payment/provider/stripe.ts`

### ğŸª™ æ ¸å¿ƒé€»è¾‘ 3: ç§¯åˆ†ç³»ç»Ÿ

#### ç§¯åˆ†è·å–

**1. æ³¨å†Œèµ é€**:

```
æ–°ç”¨æˆ·æ³¨å†Œ
    â”‚
    â”œâ”€â”€â–º Better Auth è§¦å‘ user.create.after é’©å­
    â”‚
    â”œâ”€â”€â–º åˆ›å»º userCredit è®°å½•
    â”‚     - currentCredits: 50
    â”‚
    â””â”€â”€â–º åˆ›å»º creditTransaction è®°å½•
          - type: 'gift'
          - amount: 50
          - expirationDate: 30 å¤©å
```

**æ¥æº**: `src/lib/auth.ts`, `src/credits/credits.ts`

**2. è®¢é˜…èµ é€**:

```
ç”¨æˆ·è®¢é˜… Pro è®¡åˆ’
    â”‚
    â”œâ”€â”€â–º Stripe Webhook: invoice.paid
    â”‚
    â”œâ”€â”€â–º æ›´æ–° userCredit.currentCredits += 1000
    â”‚
    â””â”€â”€â–º åˆ›å»º creditTransaction è®°å½•
          - type: 'monthly'
          - amount: 1000
          - expirationDate: 30 å¤©å
```

**3. è´­ä¹°ç§¯åˆ†åŒ…**:

```
ç”¨æˆ·è´­ä¹° 100 ç§¯åˆ†åŒ…ï¼ˆ$9.90ï¼‰
    â”‚
    â”œâ”€â”€â–º createCreditCheckoutAction
    â”‚
    â”œâ”€â”€â–º Stripe Checkout æ”¯ä»˜
    â”‚
    â”œâ”€â”€â–º Stripe Webhook: checkout.session.completed
    â”‚
    â”œâ”€â”€â–º åˆ›å»º payment è®°å½•
    â”‚     - scene: 'credit'
    â”‚     - type: 'one_time'
    â”‚
    â”œâ”€â”€â–º æ›´æ–° userCredit.currentCredits += 100
    â”‚
    â””â”€â”€â–º åˆ›å»º creditTransaction è®°å½•
          - type: 'purchase'
          - amount: 100
          - paymentId: invoice.id
          - expirationDate: 30 å¤©å
```

**æ¥æº**: `src/actions/create-credit-checkout-session.ts`, `src/credits/credits.ts`

#### ç§¯åˆ†æ¶ˆè´¹

```
ç”¨æˆ·ä½¿ç”¨ AI èŠå¤©åŠŸèƒ½
    â”‚
    â”œâ”€â”€â–º å‰ç«¯è°ƒç”¨ AI API
    â”‚
    â”œâ”€â”€â–º AI API å¤„ç†å‰
    â”‚     â”œâ”€ æ£€æŸ¥ç”¨æˆ·ç§¯åˆ†ä½™é¢
    â”‚     â”‚   - getUserCredits(userId)
    â”‚     â”‚   - å¦‚æœ currentCredits < 1ï¼Œè¿”å›é”™è¯¯
    â”‚     â””â”€ æ¶ˆè´¹ 1 ç§¯åˆ†
    â”‚         - consumeCredits(userId, 1, 'AI chat')
    â”‚
    â”œâ”€â”€â–º consumeCredits é€»è¾‘
    â”‚     â”œâ”€ å¼€å¯äº‹åŠ¡
    â”‚     â”œâ”€ æ›´æ–° userCredit.currentCredits -= 1
    â”‚     â”œâ”€ åˆ›å»º creditTransaction è®°å½•
    â”‚     â”‚   - type: 'usage'
    â”‚     â”‚   - amount: -1
    â”‚     â””â”€ æäº¤äº‹åŠ¡
    â”‚
    â””â”€â”€â–º AI API ç»§ç»­å¤„ç†è¯·æ±‚
```

**æ¥æº**: `src/actions/consume-credits.ts`, AI API è·¯ç”±

**ç§¯åˆ†æ¶ˆè´¹åœºæ™¯**:
- AI èŠå¤©ï¼š1 ç§¯åˆ†/æ¶ˆæ¯
- AI å›¾ç‰‡ç”Ÿæˆï¼š5 ç§¯åˆ†/å¼ 
- ç½‘é¡µå†…å®¹åˆ†æï¼š2 ç§¯åˆ†/æ¬¡

#### ç§¯åˆ†è¿‡æœŸå¤„ç†

```
Cron Jobï¼ˆæ¯å¤© 00:00 UTCï¼‰
    â”‚
    â”œâ”€â”€â–º GET /api/distribute-credits
    â”‚     - éªŒè¯ Cron æˆæƒ
    â”‚
    â”œâ”€â”€â–º distributeCredits() å‡½æ•°
    â”‚     â”œâ”€ æŸ¥è¯¢æ‰€æœ‰è¿‡æœŸä¸”æœªå¤„ç†çš„ creditTransaction
    â”‚     â”‚   - expirationDate < now
    â”‚     â”‚   - expirationDateProcessedAt IS NULL
    â”‚     â”‚
    â”‚     â”œâ”€ éå†æ¯ä¸ªè¿‡æœŸäº¤æ˜“
    â”‚     â”‚   â”œâ”€ è·å– userCredit è®°å½•
    â”‚     â”‚   â”œâ”€ è®¡ç®—æ‰£é™¤ç§¯åˆ†
    â”‚     â”‚   â”‚   - newCredits = max(0, currentCredits - remainingAmount)
    â”‚     â”‚   â”œâ”€ å¼€å¯äº‹åŠ¡
    â”‚     â”‚   â”‚   â”œâ”€ æ›´æ–° userCredit.currentCredits
    â”‚     â”‚   â”‚   â””â”€ æ›´æ–° creditTransaction
    â”‚     â”‚   â”‚       - remainingAmount = 0
    â”‚     â”‚   â”‚       - expirationDateProcessedAt = now
    â”‚     â”‚   â””â”€ æäº¤äº‹åŠ¡
    â”‚     â”‚
    â”‚     â””â”€ è¿”å›å¤„ç†æ•°é‡
    â”‚
    â””â”€â”€â–º è®°å½•æ—¥å¿—
```

**æ¥æº**: `src/credits/distribute.ts`, `src/app/api/distribute-credits/route.ts`

### ğŸ¤– æ ¸å¿ƒé€»è¾‘ 4: AI åŠŸèƒ½

#### AI èŠå¤©

```
ç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯
    â”‚
    â”œâ”€â”€â–º å‰ç«¯è°ƒç”¨ POST /api/chat
    â”‚     - messages: [...å†å²æ¶ˆæ¯, æ–°æ¶ˆæ¯]
    â”‚     - model: 'gpt-4-turbo'
    â”‚     - webSearch: false
    â”‚
    â”œâ”€â”€â–º API è·¯ç”±
    â”‚     â”œâ”€ éªŒè¯ç”¨æˆ·ä¼šè¯ï¼ˆå¯é€‰ï¼‰
    â”‚     â”œâ”€ æ£€æŸ¥ç§¯åˆ†ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    â”‚     â”œâ”€ é€‰æ‹© AI æ¨¡å‹
    â”‚     â”‚   - openai('gpt-4-turbo')
    â”‚     â”‚   - google('gemini-pro')
    â”‚     â”‚   - deepseek('deepseek-chat')
    â”‚     â”œâ”€ è°ƒç”¨ streamText()
    â”‚     â”‚   - æµå¼å“åº”
    â”‚     â”‚   - maxTokens: 4096
    â”‚     â”‚   - temperature: 0.7
    â”‚     â””â”€ è¿”å›æµï¼ˆServer-Sent Eventsï¼‰
    â”‚
    â”œâ”€â”€â–º å‰ç«¯æ¥æ”¶æµ
    â”‚     - é€å­—æ˜¾ç¤º
    â”‚     - æ›´æ–° UI
    â”‚
    â””â”€â”€â–º æµç»“æŸ
          - è®°å½• token ä½¿ç”¨é‡
          - æ¶ˆè´¹ç§¯åˆ†ï¼ˆå¦‚æœå¯ç”¨ï¼‰
```

**æ¥æº**: `src/app/api/chat/route.ts`

#### AI å›¾ç‰‡ç”Ÿæˆ

```
ç”¨æˆ·ç”Ÿæˆå›¾ç‰‡
    â”‚
    â”œâ”€â”€â–º å‰ç«¯è°ƒç”¨ POST /api/generate-images
    â”‚     - prompt: "a cat in space"
    â”‚     - provider: 'openai'
    â”‚     - modelId: 'dall-e-3'
    â”‚
    â”œâ”€â”€â–º API è·¯ç”±
    â”‚     â”œâ”€ éªŒè¯ç”¨æˆ·ä¼šè¯
    â”‚     â”œâ”€ æ£€æŸ¥ç§¯åˆ†ï¼ˆéœ€è¦ 5 ç§¯åˆ†ï¼‰
    â”‚     â”œâ”€ æ¶ˆè´¹ 5 ç§¯åˆ†
    â”‚     â”œâ”€ ç”Ÿæˆè¯·æ±‚ ID
    â”‚     â”œâ”€ è°ƒç”¨ AI æä¾›å•†
    â”‚     â”‚   - openai.image('dall-e-3')
    â”‚     â”‚   - è¶…æ—¶æ§åˆ¶ï¼š55 ç§’
    â”‚     â”œâ”€ è¿”å›å›¾ç‰‡ URL
    â”‚     â””â”€ è®°å½•æ—¥å¿—
    â”‚
    â””â”€â”€â–º å‰ç«¯æ˜¾ç¤ºå›¾ç‰‡
```

**æ¥æº**: `src/app/api/generate-images/route.ts`

### ğŸ“Š æ ¸å¿ƒä¸šåŠ¡æµç¨‹å›¾

```
ç”¨æˆ·æ—…ç¨‹
    â”‚
    â”œâ”€â”€â–º æ³¨å†Œ
    â”‚     â”œâ”€ è·å¾— 50 å…è´¹ç§¯åˆ†
    â”‚     â””â”€ è‡ªåŠ¨è®¢é˜…æ—¶äº‹é€šè®¯
    â”‚
    â”œâ”€â”€â–º ä½¿ç”¨å…è´¹ç§¯åˆ†
    â”‚     â”œâ”€ AI èŠå¤©ï¼ˆ1 ç§¯åˆ†/æ¬¡ï¼‰
    â”‚     â”œâ”€ AI å›¾ç‰‡ç”Ÿæˆï¼ˆ5 ç§¯åˆ†/æ¬¡ï¼‰
    â”‚     â””â”€ ç½‘é¡µåˆ†æï¼ˆ2 ç§¯åˆ†/æ¬¡ï¼‰
    â”‚
    â”œâ”€â”€â–º ç§¯åˆ†ç”¨å®Œ
    â”‚     â”œâ”€ é€‰æ‹© 1: è´­ä¹°ç§¯åˆ†åŒ…
    â”‚     â”‚   - 100 ç§¯åˆ†ï¼š$9.90
    â”‚     â”‚   - 200 ç§¯åˆ†ï¼š$14.90
    â”‚     â”‚   - 500 ç§¯åˆ†ï¼š$39.90
    â”‚     â”‚   - 1000 ç§¯åˆ†ï¼š$69.90
    â”‚     â”‚
    â”‚     â””â”€ é€‰æ‹© 2: è®¢é˜… Pro è®¡åˆ’
    â”‚         - æœˆä»˜ï¼š$9.90/æœˆ â†’ 1000 ç§¯åˆ†/æœˆ
    â”‚         - å¹´ä»˜ï¼š$99/å¹´ â†’ 1000 ç§¯åˆ†/æœˆ
    â”‚
    â”œâ”€â”€â–º æˆä¸ºä»˜è´¹ç”¨æˆ·
    â”‚     â”œâ”€ æ¯æœˆè‡ªåŠ¨è·å¾—ç§¯åˆ†
    â”‚     â”œâ”€ ç§¯åˆ† 30 å¤©è¿‡æœŸ
    â”‚     â””â”€ æŒç»­ä½¿ç”¨ AI åŠŸèƒ½
    â”‚
    â””â”€â”€â–º å–æ¶ˆè®¢é˜…
          â”œâ”€ ç»§ç»­ä½¿ç”¨åˆ°æœŸæœ«
          â”œâ”€ åœæ­¢å‘æ”¾ç§¯åˆ†
          â””â”€ å‰©ä½™ç§¯åˆ†å¯ç»§ç»­ä½¿ç”¨ï¼ˆç›´åˆ°è¿‡æœŸï¼‰
```

## ğŸ“ ä¿¡æ¯æ¥æº
- `src/lib/auth.ts` - è®¤è¯é€»è¾‘
- `src/payment/` - æ”¯ä»˜é€»è¾‘
- `src/credits/` - ç§¯åˆ†ç³»ç»Ÿ
- `src/actions/` - Server Actions
- `src/app/api/` - API è·¯ç”±
- `src/db/schema.ts` - æ•°æ®æ¨¡å‹
