# 问题2: 现在站点的博客的文章是什么机制更新的，如何管理与上传博客？

## 博客内容管理机制

### 1. 内容存储方式

**基于文件系统的内容管理（File-Based CMS）**

博客文章存储在项目的 `content/blog/` 目录下，采用 **MDX 格式**（Markdown + JSX）。

```
content/blog/
├── algorithm.mdx          # 英文版
├── algorithm.zh.mdx       # 中文版
├── dokploy.mdx
├── dokploy.zh.mdx
├── haitang.mdx
├── haitang.zh.mdx
└── ...
```

### 2. MDX 内容格式

每篇文章由两部分组成：

#### Front Matter（元数据）

使用 YAML 格式的 Front Matter 定义文章元数据：

```yaml
---
title: 面试指南之算法面试心得
description: 本文介绍如何准备算法面试，包括算法的基础知识、面试常见问题...
image: /images/blog/post-8.png
date: "2024-10-01"
published: true
categories: [development]
author: fox
---
```

**元数据字段说明**：
- `title`: 文章标题（必需）
- `description`: 文章描述/摘要（用于 SEO 和列表展示）
- `image`: 封面图片路径
- `date`: 发布日期（ISO 格式）
- `published`: 是否发布（`true`/`false`，控制文章可见性）
- `categories`: 分类数组（如 `[development, design]`）
- `author`: 作者ID（关联到 `content/author/` 目录下的作者信息）

#### 正文内容（Markdown + React 组件）

Front Matter 之后是文章正文，支持：
- **标准 Markdown 语法**：标题、列表、链接、图片、代码块等
- **JSX 组件**：可以在 Markdown 中嵌入 React 组件
- **语法高亮**：代码块自动语法高亮

示例：
```markdown
## 算法基础知识总结

俗话说，"不积跬步，无以至千里"，要想搞定算法面试，首先要扎实算法基础。

**算法基础知识总结这部分主要有以下几个内容：**
- 常见的数据结构及其实现
- 算法时间复杂度的计算
- 常见的算法思想

<img src="https://cdn.mksaas.me/images/xxx.png" alt="image" />
```

---

## 博客更新机制

### 1. 内容构建流程

**静态生成（Static Generation）**

博客采用 **Next.js 静态生成** + **Fumadocs MDX** 处理：

```
开发/部署流程:
1. 开发者编写/修改 MDX 文件
   ↓
2. 运行 pnpm content (处理 MDX 内容集合)
   ↓
3. 运行 pnpm build (Next.js 构建)
   ↓
4. Fumadocs MDX 插件处理 MDX 文件
   ↓
5. 生成静态 HTML 页面
   ↓
6. 部署到服务器/CDN
```

**相关配置文件**：

`next.config.ts`:
```typescript
import { createMDX } from 'fumadocs-mdx/next';

const withMDX = createMDX();

export default withMDX(withNextIntl(nextConfig));
```

### 2. 内容读取机制

**代码层面的实现**：

Fumadocs 通过 Content Collections API 读取和处理 MDX 文件：

```typescript
// 读取所有博客文章
import { blog } from '@/.source';

// 获取文章列表
const posts = blog.getPages();

// 根据 slug 获取单篇文章
const post = blog.getPage([slug]);
```

**数据流**：
```
MDX 文件 (content/blog/)
    ↓
Fumadocs MDX Loader
    ↓
Content Collections API
    ↓
React 组件读取
    ↓
渲染到页面
```

### 3. 构建时处理

**何时触发内容更新**：

1. **开发模式** (`pnpm dev`):
   - 热更新（Hot Reload）
   - 修改 MDX 文件后自动刷新
   - 实时预览

2. **生产构建** (`pnpm build`):
   - 处理所有 MDX 文件
   - 生成静态页面
   - 优化图片和资源

3. **内容预处理** (`pnpm content`):
   - 单独处理 MDX 内容集合
   - 生成索引和元数据
   - 通常在构建前执行

---

## 如何管理与上传博客

### 方式1: 本地开发（推荐）

#### 步骤1: 创建新文章

在 `content/blog/` 目录下创建新的 MDX 文件：

```bash
# 创建英文版
touch content/blog/my-new-post.mdx

# 创建中文版
touch content/blog/my-new-post.zh.mdx
```

#### 步骤2: 编写内容

使用任何文本编辑器（VS Code、Cursor 等）编写文章：

```markdown
---
title: My New Post
description: This is a description of my new post
image: /images/blog/my-new-post.png
date: "2025-11-13"
published: true
categories: [development]
author: fox
---

## Introduction

Your content here...
```

#### 步骤3: 本地预览

```bash
# 启动开发服务器
pnpm dev

# 访问 http://localhost:3005/blog/my-new-post
```

#### 步骤4: 构建和部署

```bash
# 处理内容
pnpm content

# 构建项目
pnpm build

# 部署（取决于部署平台）
# Vercel: git push 自动部署
# 手动: pnpm start 或 Docker
```

### 方式2: Git 工作流

#### 标准流程：

```bash
# 1. 创建/编辑 MDX 文件
vim content/blog/new-post.mdx

# 2. 提交到 Git
git add content/blog/new-post.mdx
git commit -m "feat: add new blog post"

# 3. 推送到远程仓库
git push origin main

# 4. 自动触发部署（如果配置了 CI/CD）
# Vercel/Netlify 会自动构建和部署
```

### 方式3: CMS 集成（可选扩展）

虽然当前项目采用文件系统方式，但可以集成无头 CMS：

**可集成的 CMS 选项**：
- **Sanity**: 结构化内容管理
- **Contentful**: 企业级 CMS
- **Strapi**: 开源自托管 CMS
- **TinaCMS**: Git-based CMS
- **Keystatic**: 本地优先的 CMS

**集成方式**：
1. 安装 CMS SDK
2. 配置数据源
3. 修改内容读取逻辑
4. 保留 MDX 作为备份或同步目标

---

## 文章管理功能

### 1. 发布控制

通过 `published` 字段控制文章可见性：

```yaml
---
published: true   # 已发布，在博客列表中显示
---
```

```yaml
---
published: false  # 草稿，不在列表中显示
---
```

### 2. 分类管理

**当前支持的分类**（可在代码中扩展）：

- `development`: 开发相关
- `design`: 设计相关
- `business`: 商业相关
- 其他自定义分类

**分类筛选实现**：
博客列表页支持按分类筛选文章。

### 3. 作者管理

作者信息存储在 `content/author/` 目录：

```yaml
# content/author/fox.yaml
name: Indie Maker Fox
avatar: /images/avatar/fox.jpg
bio: Full-stack developer and indie maker
social:
  twitter: https://twitter.com/...
  github: https://github.com/...
```

文章通过 `author: fox` 关联作者信息。

### 4. 图片管理

**图片存储方式**：

1. **本地图片**：
   - 放在 `public/images/blog/` 目录
   - 引用：`/images/blog/post-1.png`

2. **CDN 图片**：
   - 上传到 CDN（如 `cdn.mksaas.me`）
   - 引用：`https://cdn.mksaas.me/images/xxx.png`

3. **S3 图片**：
   - 使用项目的 S3 上传功能
   - API: `/api/storage/upload`

**图片优化配置** (`next.config.ts`):
```typescript
images: {
  unoptimized: true,  // 禁用 Next.js 图片优化（避免 Vercel 配额限制）
  remotePatterns: [
    { hostname: 'cdn.mksaas.me' },
    // 其他允许的图片域名
  ],
}
```

### 5. 多语言管理

**文件命名约定**：
- 英文版：`post-name.mdx`
- 中文版：`post-name.zh.mdx`

**语言路由**：
- 英文：`/en/blog/post-name`
- 中文：`/zh/blog/post-name`

**自动语言切换**：
Next.js 根据用户语言偏好自动路由到对应语言版本。

---

## 博客配置

在 `src/config/website.tsx` 中配置博客行为：

```typescript
blog: {
  enable: true,              // 启用博客功能
  paginationSize: 12,        // 每页显示 12 篇文章
  relatedPostsSize: 3,       // 相关文章数量
}
```

---

## 内容更新工作流

### 日常更新流程：

```
1. 编写文章
   ├─ 创建 MDX 文件
   ├─ 编写 Front Matter
   └─ 编写正文

2. 本地测试
   ├─ pnpm dev
   ├─ 预览文章
   └─ 检查格式和链接

3. 提交代码
   ├─ git add content/blog/xxx.mdx
   ├─ git commit -m "feat: add new post"
   └─ git push

4. 自动部署
   ├─ CI/CD 触发构建
   ├─ pnpm content + pnpm build
   └─ 部署到生产环境

5. 验证发布
   └─ 访问生产站点检查文章
```

### 紧急修复流程：

```
1. 修改 MDX 文件
2. git commit -m "fix: correct typo"
3. git push
4. 等待自动部署（Vercel 约 1-2 分钟）
```

---

## 优势和特点

### ✅ 优势

1. **版本控制**：
   - 所有文章在 Git 中管理
   - 完整的修改历史
   - 可以回滚到任意版本

2. **开发者友好**：
   - 使用熟悉的 Markdown 语法
   - 可以在任何文本编辑器中编辑
   - 支持代码语法高亮

3. **性能优异**：
   - 静态生成，速度极快
   - 无需数据库查询
   - CDN 友好

4. **类型安全**：
   - TypeScript 支持
   - 编译时检查
   - 自动补全

5. **灵活扩展**：
   - 可以嵌入 React 组件
   - 支持自定义样式
   - 易于集成第三方服务

### ⚠️ 注意事项

1. **非技术用户门槛较高**：
   - 需要了解 Markdown 和 Git
   - 如需支持非技术团队，考虑集成 CMS

2. **构建时间**：
   - 文章数量增加会延长构建时间
   - 可以考虑增量构建优化

3. **图片管理**：
   - 大量图片会增加仓库大小
   - 建议使用 CDN 或 S3

---

## 推荐工具

### 编辑器：
- **VS Code** + MDX 插件
- **Cursor**: AI 辅助编写
- **Typora**: 所见即所得的 Markdown 编辑器
- **Obsidian**: 知识管理 + Markdown 编辑

### 图片工具：
- **TinyPNG**: 图片压缩
- **Cloudinary**: 图片 CDN 和优化
- **Excalidraw**: 绘制技术图表

### 协作工具：
- **GitHub**: 代码托管 + 协作
- **GitHub Actions**: 自动化工作流
- **Vercel**: 自动部署

---

## 总结

mksaas-blog 采用**基于文件系统的内容管理**方式，具有以下特点：

✅ **简单直接**: 创建 MDX 文件即可发布文章
✅ **版本控制**: Git 管理所有内容历史
✅ **高性能**: 静态生成，加载速度快
✅ **开发者友好**: Markdown + React 组件
✅ **多语言**: 通过文件命名约定支持多语言
✅ **自动化**: 推送代码自动构建部署

**最佳实践**:
1. 使用 Git 分支管理草稿和发布
2. 图片使用 CDN 减少仓库大小
3. 定期备份内容
4. 使用 CI/CD 自动化部署
5. 如团队有非技术人员，考虑集成 CMS 界面
