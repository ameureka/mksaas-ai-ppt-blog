# 问题1: 目前站点的核心架构是什么？站点的内容？

## 核心架构概述

### 技术栈

mksaas-blog 是一个**现代化的全栈 SaaS 博客平台**，采用以下核心技术：

#### 前端框架
- **Next.js 15**: React 框架，使用 App Router
- **React 19**: 最新版本的 React
- **TypeScript**: 类型安全的 JavaScript 超集

#### 后端技术
- **Next.js Server Actions**: 无需单独 API 路由的服务端操作
- **Better Auth**: 现代化的身份认证系统
- **Drizzle ORM**: TypeScript ORM，连接 PostgreSQL

#### 数据库
- **PostgreSQL**: 关系型数据库
- 存储用户、支付、积分、会话等数据

#### UI 和样式
- **Radix UI**: 无障碍的 UI 组件库（30+ 组件）
- **TailwindCSS 4**: 实用优先的 CSS 框架
- **Lucide Icons**: 图标库
- 支持**明暗主题切换**

#### 内容管理
- **MDX**: Markdown 扩展格式，支持 React 组件
- **Fumadocs**: 文档和博客内容管理
- 文件系统为基础的内容管理（Content Collections）

#### 国际化
- **next-intl**: i18n 解决方案
- 支持**英文（en）和中文（zh）**
- 路由级别的语言切换

#### 支付和订阅
- **Stripe**: 支付处理
- 支持订阅制和一次性支付
- 积分系统集成

#### 其他核心功能
- **Resend**: 邮件发送服务
- **AWS S3**: 文件存储
- **AI SDK**: 集成多个 AI 提供商（OpenAI、Replicate、FAL等）
- **Zustand**: 客户端状态管理
- **React Query**: 服务端状态管理和缓存

---

## 架构设计模式

### 1. 目录结构

```
mksaas-blog/
├── src/                          # 应用源代码
│   ├── app/                      # Next.js App Router
│   │   ├── api/                  # API 路由
│   │   └── [locale]/             # 国际化路由
│   │       ├── (marketing)/      # 公开页面（博客、定价等）
│   │       ├── (protected)/      # 需认证页面（仪表盘、设置）
│   │       ├── auth/             # 认证页面
│   │       └── docs/             # 文档页面
│   ├── components/               # React 组件
│   ├── db/                       # 数据库配置和 Schema
│   ├── lib/                      # 工具函数
│   ├── actions/                  # Server Actions
│   ├── hooks/                    # 自定义 Hooks
│   ├── stores/                   # Zustand 状态管理
│   ├── config/                   # 配置文件
│   ├── payment/                  # 支付系统
│   ├── credits/                  # 积分系统
│   ├── mail/                     # 邮件系统
│   ├── newsletter/               # 新闻订阅
│   ├── ai/                       # AI 功能
│   ├── storage/                  # 文件存储
│   └── i18n/                     # 国际化配置
├── content/                      # MDX 内容文件
│   ├── blog/                     # 博客文章
│   ├── docs/                     # 文档
│   ├── author/                   # 作者信息
│   └── changelog/                # 更新日志
├── messages/                     # 翻译文件
│   ├── en.json                   # 英文翻译
│   └── zh.json                   # 中文翻译
└── public/                       # 静态资源
```

### 2. 路由架构

采用 **Next.js App Router** 的文件系统路由：

```
/[locale]/                        # 国际化路由前缀
├── /                            # 首页
├── /blog                        # 博客列表
├── /blog/[slug]                 # 博客文章详情
├── /docs                        # 文档
├── /pricing                     # 定价页面
├── /dashboard                   # 仪表盘（需认证）
├── /settings/*                  # 设置页面（需认证）
├── /auth/login                  # 登录
└── /auth/register               # 注册
```

### 3. 数据流架构

```
用户交互
    ↓
React 组件
    ↓
Server Actions (next-safe-action)
    ↓
业务逻辑层（credits/payment/mail等）
    ↓
Drizzle ORM
    ↓
PostgreSQL 数据库
```

### 4. 认证架构

采用 **Better Auth** 框架：

- **多种登录方式**:
  - 邮箱/密码认证（带邮箱验证）
  - GitHub OAuth
  - Google OAuth
  - 账户关联

- **会话管理**:
  - Cookie 缓存（60小时）
  - Session 过期时间：7天
  - 更新间隔：1天

- **安全特性**:
  - Admin 插件（用户管理、封禁功能）
  - 邮箱验证
  - 密码重置
  - CSRF 保护

### 5. 支付架构

采用 **提供者模式（Provider Pattern）**：

```typescript
PaymentProvider (接口)
    ↓
StripeProvider (实现)
    ↓
支付场景:
├── 订阅支付（月度/年度）
├── 一次性支付（终身会员）
└── 积分购买（4个档次）
```

**支付流程**:
```
1. 用户点击购买
2. createCheckoutAction() - Server Action
3. Stripe.createCheckout() - 创建结账会话
4. 重定向到 Stripe Checkout
5. 用户完成支付
6. Stripe Webhook → /api/webhooks/stripe
7. handleWebhookEvent() - 处理事件
8. 更新数据库 + 发放积分/订阅
9. 发送确认邮件
```

### 6. 积分系统架构

**核心功能**:
- 用户积分余额管理
- 积分交易记录
- 积分过期机制
- 自动发放（注册、订阅、每月刷新）

**积分来源**:
1. 注册赠送：50 积分
2. 订阅赠送：Pro/Lifetime 1000 积分
3. 购买积分包：100-1000 积分
4. 月度刷新：Pro 用户每月刷新

---

## 站点内容

### 1. 博客内容

**位置**: `content/blog/`

**格式**: MDX（Markdown + JSX）

**特性**:
- 支持英文和中文（`.mdx` 和 `.zh.mdx`）
- Front Matter 元数据（标题、描述、分类、作者等）
- 支持在 Markdown 中嵌入 React 组件
- 自动生成 OG 图片
- 分类系统（development、design等）
- 作者系统
- 相关文章推荐

**文章示例结构**:
```yaml
---
title: 面试指南之算法面试心得
description: 本文介绍如何准备算法面试...
image: /images/blog/post-8.png
date: "2024-10-01"
published: true
categories: [development]
author: fox
---

文章内容（支持 Markdown 和 React 组件）...
```

**当前文章**（部分）:
- 算法面试心得
- 独立开发者导航站开源
- 海棠诗社开源
- Obsidian 知识库搭建
- Dokploy 部署教程
- 企业邮箱搭建（Gmail + Resend + Cloudflare）
- 等等...

### 2. 文档内容

**位置**: `content/docs/`

**用途**: 产品文档、使用指南、API 文档等

**技术**: Fumadocs UI

### 3. 页面内容

- **首页**: 产品介绍、特性展示
- **定价页**: 价格计划、功能对比
- **仪表盘**: 用户数据、积分余额、使用统计
- **设置页**: 个人资料、账单、安全设置

### 4. 多语言支持

**翻译文件位置**: `messages/en.json` 和 `messages/zh.json`

包含所有 UI 文本的翻译：
- 导航菜单
- 按钮文本
- 表单标签
- 错误消息
- SEO 元数据
- 等等...

---

## 核心功能模块

### 1. 用户系统
- 用户注册/登录/登出
- 个人资料管理
- 头像上传
- 账户安全（密码修改、邮箱验证）
- 账户关联（多个 OAuth 提供商）

### 2. 支付和订阅
- 三种价格计划：Free、Pro、Lifetime
- Stripe 结账集成
- 客户门户（管理订阅）
- 发票管理
- 订阅状态跟踪

### 3. 积分系统
- 积分余额查询
- 积分消费
- 交易历史
- 积分统计
- 自动刷新机制

### 4. 博客系统
- 文章列表（分页）
- 文章详情
- 分类筛选
- 搜索功能
- 相关文章推荐
- RSS 订阅

### 5. 新闻订阅
- 邮箱订阅/取消订阅
- 自动订阅（注册时）
- 订阅状态检查
- 提供商：Resend

### 6. AI 功能
- AI 聊天（流式响应）
- 图片生成（DALL-E、Replicate等）
- 内容分析

### 7. 文件存储
- AWS S3 集成
- 图片上传
- 文件管理

### 8. 邮件系统
- 欢迎邮件
- 邮箱验证
- 密码重置
- 支付确认
- 新闻通讯

---

## 配置中心

所有核心配置集中在 `src/config/website.tsx`:

```typescript
{
  ui: { theme, mode },           // UI 主题和模式
  metadata: { images, social },  // 元数据和社交链接
  features: { ... },             // 功能开关
  routes: { ... },               // 路由配置
  analytics: { ... },            // 分析工具
  auth: { ... },                 // 认证配置
  i18n: { ... },                 // 国际化配置
  blog: { enable, pagination },  // 博客配置
  docs: { enable },              // 文档配置
  mail: { provider, from },      // 邮件配置
  newsletter: { ... },           // 新闻订阅配置
  storage: { provider },         // 存储配置
  payment: { provider },         // 支付配置
  price: { plans },              // 价格计划
  credits: { ... }               // 积分配置
}
```

---

## 总结

mksaas-blog 是一个**功能完整、架构清晰的现代化 SaaS 博客平台**，具有以下特点：

✅ **现代技术栈**: Next.js 15 + React 19 + TypeScript + PostgreSQL
✅ **全栈能力**: 包含前端、后端、数据库、支付、邮件等完整功能
✅ **国际化**: 完整的中英文支持
✅ **商业功能**: 认证、支付、订阅、积分系统
✅ **内容管理**: MDX 文件系统，支持博客和文档
✅ **可扩展性**: 提供者模式、插件架构、模块化设计
✅ **开发体验**: TypeScript 类型安全、Server Actions、React Query缓存

**适用场景**:
- 独立开发者的技术博客
- SaaS 产品的营销网站 + 博客
- 需要付费内容的博客平台
- 需要用户系统的内容平台
