# 1. æ•´ä½“äº”å±‚æ¶æ„å›¾

## å®Œæ•´çš„ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ğŸ¨ ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)                          â”‚
â”‚  Next.js Pages: /dashboard, /settings/*, /pricing, /admin/*, /blog/*, /auth/*â”‚
â”‚                                                                               â”‚
â”‚  ä¸»è¦é¡µé¢:                                                                    â”‚
â”‚  â”œâ”€ Marketing Pages    (/pricing, /about, /contact, /)                       â”‚
â”‚  â”œâ”€ Protected Pages    (/dashboard, /settings/*, /admin/*)                   â”‚
â”‚  â”œâ”€ Auth Pages         (/login, /register, /forgot-password)                 â”‚
â”‚  â””â”€ Content Pages      (/blog/*, /docs/*)                                    â”‚
â”‚                                                                               â”‚
â”‚  UI æ¡†æ¶: Radix UI + TailwindCSS + Framer Motion                             â”‚
â”‚  çŠ¶æ€é©±åŠ¨: Zustand (locale) + React Query (server state)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  React ç»„ä»¶é€šä¿¡          â”‚
                â”‚  (Props + Context)       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ“± React ç»„ä»¶ä¸ Hook å±‚ (Component Layer)                   â”‚
â”‚                                                                               â”‚
â”‚  è‡ªå®šä¹‰ Hooks (16ä¸ª):                                                         â”‚
â”‚  â”œâ”€ useCurrentUser()        â†’ è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯                                â”‚
â”‚  â”œâ”€ useSession()            â†’ è·å–ç”¨æˆ·ä¼šè¯                                    â”‚
â”‚  â”œâ”€ useCurrentPlan()        â†’ è·å–å½“å‰æ”¯ä»˜å¥—é¤                                â”‚
â”‚  â”œâ”€ useCredits()            â†’ è·å–ç§¯åˆ†ä½™é¢                                    â”‚
â”‚  â”œâ”€ useCreditBalance()      â†’ ç§¯åˆ†è¯¦æƒ…                                        â”‚
â”‚  â”œâ”€ usePaymentCompletion()  â†’ æ”¯ä»˜å®Œæˆæ£€æŸ¥                                    â”‚
â”‚  â””â”€ ... å…¶ä»– Hooks                                                            â”‚
â”‚                                                                               â”‚
â”‚  æ•°æ®è·å–æ–¹å¼:                                                                â”‚
â”‚  â”œâ”€ React Query (server state caching)                                        â”‚
â”‚  â”‚  â”œâ”€ useQuery() for GET requests                                          â”‚
â”‚  â”‚  â”œâ”€ useMutation() for POST/PUT/DELETE                                    â”‚
â”‚  â”‚  â””â”€ Query Keys: creditsKeys, paymentKeys, userKeys ç­‰                    â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â””â”€ Client State (Zustand stores)                                            â”‚
â”‚     â””â”€ useLocaleStore() for UI state                                        â”‚
â”‚                                                                               â”‚
â”‚  React ç»„ä»¶åº“:                                                                â”‚
â”‚  â”œâ”€ src/components/ui/           (åŸºç¡€ UI ç»„ä»¶: Button, Dialog, Input ç­‰)    â”‚
â”‚  â”œâ”€ src/components/auth/         (è®¤è¯ç»„ä»¶: LoginForm, RegisterForm)         â”‚
â”‚  â”œâ”€ src/components/dashboard/    (ä»ªè¡¨æ¿ç»„ä»¶: Sidebar, Header, Cards)        â”‚
â”‚  â”œâ”€ src/components/settings/     (è®¾ç½®ç»„ä»¶: BillingCard, CreditsCard)        â”‚
â”‚  â””â”€ src/components/admin/        (ç®¡ç†ç»„ä»¶: UsersTable)                      â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Server Action è°ƒç”¨      â”‚
                â”‚  (useAction hook)        â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ”Œ Server Actions & API å±‚ (Server Action Layer)                  â”‚
â”‚                                                                               â”‚
â”‚  Server Actions (src/actions/, 15ä¸ª):                                         â”‚
â”‚  â”œâ”€ userActionClient              (éœ€è¦ç”¨æˆ·è®¤è¯)                              â”‚
â”‚  â”‚  â”œâ”€ consumeCreditsAction()      (æ¶ˆè´¹ç§¯åˆ†)                                â”‚
â”‚  â”‚  â”œâ”€ checkPaymentCompletionAction() (æ£€æŸ¥æ”¯ä»˜)                            â”‚
â”‚  â”‚  â”œâ”€ subscribeNewsletterAction() (è®¢é˜…é‚®ä»¶)                               â”‚
â”‚  â”‚  â””â”€ ... å…¶ä»–ç”¨æˆ·çº§åˆ« Actions                                              â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”œâ”€ adminActionClient             (ä»…é™ç®¡ç†å‘˜)                                â”‚
â”‚  â”‚  â”œâ”€ getUsersAction()            (è·å–ç”¨æˆ·åˆ—è¡¨)                            â”‚
â”‚  â”‚  â””â”€ ... å…¶ä»–ç®¡ç† Actions                                                  â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â””â”€ actionClient                  (å…¬å¼€ Actions)                              â”‚
â”‚     â”œâ”€ validateCaptchaAction()    (éªŒè¯éªŒè¯ç )                              â”‚
â”‚     â”œâ”€ sendMessageAction()        (å‘é€è”ç³»è¡¨å•)                            â”‚
â”‚     â””â”€ ... å…¶ä»–å…¬å¼€ Actions                                                  â”‚
â”‚                                                                               â”‚
â”‚  API Routes (src/app/api/, 9ä¸ª):                                              â”‚
â”‚  â”œâ”€ /auth/[...all]               (Better Auth è®¤è¯è·¯ç”±)                      â”‚
â”‚  â”œâ”€ /webhooks/stripe             (Stripe Webhook å¤„ç†)                       â”‚
â”‚  â”œâ”€ /chat                        (AI å¯¹è¯ API)                               â”‚
â”‚  â”œâ”€ /generate-images             (AI å›¾åƒç”Ÿæˆ)                               â”‚
â”‚  â”œâ”€ /search                      (å…¨æ–‡æœç´¢)                                  â”‚
â”‚  â”œâ”€ /storage/upload              (æ–‡ä»¶ä¸Šä¼ )                                  â”‚
â”‚  â””â”€ ... å…¶ä»– API ç«¯ç‚¹                                                        â”‚
â”‚                                                                               â”‚
â”‚  æƒé™éªŒè¯å±‚:                                                                  â”‚
â”‚  â”œâ”€ sessionClaimsMiddleware()     (ä¼šè¯éªŒè¯)                                 â”‚
â”‚  â”œâ”€ checkPremiumAccess()          (é«˜çº§æƒé™æ£€æŸ¥)                             â”‚
â”‚  â””â”€ roleBasedAccess()             (è§’è‰²æ£€æŸ¥)                                 â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  ä¸šåŠ¡é€»è¾‘å¤„ç†            â”‚
                â”‚  (Service å±‚)            â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸ¯ æœåŠ¡å’Œå·¥å…·å‡½æ•°å±‚ (Service Layer)                          â”‚
â”‚                                                                               â”‚
â”‚  æ ¸å¿ƒæœåŠ¡æ¨¡å—:                                                                â”‚
â”‚  â”œâ”€ src/lib/auth.ts                   (è®¤è¯æœåŠ¡)                              â”‚
â”‚  â”‚  â”œâ”€ Better Auth å®ä¾‹é…ç½®                                                  â”‚
â”‚  â”‚  â”œâ”€ ç¤¾äº¤ç™»å½•æä¾›å•† (Google, GitHub)                                       â”‚
â”‚  â”‚  â””â”€ ä¼šè¯ç®¡ç†é€»è¾‘                                                           â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”œâ”€ src/payment/                      (æ”¯ä»˜æœåŠ¡)                              â”‚
â”‚  â”‚  â”œâ”€ ä»·æ ¼è®¡åˆ’ç®¡ç†                                                           â”‚
â”‚  â”‚  â”œâ”€ Stripe API å°è£…                                                       â”‚
â”‚  â”‚  â””â”€ è®¢é˜…çŠ¶æ€æ£€æŸ¥                                                           â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”œâ”€ src/credits/                      (ç§¯åˆ†æœåŠ¡)                              â”‚
â”‚  â”‚  â”œâ”€ consumeCredits()               (æ¶ˆè´¹ç§¯åˆ†)                             â”‚
â”‚  â”‚  â”œâ”€ distributeCredits()            (åˆ†é…ç§¯åˆ†)                             â”‚
â”‚  â”‚  â”œâ”€ refreshCredits()               (åˆ·æ–°ç§¯åˆ†)                             â”‚
â”‚  â”‚  â””â”€ expireCredits()                (è¿‡æœŸå¤„ç†)                             â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”œâ”€ src/mail/                         (é‚®ä»¶æœåŠ¡)                              â”‚
â”‚  â”‚  â”œâ”€ sendEmail()                    (å‘é€é‚®ä»¶)                             â”‚
â”‚  â”‚  â”œâ”€ é‚®ä»¶æ¨¡æ¿æ¸²æŸ“                                                           â”‚
â”‚  â”‚  â””â”€ Resend é›†æˆ                                                           â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â””â”€ src/lib/                          (é€šç”¨å·¥å…·)                              â”‚
â”‚     â”œâ”€ formatter.ts                   (æ•°æ®æ ¼å¼åŒ–)                           â”‚
â”‚     â”œâ”€ constants.ts                   (å…¨å±€å¸¸é‡)                             â”‚
â”‚     â”œâ”€ safe-action.ts                 (Action å®‰å…¨åŒ…è£…å™¨)                    â”‚
â”‚     â””â”€ ... å…¶ä»–å·¥å…·å‡½æ•°                                                      â”‚
â”‚                                                                               â”‚
â”‚  æ•°æ®éªŒè¯:                                                                    â”‚
â”‚  â””â”€ Zod schemas                    (è¿è¡Œæ—¶ç±»å‹éªŒè¯)                          â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  æ•°æ®åº“æ“ä½œ & Queries     â”‚
                â”‚  (Drizzle ORM)           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸ—„ï¸ æ•°æ®åº“ä¸ç¬¬ä¸‰æ–¹æœåŠ¡å±‚ (Data & External Services)                 â”‚
â”‚                                                                               â”‚
â”‚  ğŸ“Š æ•°æ®åº“ (PostgreSQL):                                                      â”‚
â”‚  â”œâ”€ src/db/schema.ts                                                         â”‚
â”‚  â”‚  â”œâ”€ user               (ç”¨æˆ·è¡¨: id, email, role, customerId...)           â”‚
â”‚  â”‚  â”œâ”€ session            (ä¼šè¯è¡¨: id, userId, token, expiresAt...)          â”‚
â”‚  â”‚  â”œâ”€ account            (OAuth è´¦æˆ·è¡¨: userId, provider, accountId...)     â”‚
â”‚  â”‚  â”œâ”€ payment            (æ”¯ä»˜è¡¨: userId, priceId, status, subscriptionId...)
â”‚  â”‚  â”œâ”€ userCredit         (ç§¯åˆ†è¡¨: userId, currentCredits...)                â”‚
â”‚  â”‚  â””â”€ creditTransaction   (ç§¯åˆ†äº¤æ˜“: userId, type, amount, expiresAt...)   â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”‚  ç´¢å¼•: id, userId, customerId, status, subscriptionId, invoiceId ç­‰      â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”œâ”€ Drizzle ORM                                                              â”‚
â”‚  â”‚  â”œâ”€ db.query.*                    (SELECT æŸ¥è¯¢)                           â”‚
â”‚  â”‚  â”œâ”€ db.insert(*)                  (INSERT æ“ä½œ)                           â”‚
â”‚  â”‚  â”œâ”€ db.update(*)                  (UPDATE æ“ä½œ)                           â”‚
â”‚  â”‚  â””â”€ db.delete(*)                  (DELETE æ“ä½œ)                           â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”‚  è¿ç§»ç®¡ç†:                                                                 â”‚
â”‚  â”‚  â”œâ”€ drizzle-kit generate          (ç”Ÿæˆè¿ç§»æ–‡ä»¶)                          â”‚
â”‚  â”‚  â”œâ”€ drizzle-kit migrate           (åº”ç”¨è¿ç§»)                              â”‚
â”‚  â”‚  â””â”€ drizzle-kit push              (ç›´æ¥åŒæ­¥)                              â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â””â”€ è¿æ¥æ± :                                                                   â”‚
â”‚     â””â”€ @neondatabase/serverless (Neon DB)                                    â”‚
â”‚                                                                               â”‚
â”‚  ğŸ’³ ç¬¬ä¸‰æ–¹æœåŠ¡:                                                               â”‚
â”‚  â”œâ”€ Stripe API (https://api.stripe.com)                                      â”‚
â”‚  â”‚  â”œâ”€ åˆ›å»º Checkout Session                                                 â”‚
â”‚  â”‚  â”œâ”€ è®¢é˜…ç®¡ç†                                                               â”‚
â”‚  â”‚  â”œâ”€ Webhook äº‹ä»¶å¤„ç†                                                       â”‚
â”‚  â”‚  â””â”€ Customer Portal                                                       â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”œâ”€ Better Auth (è®¤è¯æœåŠ¡)                                                    â”‚
â”‚  â”‚  â”œâ”€ Email/Password è®¤è¯                                                   â”‚
â”‚  â”‚  â”œâ”€ Google OAuth                                                          â”‚
â”‚  â”‚  â”œâ”€ GitHub OAuth                                                          â”‚
â”‚  â”‚  â””â”€ ä¼šè¯ç®¡ç†                                                               â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”œâ”€ Resend (é‚®ä»¶æœåŠ¡)                                                         â”‚
â”‚  â”‚  â”œâ”€ é‚®ä»¶å‘é€                                                               â”‚
â”‚  â”‚  â””â”€ æ¨¡æ¿æ¸²æŸ“                                                               â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â”œâ”€ AI SDK (AI åŠŸèƒ½)                                                          â”‚
â”‚  â”‚  â”œâ”€ OpenAI (ChatGPT)                                                      â”‚
â”‚  â”‚  â”œâ”€ Replicate (å›¾åƒç”Ÿæˆ)                                                   â”‚
â”‚  â”‚  â”œâ”€ Google Gemini                                                         â”‚
â”‚  â”‚  â””â”€ FAL (FastAPI Inference)                                               â”‚
â”‚  â”‚                                                                            â”‚
â”‚  â””â”€ AWS S3 (æ–‡ä»¶å­˜å‚¨)                                                         â”‚
â”‚     â””â”€ ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤æ–‡ä»¶                                                   â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å„å±‚ä¹‹é—´çš„æ•°æ®æµ

```
ç”¨æˆ·äº¤äº’ (Click, Submit)
       â”‚
       â–¼
React Component (UI Layer)
       â”‚
       â”œâ”€ æœ¬åœ°çŠ¶æ€ç®¡ç† (Zustand: locale, UI state)
       â”œâ”€ ç¼“å­˜æŸ¥è¯¢ (React Query: credits, userInfo, paymentPlan)
       â”‚
       â–¼
Server Action æˆ– API Route
       â”‚
       â”œâ”€ å‚æ•°éªŒè¯ (Zod schema)
       â”œâ”€ æƒé™æ£€æŸ¥ (userActionClient, adminActionClient)
       â”‚
       â–¼
Service å±‚ (ä¸šåŠ¡é€»è¾‘)
       â”‚
       â”œâ”€ è°ƒç”¨ç¬¬ä¸‰æ–¹ API (Stripe, Resend, AI SDK)
       â”œâ”€ è°ƒç”¨ Drizzle ORM æŸ¥è¯¢æ•°æ®åº“
       â”‚
       â–¼
æ•°æ®åº“æˆ–å¤–éƒ¨æœåŠ¡
       â”‚
       â”œâ”€ æ•°æ®åº“æ“ä½œ (PostgreSQL)
       â”œâ”€ API è°ƒç”¨è¿”å›
       â”‚
       â–¼
Service å±‚å¤„ç†ç»“æœ
       â”‚
       â–¼
Server Action è¿”å›ç»“æœ
       â”‚
       â”œâ”€ React Query æ›´æ–°ç¼“å­˜
       â”œâ”€ Zustand æ›´æ–° UI çŠ¶æ€
       â”‚
       â–¼
React Component é‡æ–°æ¸²æŸ“
       â”‚
       â–¼
ç”¨æˆ·çœ‹åˆ°ç»“æœ (UI æ›´æ–°)
```

## å…³é”®çš„æ¶æ„è®¾è®¡æ¨¡å¼

### 1. Server Actions çš„ä¸‰å±‚æƒé™æ¨¡å‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  actionClient (å…¬å¼€)                 â”‚
â”‚  â”œâ”€ ä¸éœ€è¦è®¤è¯                        â”‚
â”‚  â”œâ”€ é€‚ç”¨: ç™»å½•ã€æ³¨å†Œã€éªŒè¯ç          â”‚
â”‚  â””â”€ ç¤ºä¾‹: validateCaptchaAction()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  userActionClient (éœ€è¦è®¤è¯)          â”‚
â”‚  â”œâ”€ ä»ä¼šè¯ä¸­è¯»å– userId                â”‚
â”‚  â”œâ”€ é€‚ç”¨: å¤§éƒ¨åˆ†ç”¨æˆ·çº§åˆ«æ“ä½œ         â”‚
â”‚  â””â”€ ç¤ºä¾‹: consumeCreditsAction()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  adminActionClient (ä»…é™ç®¡ç†å‘˜)       â”‚
â”‚  â”œâ”€ æ£€æŸ¥ user.role === 'admin'      â”‚
â”‚  â”œâ”€ é€‚ç”¨: ç”¨æˆ·ç®¡ç†ã€ç³»ç»Ÿç®¡ç†         â”‚
â”‚  â””â”€ ç¤ºä¾‹: getUsersAction()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. React Query æŸ¥è¯¢é”®è®¾è®¡
```
creditsKeys = {
  all: ['credits'],
  balance: () => [...creditsKeys.all, 'balance'],
  transactions: () => [...creditsKeys.all, 'transactions'],
  stats: () => [...creditsKeys.all, 'stats']
}

paymentKeys = {
  all: ['payment'],
  currentPlan: (userId) => [...paymentKeys.all, 'currentPlan', userId],
  history: (userId) => [...paymentKeys.all, 'history', userId]
}

userKeys = {
  all: ['user'],
  current: () => [...userKeys.all, 'current'],
  list: () => [...userKeys.all, 'list']
}
```

### 3. å›½é™…åŒ–é›†æˆç‚¹
```
é¡µé¢çº§åˆ«:
  â”œâ”€ [locale] åŠ¨æ€è·¯ç”±å‚æ•°
  â”œâ”€ useTranslations() Hook
  â””â”€ getTranslations() Server-side

ç»„ä»¶çº§åˆ«:
  â”œâ”€ Link ä½¿ç”¨ usePathnameWithLocale()
  â”œâ”€ æ–‡æœ¬ä½¿ç”¨ useTranslations('ComponentName')
  â””â”€ å…ƒæ•°æ®ä½¿ç”¨ generateMetadata(locale)

é…ç½®:
  â””â”€ src/i18n/routing.ts (locales é…ç½®)
```

## æ€§èƒ½è€ƒè™‘

```
ç¼“å­˜å±‚:
â”œâ”€ React Query ç¼“å­˜ Server State
â”œâ”€ Browser Cache ç¼“å­˜é™æ€èµ„æº
â”œâ”€ ISR (Incremental Static Regeneration) ç¼“å­˜é¡µé¢
â””â”€ CDN ç¼“å­˜ Next.js æ„å»ºäº§ç‰©

å®æ—¶æ›´æ–°:
â”œâ”€ React Query è‡ªåŠ¨é‡æ–°éªŒè¯
â”œâ”€ Zustand å³æ—¶æ›´æ–° UI
â””â”€ Webhook å®æ—¶å¤„ç†æ”¯ä»˜äº‹ä»¶
```

---

**å…³é”®è¦ç‚¹**:
- äº”å±‚æ¶æ„æ¸…æ™°åˆ†ç¦»äº†å…³æ³¨ç‚¹
- Server Actions æä¾›äº†å®‰å…¨çš„å®¢æˆ·ç«¯â†’æœåŠ¡å™¨é€šä¿¡
- React Query å¤„ç†æœåŠ¡å™¨çŠ¶æ€ï¼ŒZustand å¤„ç† UI çŠ¶æ€
- æ‰€æœ‰æ•°æ®åº“è®¿é—®éƒ½é€šè¿‡ Drizzle ORMï¼Œé¿å… SQL æ³¨å…¥
- æƒé™æ£€æŸ¥åœ¨ Server Action å±‚å®Œæˆï¼Œç¡®ä¿å®‰å…¨æ€§
