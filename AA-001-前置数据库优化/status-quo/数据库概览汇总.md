# 数据库概览汇总

> 更新时间: 2025-12-06
> 数据库: Neon PostgreSQL (生产环境)
> 迁移状态: ✅ 优化完成

## 数据库统计

| 表名 | 记录数 | 说明 |
|------|--------|------|
| ppt | 1,471 | PPT 模板主表 |
| slide | 36,497 | 幻灯片表 |
| category | 10 | 分类表 |
| user | 6 | 用户表 |
| account | 6 | OAuth 账户表 |
| session | 1 | 会话表 |
| verification | 1 | 验证码表 |
| ad_watch_record | 4 | 广告观看记录 |
| import_batch | 4 | 导入批次表 |
| playing_with_neon | 10 | 测试表 (待清理) |
| __drizzle_migrations | 7 | Drizzle 迁移记录 |
| payment | 0 | 支付记录 |
| credit_transaction | 0 | 积分交易 |
| user_credit | 0 | 用户积分 |
| user_download_history | 0 | 下载历史 |
| user_favorite | 0 | 用户收藏 |
| download_record | 0 | 下载记录 (旧表) |
| view_record | 0 | 浏览记录 |
| import_record | 0 | 导入记录 |

## 表分类

### 核心业务表
- `ppt` - PPT 模板主表
- `slide` - 幻灯片表
- `category` - 分类表

### 用户认证表 (Better Auth)
- `user` - 用户表
- `session` - 会话表
- `account` - OAuth 账户表
- `verification` - 验证码表

### 支付与积分表
- `payment` - 支付记录
- `user_credit` - 用户积分
- `credit_transaction` - 积分交易

### 用户行为表
- `ad_watch_record` - 广告观看记录
- `user_download_history` - 下载历史
- `user_favorite` - 用户收藏
- `download_record` - 下载记录 (旧表)
- `view_record` - 浏览记录

### 导入管理表
- `import_batch` - 导入批次
- `import_record` - 导入记录

## 2025-12-06 优化完成项

| 优化项 | 状态 |
|--------|------|
| 外键约束 `ad_watch_record.ppt_id` → `ppt.id` (SET NULL) | ✅ |
| 外键约束 `user_download_history.ppt_id` → `ppt.id` (CASCADE) | ✅ |
| 唯一约束 `user_credit.user_id` | ✅ |
| 字段重命名 `payment_id` → `stripe_invoice_id` | ✅ |
| 软删除字段 `ppt.deleted_at` | ✅ |
| 软删除字段 `user.deleted_at` | ✅ |
| 元数据字段 `ppt.description/file_size/file_format` | ✅ |
| 重复索引清理 | ✅ |
| 复合索引优化 | ✅ |
