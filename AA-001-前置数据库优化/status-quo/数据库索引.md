# 数据库索引

> 更新时间: 2025-12-06
> 数据库: Neon PostgreSQL

## 索引统计

| 表名 | 索引数量 |
|------|----------|
| ppt | 8 |
| payment | 12 |
| user_download_history | 5 |
| ad_watch_record | 6 |
| user | 5 |
| session | 4 |
| account | 4 |
| slide | 2 |
| user_credit | 3 |
| credit_transaction | 3 |
| category | 2 |
| user_favorite | 4 |
| download_record | 4 |
| view_record | 3 |
| import_batch | 3 |
| import_record | 3 |

## 详细索引列表

### ppt 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| ppt_pkey | UNIQUE | id |
| ppt_category_idx | INDEX | category |
| ppt_language_idx | INDEX | language |
| ppt_status_idx | INDEX | status |
| ppt_created_at_idx | INDEX | created_at DESC |
| ppt_download_count_idx | INDEX | download_count DESC |
| ppt_view_count_idx | INDEX | view_count DESC |
| idx_ppt_source_aid | INDEX | source_aid |

### user 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| user_pkey | UNIQUE | id |
| user_email_unique | UNIQUE | email |
| user_customer_id_idx | INDEX | customer_id |
| user_role_idx | INDEX | role |
| user_id_idx | INDEX | id (冗余，待清理) |

### user_credit 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| user_credit_pkey | UNIQUE | id |
| user_credit_user_id_unique | UNIQUE | user_id ✨新增 |
| user_credit_user_id_idx | INDEX | user_id |

### credit_transaction 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| credit_transaction_pkey | UNIQUE | id |
| credit_transaction_user_id_idx | INDEX | user_id |
| credit_transaction_type_idx | INDEX | type |

### ad_watch_record 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| ad_watch_record_pkey | UNIQUE | id |
| ad_watch_record_watch_token_key | UNIQUE | watch_token |
| ad_watch_user_id_idx | INDEX | user_id |
| ad_watch_ip_idx | INDEX | ip_address |
| ad_watch_token_idx | INDEX | watch_token |
| ad_watch_created_idx | INDEX | created_at |
| ad_watch_status_idx | INDEX | status |

### user_download_history 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| user_download_history_pkey | UNIQUE | id |
| download_user_ppt_idx | INDEX | user_id, ppt_id |
| download_user_idx | INDEX | user_id |
| download_ppt_idx | INDEX | ppt_id |
| download_method_idx | INDEX | download_method |

### slide 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| slide_pkey | UNIQUE | id |
| idx_slide_ppt_number | INDEX | ppt_id, slide_number ✨新增 |

### session 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| session_pkey | UNIQUE | id |
| session_token_unique | UNIQUE | token |
| session_token_idx | INDEX | token |
| session_user_id_idx | INDEX | user_id |

### payment 表
| 索引名 | 类型 | 字段 |
|--------|------|------|
| payment_pkey | UNIQUE | id |
| payment_invoice_id_unique | UNIQUE | invoice_id |
| payment_type_idx | INDEX | type |
| payment_scene_idx | INDEX | scene |
| payment_price_id_idx | INDEX | price_id |
| payment_user_id_idx | INDEX | user_id |
| payment_customer_id_idx | INDEX | customer_id |
| payment_status_idx | INDEX | status |
| payment_paid_idx | INDEX | paid |
| payment_subscription_id_idx | INDEX | subscription_id |
| payment_session_id_idx | INDEX | session_id |
| payment_invoice_id_idx | INDEX | invoice_id |

## 外键约束

| 表名 | 约束名 | 字段 | 引用表 | 删除规则 |
|------|--------|------|--------|----------|
| account | account_user_id_user_id_fk | user_id | user.id | CASCADE |
| ad_watch_record | ad_watch_record_user_id_fkey | user_id | user.id | CASCADE |
| ad_watch_record | ad_watch_record_ppt_id_fkey | ppt_id | ppt.id | SET NULL ✨新增 |
| credit_transaction | credit_transaction_user_id_user_id_fk | user_id | user.id | CASCADE |
| download_record | download_record_ppt_id_fkey | ppt_id | ppt.id | CASCADE |
| download_record | download_record_user_id_fkey | user_id | user.id | SET NULL |
| import_record | import_record_batch_id_fkey | batch_id | import_batch.id | NO ACTION |
| payment | payment_user_id_user_id_fk | user_id | user.id | CASCADE |
| session | session_user_id_user_id_fk | user_id | user.id | CASCADE |
| slide | slide_ppt_id_fkey | ppt_id | ppt.id | NO ACTION |
| user_credit | user_credit_user_id_user_id_fk | user_id | user.id | CASCADE |
| user_download_history | user_download_history_user_id_fkey | user_id | user.id | CASCADE |
| user_download_history | user_download_history_ppt_id_fkey | ppt_id | ppt.id | CASCADE ✨新增 |
| user_favorite | user_favorite_ppt_id_fkey | ppt_id | ppt.id | CASCADE |
| user_favorite | user_favorite_user_id_fkey | user_id | user.id | CASCADE |
| view_record | view_record_ppt_id_fkey | ppt_id | ppt.id | CASCADE |
| view_record | view_record_user_id_fkey | user_id | user.id | SET NULL |
| category | category_parent_id_fkey | parent_id | category.id | NO ACTION |

## 唯一约束

| 表名 | 约束名 | 字段 |
|------|--------|------|
| user | user_email_unique | email |
| session | session_token_unique | token |
| payment | payment_invoice_id_unique | invoice_id |
| ad_watch_record | ad_watch_record_watch_token_key | watch_token |
| category | category_slug_key | slug |
| user_credit | user_credit_user_id_unique | user_id ✨新增 |
| user_favorite | user_favorite_user_id_ppt_id_key | user_id, ppt_id |

## 已清理的重复索引

| 索引名 | 状态 |
|--------|------|
| idx_ppt_category | ✅ 已删除 |
| idx_ppt_language | ✅ 已删除 |
| idx_ppt_created_at | ✅ 已删除 |
| idx_import_batch_status | ⚠️ 仍存在 (与 import_batch_status_idx 重复) |
